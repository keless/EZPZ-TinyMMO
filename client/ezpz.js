var exports={};class AppState{constructor(){this.t=null,this.i=null}s(){this.t&&this.t.s&&this.t.s(),this.i&&this.i.s&&this.i.s()}}class AppStateController{constructor(){this.e={},this.h=null,Service.r("state",this)}n(t,i){this.e[t]=i}a(t,i){this.e[t]?(this.h&&(this.h.s(),this.h=null),this.h=new this.e[t](i)):console.o("no state named "+t+" available")}}class BaseListener{constructor(){this.c=[]}s(){this.u()}l(t,i,s){s||(s=EventBus.d),i||console.o("SetListener given invalid callback function for "+t),s.f(t,i.bind(this)),this.c.push({v:s,m:t,p:i})}g(t,i,s){s||(s=EventBus.d),s.w(t,i.bind(this))}u(){for(var t of this.c)t.v.w(t.m,t.p)}}class BaseStateModel extends BaseListener{constructor(){super()}s(){super.s()}C(t,i){}}class BaseStateView extends BaseListener{constructor(){super(),this.S=new NodeView;var t=Service.T("gfx");this.S.size.x(t.y(),t.V())}s(){super.s()}D(t,i,s,e){var h=new ButtonView(t,"gfx/btn_blue.sprite",i,"12px Arial","#FFFFFF");h.b.x(s,e),this.S.M(h)}A(t,i,s){this.S&&this.S.A(t,i,s)}N(t,i){}I(t,i,s){this.S&&this.S.I(t,i,s)}P(t,i,s){this.S&&this.S.P(t,i,s)}F(t,i,s,e){this.S&&this.S.F(t,i,s,e)}}class NodeView extends BaseListener{constructor(){super(),this.R=Config&&Config._||!1,this.b=new Vec2D,this.size=new Vec2D,this.B=0,this.O=1,this.k=!0,this.L=null,this.W=[],this.J=null,this.z=[],this.G=[],this.U=1,this.H=!1,this.q=null,this.j=!1,this.K=!0,this.Y=!0,this.R&&(this.Q=[])}X(t){if(!this.R)return console.o("NodeView - trying to serialize NodeView when seralizable == false"),{};t=t||!1;var i={Z:"NodeView"};if(i.b=this.b.X(),i.size=this.size.X(),0!=this.B&&(i.B=this.B),1!=this.O&&(i.O=this.O),1!=this.k&&(i.$=this.k),1!=this.U&&(i.U=this.U),0!=this.H&&(i.H=this.H),0!=this.j&&(i.tt=this.j),1!=this.K&&(i.it=this.K),1!=this.Y&&(i.st=this.Y),null!=this.L&&console.et("NodeView.toJson() - cant serialize pUser"),null!=this.q&&console.et("NodeView.toJson() - cant serialize fnOnClick"),this.z.length>0&&console.et("NodeView.toJson() - cant serialize actions.. yet"),i.Q=this.Q,this.W.length>0&&!t){var s=[];for(var e of this.W)s.push(e.X());i.W=s}return i}ht(t){this.rt(),this.b=new Vec2D(t.b.nt,t.b.at),this.size=new Vec2D(t.size.nt,t.size.at),this.B=t.B||0,this.O=t.O||1,this.k=t.$||!0,this.U=t.U||1,this.H=t.H||!1,this.j=t.tt||!1,this.K=t.it||!0,this.Y=t.st||!0,this.ot(t.Q||[]),this.ct(t.W||[])}rt(){this.W.length=0,this.G.length=0,this.z.length=0,this.R&&(this.Q=[]),delete this.ut,delete this.lt,delete this.dt,delete this.ft,delete this.vt,delete this.mt,delete this.pt,delete this.gt,delete this.wt,delete this.Ct,delete this.St,delete this.Tt}ot(t){for(var i of t)switch(i.call){case"setCircle":this.xt(i.yt,i.Vt,i.Dt);break;case"setRect":this.bt(i.Mt,i.Et,i.Vt);break;case"setPolygon":this.At(i.Nt,i.fill,i.It,i.Pt);break;case"setImage":this.Ft(i.lt);break;case"setImageStretch":this.Rt(i.lt,i.nt,i.at,i.Mt,i.Et);break;case"setSprite":this._t(i.dt);break;case"setLabel":this.Bt(i.pt,i.wt,i.gt,i.Ot);break;case"setLabelWithOutline":this.kt(i.pt,i.wt,i.gt,i.Lt,i.size,i.Ot);break;case"setTextInput":this.Wt(i.Mt,i.Et)}}ct(t){for(var i of(this.W.length=0,t)){var s=null;switch(i.Z){case"NodeView":s=new NodeView;break;case"ButtonView":s=new ButtonView(i.Jt,i.dt,i.zt,i.wt,i.gt);break;case"MenuView":s=new MenuView(i.Gt,i.Mt,i.Et);break;case"TableView":s=new TableView(i.Mt,i.Et,i.Ut);break;default:console.et("NodeView _loadChildrenJson unknown classType "+i.Z);continue}s.ht(i),this.M(s)}}s(){for(var t of(this.Tt&&this.Tt.Ht(),this.W))t.s();super.s()}get $(){return this.k}set $(t){this.k=t,this.Tt&&(this.Tt.qt=t)}jt(){return this.J}Kt(t){for(var i=0;i<this.W.length;i++)if(this.W[i]==t)return i;return-1}Yt(t){return t<0||t>=this.W.length?null:this.W[t]}Qt(){return this.W.length}get Xt(){return this.J?this.J.Xt+this.B:this.B}get Zt(){return this.$t.b}get $t(){var t={O:this.O,ti:this.B,b:this.b.ii()};if(this.J){var i=this.J.$t;t.O+=i.O,t.ti+=i.ti,t.b.si(i.b)}return t}ei(t){this.L=t}hi(){return this.L}xt(t,i,s){if(this.R&&this.Q.push({call:"setCircle",yt:t,Vt:i,Dt:s}),this.ut)console.o("NodeView: already has a circle, abort!");else{this.ut=t;var e=this;this.G.push(function(t,h,r,n){1!=e.U&&t.ri(e.U),t.ni(h,r,e.ut,i,s),1!=e.U&&t.ri(1)})}}bt(t,i,s){this.R&&this.Q.push({call:"setRect",Mt:t,Et:i,Vt:s}),this.size.x(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.G.push(function(t,i,h,r){1!=e.U&&t.ri(e.U),t.ai(i,h,e.size.nt,e.size.at,s),1!=e.U&&t.ri(1)})}At(t,i,s,e){this.R&&this.Q.push({call:"setPolygon",Nt:t,fill:i,It:s,Pt:e});var h=this;this.G.push(function(r,n,a,o){1!=h.U&&r.ri(h.U),r.oi(t,i,s,e),1!=h.U&&r.ri(1)})}Ft(t){(this.R&&(isString(t)?this.Q.push({call:"setImage",lt:t}):console.et("NodeView - cannot serialize setImage with non-string image parameter")),isString(t))&&(t=Service.T("rp").ci(t));if(this.lt)console.o("NodeView: already has an image, abort!");else{this.lt=t,this.size.x(Math.max(this.size.nt,t.ui),Math.max(this.size.at,t.li));var i=this;this.G.push(function(t,s,e,h){1!=i.U&&t.ri(i.U),t.di(i.lt,s,e),1!=i.U&&t.ri(1)})}}Rt(t,i,s,e,h){(this.R&&(isString(t)?this.Q.push({call:"setImageStretch",lt:t,nt:i,at:s,Mt:e,Et:h}):console.et("NodeView - cannot serialize setImageStretch with non-string image parameter")),isString(t))&&(t=Service.T("rp").ci(t));if(this.lt)console.o("NodeView: already has an image, abort!");else{this.lt=t,this.size.x(Math.max(this.size.nt,t.ui),Math.max(this.size.at,t.li));var r=this;this.G.push(function(t,i,s,n){1!=r.U&&t.ri(r.U),t.fi(r.lt,i,s,e,h),1!=r.U&&t.ri(1)})}}_t(t,i,s){(this.R&&(isString(t)?this.Q.push({call:"setSprite",dt:t,ft:i,vt:s}):console.et("NodeView - cannot serialize setSprite with non-string image parameter")),s=s||!1,isString(t))&&(t=Service.T("rp").vi(t));if(t)if(this.dt)console.o("NodeView: already has a sprite, abort!");else{this.dt=t,this.ft=i,this.vt=s,this.size.x(Math.max(this.size.nt,t.y()),Math.max(this.size.at,t.V()));var e=this;this.G.push(function(t,i,s,h){1!=e.U&&t.ri(e.U),e.dt.mi(t,i,s,Math.floor(e.ft),e.vt),1!=e.U&&t.ri(1)})}}pi(t,i){this._t(t,0,i);var s=this.dt.gi(),e=this.dt.wi()/s,h=this,r=function(){h.ft=0,h.Ci("spriteFrame",e,s-1,r)};r()}Si(t){if(this.R&&console.et("NodeView - cannot serialize setAnim"),this.Ti)console.o("NodeView: already has an anim, abort!");else{this.Ti=t.xi();var i=this;this.G.push(function(t,s,e,h){1!=i.U&&t.ri(i.U),i.Ti.C(h),i.Ti.F(t,s,e,i.vt),1!=i.U&&t.ri(1)}),this.yi=function(t,i){this.Ti.Vi(t,i)},this.Di=function(t,i){this.Ti.Di(t,i)},this.bi=function(t,i){this.Ti.bi(t,i)}}}yi(t,i){this.Ti&&this.Ti.Vi(t,i)}Bt(t,i,s,e){if(this.R&&this.Q.push({call:"setLabel",pt:t,wt:i,gt:s,Ot:e}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=e||!1,this.pt=t.toString(),this.wt=i,this.gt=s;var h=Service.T("gfx").Mi(this.pt,this.wt,this.mt);this.size.x(Math.max(this.size.nt,h.nt),Math.max(this.size.at,h.at));var r=this;this.G.push(function(t,i,s,e){t.Ei(r.pt,i,s,r.wt,r.gt,r.mt)})}}kt(t,i,s,e,h,r){if(this.R&&this.Q.push({call:"setLabelWithOutline",pt:t,wt:i,gt:s,Lt:e,size:h,Ot:r}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=r||!1,this.pt=t.toString(),this.wt=i,this.gt=s||"#FFFFFF",this.St=e||"#000000",this.Ct=h||2;var n=Service.T("gfx").Mi(this.pt,this.wt,this.mt);this.size.x(Math.max(this.size.nt,n.nt),Math.max(this.size.at,n.at));var a=this;this.G.push(function(t,i,s,e){t.Ai(a.pt,i,s,a.wt,a.St,a.Ct,a.mt)}),this.G.push(function(t,i,s,e){t.Ei(a.pt,i,s,a.wt,a.gt,a.mt)})}}Ni(t){isString(this.pt)?this.pt=t.toString():console.o("NodeView: cant update label, dont have one!")}Ii(t){this.gt=t}Wt(t,i){if(this.R&&this.Q.push({call:"setTextInput",Mt:t,Et:i}),this.Tt)console.o("NodeView: already has a text input, abort!");else{var s=Service.T("gfx");this.Tt=new CanvasInput({Pi:s.Pi,ui:t-2,li:i-2,Fi:0,Ri:2,_i:"1px 1px 0px #fff",Bi:"0px 0px 2px rgba(0, 0, 0, 0.5)"}),this.Tt.Oi=this.b,this.size.x(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.Tt.ki(function(t,i){EventBus.d.Li({Wi:"textInputSubmitted",Ji:i.Ji(),zi:e})}),this.G.push(function(t,i,s,h){e.Tt.Gi(i,s)})}}Ui(){return this.Tt?this.Tt.Ji():null}Hi(t){this.Tt&&this.Tt.Ji(t)}qi(){this.Tt&&this.Tt.Ji("")}ji(t){this.Ki=t}Yi(t,i,s,e){this.R&&this.Q.push({call:"setProgressBar",Mt:t,Et:i,Qi:s,Xi:e}),this.Ki=.5,this.size.x(Math.max(this.size.nt,t),Math.max(this.size.at,i));var h=this;this.G.push(function(t,i,r,n){1!=h.U&&t.ri(h.U),t.ai(i,r,h.size.nt,h.size.at,s);var a=h.size.nt,o=h.Ki*(a-2);t.ai(Math.floor(i-a/2+o/2+1),r,Math.floor(h.size.nt*h.Ki),h.size.at,e),1!=h.U&&t.ri(1)})}Zi(t){this.R&&console.et("NodeView - cannot serialize addCustomDraw"),this.G.push(t)}$i(t,i,s){this.Y=i||!0,this.K=s||!0,this.q=t}st(){this.q||this.$i(function(t,i,s){t.ts=!0},!0)}ss(t){this.j=!0,this.es=new Vec2D,this.hs=t?t.ii():null}A(t,i,s){if(this.$&&!t.ts){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}if(this.K)for(var h=this.W.length-1;h>=0;h--){if(this.W[h].A(t,i,s),t.ts)return}var r=-this.size.nt/2,n=-this.size.at/2;this.q&&Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)&&(this.q&&(this.q(t,i,s),this.Y&&(t.ts=!0)),t.ts)||!this.j||this.as||!Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)||(this.os(),t.ts=!0,t.ts)}}os(){this.as=!0;var t=Service.T("app");this.es.cs(t.us),this.l("onMouseMove",this.ls),this.l("onMouseUp",this.ds)}ls(t){var i=this.es.fs(t.vs);i.ms(-1),this.es.cs(t.vs),this.b.si(i),this.hs&&this.hs.ps(this.b)}ds(t){this.as=!1,this.g("onMouseMove",this.ls),this.g("onMouseUp",this.ds)}I(t,i,s){if(this.$){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Tt&&this.Tt.gs(t,this.Tt),this.W))if(h.I(t,i,s),t.ts)return}}P(t,i,s){if(this.$){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Tt&&this.Tt.ws(t,this.Tt),this.W))if(h.P(t,i,s),t.ts)return}}y(){return this.size.nt}V(){return this.size.at}M(t){t.Cs(),this.W.push(t),t.J=this}Ss(t){var i=t.Zt,s=this.Zt,e=i.fs(s);t.b.cs(e),this.M(t)}Cs(t){t=t||!1,this.J&&(this.J.Ts(this,t),this.J=null)}Ts(t,i){i=i||!1;var s=this.W.indexOf(t);this.xs(s,i)}xs(t,i){if(i=i||!1,!(t<0)){var s=this.W.splice(t,1)[0];s.J===this&&(s.J=null),i&&s.s()}}ys(t){t=t||!1;for(var i=this.W.length-1;i>=0;i--){var s=this.W[i];this.Ts(s,t)}}F(t,i,s,e){if(this.$){for(var h of(this.Vs(e),t.Ds(),t.bs(i+this.b.nt,s+this.b.at),0!=this.B&&t.rs(this.B),1!=this.O&&t.O(this.O),this.H&&t.Ms(!1),this.G))h(t,0,0,e);for(var r of(this.H&&t.Ms(!0),this.W))r.F(t,0,0,e);t.Es()}}Vs(t){if(0!=this.z.length){for(var i=[],s=0;s<this.z.length;s++){var e=this.z[s];e.ts?i.push(s):e.C(t)}if(i.length>0)for(var h=i.length-1;h>=0;h--)this.z.splice(i[h],1)}}As(){for(var t=0;t<this.z.length;t++)this.z[t].s();this.z.length=0}Ns(t,i){var s=new NodeAction_noProperty(t);s.Is=function(){i&&i()},this.z.push(s)}Ps(t,i){var s=this;this.Ns(t,function(){s.Cs()})}Fs(t,i,s){this.Ci("scale",t,i,s)}Rs(t,i,s){this._s("pos",t,i,s)}Bs(t,i,s){var e=this.b.Os(i);this._s("pos",t,e,s)}Ci(t,i,s,e){var h=new NodeAction_float(t,i,s);h.ks(this),h.Is=e||null,this.z.push(h)}_s(t,i,s,e){var h=new NodeAction_vec2d(t,i,s);h.ks(this),h.Is=e||null,this.z.push(h)}Ls(t,i,s,e){var h=new NodeAction_arrayPath(t,i,s);h.ks(this),h.Is=e||null,this.z.push(h)}}class NodeAction{constructor(t,i,s){this.Ws=0,this.Js=i,this.zs=null,this.Gs=t,this.ts=!1,this.Is=null,this.Us=null,this.Hs=s}s(){this.zs=null}ks(t){this.zs=t,this.Us=this.zs[this.Gs]}qs(t){var i=t-this.Ws;return i<0?0:i>=this.Js?1:i/this.Js}C(t){0==this.Ws&&(this.Ws=t);var i=this.qs(t);if(i>=1)this.zs[this.Gs]=this.Hs,this.ts=!0,this.Is&&(this.Is(),this.Is=null);else{var s=this.js(i);this.zs[this.Gs]=s}}js(t){}}class NodeAction_float extends NodeAction{js(t){var i=this.Hs-this.Us;return this.Us+i*t}}class NodeAction_vec2d extends NodeAction{js(t){var i=this.Hs.fs(this.Us);return this.Us.Os(i.ms(t))}}class NodeAction_noProperty extends NodeAction{constructor(t){super(void 0,t,void 0)}ks(t){this.zs=t,this.Us=0}C(t){0==this.Ws&&(this.Ws=t),this.qs(t)>=1&&(this.ts=!0,this.Is&&(this.Is(),this.Is=null))}}class NodeAction_arrayPath extends NodeAction{constructor(t,i,s){super(t,i,new Vec2D(s[s.length-1][0],s[s.length-1][1])),this.Ks=s}js(t){var i=this.Ks.length,s=~~(i*t);s>=i-1&&(s=i-2);var e=1/i,h=(t-s*e)/e;h>1&&(h=1);var r=new Vec2D(this.Ks[s][0],this.Ks[s][1]);console.log("vTo idx "+(s+1));var n=new Vec2D(this.Ks[s+1][0],this.Ks[s+1][1]).fs(r);return r.Os(n.ms(h))}}class TableView extends NodeView{static get Ys(){return 0}static get Qs(){return 1}static get Xs(){return 0}static get Zs(){return 1}static get $s(){return 2}constructor(t,i,s){super(),this.te=[],this.ie=0,this.se=0,this.Fi=5,this.ee=TableView.Xs,this.Ut=s||!1,this.size.x(t,i),this.he=TableView.Ys}X(t){if(!this.R)return console.o("TableView - trying to serialize TableView when seralizable == false"),{};var i=super.X(t);return i.Z="TableView",i.Fi=this.Fi,i.ee=this.ee,i.Ut=this.Ut,i.Mt=this.size.nt,i.Et=this.size.at,i.he=this.he,i}ht(t){super.ht(t),this.Ut=t.Ut,this.size.x(t.Mt,t.Et),this.Fi=t.Fi,this.ee=t.ee,this.he=t.he}re(t){this.te.push(t),this.Ut&&(this.he==TableView.Ys?(this.size.at+=t.V()+this.Fi,this.size.nt=Math.max(this.size.nt,t.y())):(this.size.nt+=t.y()+this.Fi,this.size.at=Math.max(this.size.at,t.V())))}ne(t){this.te=this.te.splice(t,1),this.Ut&&(direction==TableView.Ys?this.size.at-=cell.V()+this.Fi:this.size.nt-=cell.y()+this.Fi)}ae(){if(this.Ut)for(var t=this.te.length-1;t>=0;t--)this.ne(t);else this.te.length=0}A(t,i,s){i-=this.b.nt,s-=this.b.at,i-=this.ie,s-=this.se;var e=0;this.Ut&&this.te.length>0&&(this.he==TableView.Ys?e-=this.te[0].V():e-=this.te[0].y());var h=0;if(this.he==TableView.Ys)for(var r=0;r<this.te.length;r++){if(this.te[r].A(t,i,s-e),t.ts)return;e+=this.te[r].V()+this.Fi}else{this.ee==TableView.Xs&&(h-=this.size.nt/2*.8);for(r=0;r<this.te.length;r++){if(this.te[r].A(t,i-(h+e),s),t.ts)return;e+=this.te[r].y()+this.Fi}}}F(t,i,s,e){for(var h of(t.Ds(),t.bs(i+this.b.nt,s+this.b.at),0!=this.B&&t.rs(this.B),1!=this.O&&t.O(this.O),this.G))h(t,0,0,e);i-=this.ie,s-=this.se;var r=0;this.Ut&&this.te.length>0&&(this.he==TableView.Ys?r-=this.te[0].V():r-=this.te[0].y());var n=0;if(this.he==TableView.Ys)for(var a=0;a<this.te.length;a++)this.te[a].F(t,0,r,e),r+=this.te[a].V()+this.Fi;else{this.ee==TableView.Xs&&(n-=this.size.nt/2*.8);for(a=0;a<this.te.length;a++)this.te[a].F(t,n+r,0,e),r+=this.te[a].y()+this.Fi}for(var o of this.W)o.F(t,0,0,e);t.Es()}}class Animation{constructor(){this.oe=["end"],this.ce={ue:{le:5,de:{fe:"idle"}}},this.ve="idle",this.me={}}pe(t){this.oe=t.oe,this.ce=t.ce,this.ve=t.ge}we(t,i,s){var e=Service.T("rp"),h=this,r=Object.keys(this.ce).length;for(var n in this.ce)!function(a){e.vi(t+n+i,function(t){var i=t.Ce;i&&(h.Se(a,i),s&&0==--r&&s())})}(n)}Se(t,i){this.me[t]=i}xi(){return new AnimationInstance(this)}}class AnimationInstance{constructor(t){this.Te=t,this.Ws=0,this.xe="null",this.mi=0,this.ye=null,this.le=5,this.Di(0,this.Te.ve),this.Ve=!1}Vi(t,i){var s=this.Te.ce[this.xe].de[i];return s?(this.Di(t,s),!0):(i!=this.xe&&console.et("failed to handle event "+i),!1)}Di(t,i){i=i||this.Te.ve,this.xe=i,this.Ws=t,this.mi=0,this.ye=this.Te.me[this.xe];var s=this.Te.ce[this.xe];this.le=s.le||this.ye.wi(),this.ye||console.et("no sprite for startAnim("+i+")")}C(t){if(!this.Ve){var i=this.ye.gi(),s=i/this.le,e=t-this.Ws;e>s?this.Vi(t,"end"):this.mi=Math.floor(e/s*i)}}F(t,i,s,e){this.ye.mi(t,i,s,this.mi,e)}De(){return this.ye}}class FourPoleAnimation extends Animation{static get be(){return 0}static get Me(){return 1}static get Ee(){return 2}static get Ae(){return 3}constructor(){super(),this.Ne=["N","E","S","W"]}we(t,i,s){var e=Service.T("rp"),h=this,r=0,n=!1;for(var a in this.ce)!function(a){for(var o in e.Ie(t+a+i)&&(r++,e.vi(t+a+i,function(t){var i=t.Ce;i&&(h.Se(a,i),r--,s&&0==r&&n&&s())})),h.Ne)!function(o){var c=h.Ne[o];e.Ie(t+a+c+i)&&(r++,e.vi(t+a+c+i,function(t){var i=t.Ce;i&&(h.Se(a+c,i),r--,s&&0==r&&n&&s())}))}(o)}(a);n=!0}xi(){return new FourPoleAnimationInstance(this)}}class FourPoleAnimationInstance extends AnimationInstance{bi(t,i){(i<0||i>this.Te.Ne.length)&&console.o("invalid direction index "+i+" for FourPoleAnimation with "+this.Te.Ne.length+" directions");var s=this.Te.Ne[i];s!=this.Pe&&(this.Pe=s,this.Di(t,this.xe))}Di(t,i){void 0==this.Pe&&(this.Pe=this.Te.Ne[0]),i=i||this.Te.ve,this.xe=i,this.Ws=t,this.mi=0,this.Te.me[this.xe+this.Pe]?this.ye=this.Te.me[this.xe+this.Pe]:this.ye=this.Te.me[this.xe];var s=this.Te.ce[this.xe];this.le=s.le||this.ye.wi(),this.ye||console.et("no sprite for startAnim("+i+")")}}var KEY_LEFT=37,KEY_UP=38,KEY_RIGHT=39,KEY_DOWN=40;class Application{static getTime(){return Service.T("app").Fe}constructor(t,i,s){this.Re=t,this.us=new Vec2D;var e=this;document._e=t,document.Be=function(t){e.I(t)},document.ws=function(t){e.P(t)},test=function(t,i){return t<5?i+.01*t:i+.01*(10-t)};var h=function(t){var i=Service.T("gfx").Pi,s=t.Oe-(i.ke||i.Le),h=t.We-(i.Je||i.ze);e.us.x(s,h)};document.Ge=function(t){h(t),e.A(t,e.us.nt,e.us.at,t.Ue)},document.He=function(t){h(t),EventBus.d.Li({Wi:"onMouseMove",vs:e.us},!0)},document.qe=function(t){h(t),EventBus.d.Li({Wi:"onMouseUp",vs:e.us},!0)},document.je=function(t){h(t)},document.Ke=function(t){var i=t.Ye;e.N(t,i)},this.Qe=0,this.Fe=0,Service.r("app",this),this.Xe(t,i)}Xe(t,i){new ResourceProvider,new Graphics(i),new AudioManager,new Physics,new SaveData(t),new AppStateController}Ze(){this.$e()}th(){this.ih()}sh(){return null==this.eh}$e(){null==this.eh&&(this.Qe=(new Date).getTime(),this.eh=setInterval(this.hh.bind(this),33))}ih(){null!=this.eh&&(clearInterval(this.eh.bind(this)),this.eh=null)}hh(){var t=Service.T("state").h,i=Date.now();i/=1e3;var s=Math.abs(i-this.Qe);this.Qe=i,this.Fe+=s,this.rh(s,this.Fe),t.i&&t.i.C(i,s),Service.T("physics").nh(),this.ah(s,this.Fe);var e=Service.T("gfx");e.oh(!0),t.t&&t.t.F(e,0,0,this.Fe),this.ch(e,s,this.Fe)}uh(){console.log("override me: Application.onApplicationLoaded()")}rh(t,i){}ah(t,i){}ch(t,i,s){}I(t){Service.T("state").h.t.I(t,this.us.nt,this.us.at)}P(t){Service.T("state").h.t.P(t,this.us.nt,this.us.at)}A(t,i,s){Service.T("state").h.t.A(t,i,s)}N(t,i){}}class AudioManager{constructor(){console.log("AudioManager created"),Service.r("audio",this),EventBus.lh.f("play",AudioManager.dh.bind(this))}static dh(t){this.fh||(this.fh={});var i=t.vh;this.fh[i]||(this.fh[i]=new Audio(i));var s=this.fh[t.vh];s.mh||console.log("cutting sfx short "+i),s.ph()}}class ButtonView extends NodeView{static get gh(){return 0}static get wh(){return 1}constructor(t,i,s,e,h,r){super(),this.Ch=ButtonView.gh,this.Sh=!1,this.m=r||{},this.m.Wi=t||"btnID",(i||s)&&this.Th(i,s,e,h),this.xh=null}Th(t,i,s,e){t&&this._t(t),i&&(s=s||"10px Arial",e=e||"#CCCCCC",this.Bt(i,s,e))}X(t){if(!this.R)return console.o("ButtonView - trying to serialize ButtonView when seralizable == false"),{};var i=super.X(t);return i.Z="ButtonView",i.Jt=this.m.Wi,this.Sh&&(i.Sh=this.Sh),i}ht(t){super.ht(t),this.m.Wi=t.Jt,this.Sh=t.Sh||!1,this.Th(t.dt,t.zt,t.wt,t.gt)}s(){this.xh&&clearTimeout(this.xh),this.xh=null,super.s()}_t(t){super._t(t),this.size.x(this.dt.y(),this.dt.V())}F(t,i,s,e){this.ft=this.Ch,super.F(t,i,s,e)}A(t,i,s){if(!this.Sh){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}var h=0,r=0;if(Config.yh&&(h-=this.size.nt/2,r-=this.size.at/2),Rect2D.ns(i,s,h,r,this.size.nt,this.size.at)&&this.Ch==ButtonView.gh){this.Ch=ButtonView.wh,EventBus.d.Li(this.m);var n=this;return this.xh=setTimeout(function(){n.Ch=ButtonView.gh},150),void(t.ts=!0)}super.A(t,i,s)}}}class CastCommandState{static get Vh(){return 0}static get Dh(){return 1}static get bh(){return 2}static get Mh(){return 3}constructor(t,i){this.Eh=CastCommandState.Vh,this.Ah=0,this.Nh=0,this.Ih=0,this.Ph=t,this.Fh=i,this.Rh=t._h||"",this.Bh=t.Oh||0}kh(){if(this.Eh==CastCommandState.Dh){var t=CastWorldModel.T();if(t.Lh(this.Fh)){if(this.Fh.Wh(CastCommandTime.T()),0!=this.Bh){var i=this.Fh.Jh(this.Rh);if(this.Bh>0&&this.Bh>i)return void this.zh()}var s=CastCommandTime.T();if(this.Ah=s,this.Fh.Uh().Gh(this.Ph.Hh(),this.Fh)){for(var e=!1,h=0;h<this.Ph.qh();h++){var r=new CastEffect;r.jh(this,h,this.Fh,!1),t.Kh(this.Fh,r,this.Fh.Uh(),s),e=!0}e&&0!=this.Bh&&this.Fh.Yh(this.Rh,-1*this.Bh,null),this.Ph.Qh>0?this.Xh():this.zh()}else this.zh()}}}Xh(){this.Eh=CastCommandState.bh,this.Fh.Zh(CastCommandTime.T()),this.$h(this.Ph.tr)}ir(){this.Eh==CastCommandState.bh&&CastWorldModel.T().Lh(this.Fh)&&(this.Fh.sr(CastCommandTime.T()),this.zh())}er(){this.Fh.Uh().hr();for(var t=0;t<this.Ph.rr();t++){var i=new CastEffect;i.jh(this,t,this.Fh,!0),CastWorldModel.T().Kh(this.Fh,i,this.Fh.Uh(),CastCommandTime.T())}}zh(){this.Eh=CastCommandState.Mh,this.$h(this.Ph.nr)}ar(){if(this.Eh==CastCommandState.Mh){var t=CastCommandTime.T();this.Ah=t,this.Eh=CastCommandState.Vh}}$h(t){CastCommandScheduler.T().or(this.cr.bind(this),t)}ur(){CastCommandScheduler.T().lr(this.cr.bind(this))}dr(){return this.Ph?this.Ph.dr():null}fr(){return 0==this.Ih||this.Fh.Jh(this.Rh)>=this.Bh}vr(){return this.Eh==CastCommandState.Dh}mr(){if(this.Eh==CastCommandState.Dh){var t=CastCommandTime.T()-this.Ah;return t>this.Ph.pr&&(t=this.Ph.pr),t<0&&(t=0),t/this.Ph.pr}return 0}gr(){return this.Eh==CastCommandState.bh}wr(){if(this.Eh==CastCommandState.bh){var t=CastCommandTime.T()-this.Ah;return t>this.Ph.Qh&&(t=this.Ph.Qh),t<0&&(t=0),t/this.Ph.Qh}return 0}Cr(){return this.Eh==CastCommandState.Mh}Sr(){if(this.Eh==CastCommandState.Mh){var t=CastCommandTime.T()-this.Ah;return t>this.Ph.nr&&(t=this.Ph.nr),t<0&&(t=0),t/this.Ph.nr}return 0}Tr(){return this.Eh==CastCommandState.Vh}Hh(){return this.Ph?this.Ph.Hh():0}xr(t){return(t=t||"")?this.Ph.yr[t]||{}:this.Ph.yr}Vr(){return!!this.Tr()&&(this.Eh=CastCommandState.Dh,this.Ah=CastCommandTime.T(),this.Nh=0,this.Fh.Dr(CastCommandTime.T(),this.xr("startCast")),0==this.Ph.pr?this.cr(0):this.$h(this.Ph.pr),!0)}cr(t){var i=CastCommandTime.T()-this.Ah;if(this.Eh==CastCommandState.Dh)i>=this.Ph.pr?this.kh():console.o("shouldnt happen, cast time");else if(this.Eh==CastCommandState.bh){i>this.Ph.Qh&&(i=this.Ph.Qh);for(var s=i/this.Ph.tr-this.Nh,e=0;e<s;e++)this.er(),this.Nh++;i>=this.Ph.Qh?this.ir():this.$h(this.Ph.tr)}else this.Eh==CastCommandState.Mh&&(i>=this.Ph.nr?this.ar():console.o("shouldnt happen, cooldown time"))}}class CastCommandModel{constructor(t){var i=t;this.name=i.name||"effectName",this.pr=i.pr||0,this.Qh=i.Qh||0,this.tr=i.tr||1,this.br=i.br||0,this.Mr=i.Mr||0,this.Er=i.Ar||!1,this.Nr=i.Nr||!1,this.nr=i.nr||0,this.Ir=i.Ir||0,this.Pr=0,this.yr=i}Fr(){return this.Qh>0}Rr(){return this.pr<=0}rr(){return this.yr._r.length}Br(t){return this.yr._r[t]}qh(){return this.yr.Or.length}kr(t){return this.yr.Or[t]}Hh(){return this.Mr}dr(){return this.name}}class CastCommandScheduler{static T(){return CastCommandScheduler.Lr||(CastCommandScheduler.Lr=new CastCommandScheduler),CastCommandScheduler.Lr}constructor(){this.Wr={},this.Jr=0}or(t,i){var s=CastCommandTime.T()+i;this.Wr.hasOwnProperty(s)?this.Wr[s].push(t):this.Wr[s]=[t]}lr(t){delete this.Wr[t]}C(){var t=CastCommandTime.T();if(t!=this.Jr){this.Jr=t;var i=[];for(var s in this.Wr)if(s<=t)for(var e of(i.push(s),this.Wr[s]))e();for(var h=0;h<i.length;h++)delete this.Wr[i[h]]}}}CastCommandScheduler.Lr=null;class CastEffectType{static get zr(){return"DAMAGE_STAT"}static get Gr(){return"SUPPRESS_STAT"}static get Ur(){return"HEAL_STAT"}static get Hr(){return"BUFF_STAT"}static get qr(){return"SEND_EVENT"}}class CastEffect{constructor(){this.jr=CastEffectType.zr,this.Kr=0,this.Yr=0,this.Qr=0,this.Xr=0,this.Zr=!1,this.$r=!1,this.tn=!1,this.in="",this.sn="",this.en="",this.hn="",this.rn=0,this.nn=0,this.an=null,this.on=null,this.Ph=null,this.cn=null,this.un=0}s(){this.ln()}dn(t){this.$r=!0;var i=t.fn(),s=t.vn(),e=t.un,h=t.Zr;this.jh(i,e,s,h)}jh(t,i,s,e){this.cn=t,this.Ph=t.Ph,this.un=i,this.Zr=e;var h=this.xr();h.hasOwnProperty("name")?this.in=h.name.mn():this.in=this.Ph.dr();var r=h.pn||"damage";if("damage"==r?this.jr=CastEffectType.zr:"heal"==r?this.jr=CastEffectType.Ur:"buff"==r?this.jr=CastEffectType.Hr:"debuff"==r?this.jr=CastEffectType.Gr:"event"==r&&(this.jr=CastEffectType.qr),this.on=s,this.tn=h.gn||!1,this.sn=h.wn||"",this.en=h.Cn||"",this.nn=h.Sn||0,h.Tn){var n=this.on.Jh(h.Tn);if(void 0==n)console.o("entity does not define value stat "+h.Tn);else{var a=h.xn;this.nn+=n*a}}this.Yr=h.yn||0,this.Qr=h.Vn||this.Qr}ks(t){CastWorldModel.T().Lh(t)&&(this.an=t)}Dn(){this.jr==CastEffectType.Hr||this.jr==CastEffectType.Gr||this.jr==CastEffectType.qr?this.bn():(this.rn=0,CastCommandScheduler.T().or(this.Mn.bind(this),this.Qr))}En(){return this.Yr/this.Qr+1}dr(){return this.in}An(){return this.jr}Nn(){return this.Kr}Uh(){return this.an}In(){return this.on}Pn(){return this.Yr}fn(){return this.cn}vn(){return this.on}Fn(t){return t-this.Yr}Rn(){return this.jr==CastEffectType.Hr||this.jr==CastEffectType.Ur}_n(){this.$r=!0;var t=parent.cn,i=parent.on,s=parent.un,e=parent.Zr;this.jh(t,s,i,e)}Bn(){return this.xr().On("returnEffect")}kn(){return this.tn}Ln(){return this.Ph.yr.br||0}Mn(t){if(CastWorldModel.T().Lh(this.an)){var i=CastCommandTime.T()-this.Kr;if(i>this.Yr&&(i=this.Yr),this.jr==CastEffectType.Gr||this.jr==CastEffectType.Hr)i==this.Yr&&(CastCommandScheduler.T().lr(this.Mn.bind(this)),this.jr==CastEffectType.Hr?this.an.Wn(this.en,-1*this.nn,this):this.an.Wn(this.en,this.nn,this),this.an.Jn(this));else{for(var s=i/this.Qr-this.rn,e=0;e<s;e++)this.bn(),this.rn++;i>=this.Yr&&(this.an.Jn(this),this.ln())}}}ln(){CastCommandScheduler.T().lr(this.Mn.bind(this))}bn(){var t=CastWorldModel.T();if(t.Lh(this.an)){0==this.Kr&&(this.Kr=CastCommandTime.T());var i=this.xr();switch(i.hasOwnProperty("react")&&this.an.zn(i.Gn,this),this.jr){case CastEffectType.zr:this.an.Yh(this.en,-1*this.nn,this);break;case CastEffectType.Ur:this.an.Yh(this.en,this.nn,this);break;case CastEffectType.Gr:this.an.Un(this.en,-1*this.nn,this),CastCommandScheduler.T().or(this.Mn.bind(this),this.Yr);break;case CastEffectType.Hr:this.an.Un(this.en,this.nn,this),CastCommandScheduler.T().or(this.Mn.bind(this),this.Yr);break;case CastEffectType.qr:this.an.Hn(this.in,this);break;default:console.log("TODO: handle effect type "+this.jr)}if(i.On("returnEffect")){if(i=i.qn,!t.Lh(this.on))return;var s=new CastEffect;s._n(this),s.nn=this.nn;var e=this.an,h=this.on,r=new CastTarget;r.jn(h),t.Kh(e,s,r,CastCommandTime.T()),r=null}}}xr(t){return null==this.Ph||this.un<0?{}:t?i[t]||{}:(i=this.Zr?this.Ph.Br(this.un):this.Ph.kr(this.un),this.$r&&(i=i.qn||{}),i);var i}ii(){var t=new CastEffect;return t.jr=this.jr,t.Kr=this.Kr,t.Yr=this.Yr,t.Qr=this.Qr,t.sn=this.sn,t.en=this.en,t.hn=this.hn,t.rn=this.rn,t.nn=this.nn,t.an=this.an,t.on=this.on,t.Ph=this.Ph,t.cn=this.cn,t.un=this.un,t.Zr=this.Zr,t.$r=this.$r,t.in=this.in,t}}class ICastEntity{constructor(){CastWorldModel.T().Kn(this)}s(){CastWorldModel.T().Yn(this)}Qn(t,i,s){}Yh(t,i,s){}Un(t,i,s){}Wn(t,i,s){}Jh(t){return 0}Uh(){return null}zn(t,i){}Hn(t,i){}Xn(t){}Jn(t){}Dr(t,i){}Zh(t,i){}Wh(t){}sr(t){}}class CastTargetType{static get Zn(){return 0}static get $n(){return 1}static get ta(){return 2}}class CastTarget{constructor(t){t=t||CastTargetType.Zn,this.jr=t,this.ia=new Vec2D,this.sa=[]}ea(){return this.sa}An(){return this.jr}ha(){this.sa.length=0}jn(t){t&&(this.jr=CastTargetType.Zn,this.sa.push(t))}ra(t){this.ia=t}hr(){for(var t=CastWorldModel.T(),i=this.sa.length-1;i>=0;i--)t.Lh(this.sa[i])||this.sa.splice(i,1)}Gh(t,i){var s=t*t;if(this.jr==CastTargetType.Zn){for(var e=!1,h=CastWorldModel.T(),r=this.sa.length-1;r>=0;r--)if(h.Lh(this.sa[r])){if(!e){var n=this.sa[r],a=h.aa().na(i,n);a&&a.oa()<=s&&(e=!0)}}else this.sa.splice(r,1);return e}return!0}ca(){return this.jr!=CastTargetType.Zn||(this.hr(),this.sa.length>0)}}class CastEffectPath{constructor(){this.Ws=0,this.ua=0,this.from=null,this.la=null,this.da=new Vec2D,this.yt=0,this.fa=[]}}class CastWorldModel{static T(){return CastWorldModel.Lr||(CastWorldModel.Lr=new CastWorldModel),CastWorldModel.Lr}constructor(){this.va={},this.ma=[],this.pa=null}Kn(t){this.va[t]=t}Yn(t){this.va[t]&&delete this.va[t]}ga(t){this.pa=t}aa(){return this.pa}Kh(t,i,s,e){var h=i.Ln();if(0!=h)if(s.An()==CastTargetType.Zn){var r=new CastEffectPath;r.from=t,r.yt=0,r.ua=h,r.Ws=e;for(var n=s.ea(),a=0;a<n.length;a++){var o=n[a];CastWorldModel.T().Lh(t)&&(CastWorldModel.T().Lh(o)&&(console.log("add effect in transit"),r.la=o,r.fa.push(i)))}this.ma.push(r)}else console.et("non-entity target type not yet implemented");else this.wa(t,i,s,e)}wa(t,i,s,e){if(s.An()==CastTargetType.Zn){var h=new CastEffectPath;h.from=t,h.yt=0,h.ua=0,h.Ws=e;for(var r=s.ea(),n=0;n<r.length;n++){var a=r[n];CastWorldModel.T().Lh(t)&&(CastWorldModel.T().Lh(a)&&(h.la=a,h.fa.push(i)))}this.Ca(h),i=null}else console.et("non-entity target type not yet implemented")}Ca(t){for(var i=CastCommandTime.T(),s=0;s<t.fa.length;s++){var e=t.fa[s],h=[];if(null!=t.la){if(CastWorldModel.T().Lh(t.la)&&(h.push(t.la),e.kn())){var r=e.xr("aoeRadius"),n=this.pa.Sa(t.la,n);n&&(console.log("possible bug here -- add targets dont overwrite it?"),h=this.pa.Ta(n,r))}}else h=this.pa.Ta(t.da,t.yt);for(var a={},o=0;o<h.length;o++){var c=h[o];if(!a[c]){a[c]=c;var u=e;o>0&&(u=e.ii()),u.ks(c),u.Kr=i,c.Xn(u)}}}}xa(t){var i=[];CastCommandTime.ya(t);for(var s=CastCommandTime.T(),e=0;e<this.ma.length;e++){var h=this.ma[e],r=1/h.ua;s-h.Ws>=r&&(this.Ca(h),i.push(e));for(e=i.length-1;e>=0;e--){for(var n=this.ma[e].fa.length-1;n>=0;n--)this.ma[e].fa[n]=null;this.ma[e].fa.length=0,this.ma.splice(e,1)}}CastCommandScheduler.T().C()}Lh(t){return!!this.va[t]}}CastWorldModel.Lr=null;class CastCommandTime{static T(){return CastCommandTime.Va}static ya(t){return CastCommandTime.Va+=t,CastCommandTime.Va}static Da(t){return CastCommandTime.Va=t,CastCommandTime.Va}}CastCommandTime.Va=0;class ICastPhysics{na(t,i){return null}Sa(t){return null}Ta(t,i,s){return null}}class EventBus{constructor(t){this.ba={},this.Ma=t,this.Ea=!0}s(){for(var t of this.ba)this.Aa(t)}f(t,i){t in this.ba||(this.ba[t]=[]),this.ba[t].push(i)}w(t,i){if(t in this.ba){var s=this.ba[t].indexOf(i);this.ba[t].splice(s,1)}}Aa(t){this.ba[t]=[]}Li(t,i){("string"==typeof t||t instanceof String)&&(t={Wi:t}),t.Wi?(this.Ea&&!i&&console.log("EB["+this.Ma+"] "+t.Wi+":%O",t),this.ba[t.Wi]&&this.ba[t.Wi].forEach(function(i,s,e){i(t)})):console.log("abort dispatch event -- no evtName %O",t)}static T(t){return this.Na||(this.Na={}),this.Na[t]||(this.Na[t]=new EventBus(t)),this.Na[t]}static get Ia(){return this.T("game")}static get d(){return this.T("ui")}static get lh(){return this.T("sfx")}}exports.Pa=EventBus,function(t){if("object"==typeof module&&"object"==typeof module.Fa)module.Fa=t();else if("function"==typeof define&&define.Ra)define([],t);else{var i=t();window._a=i._a,window.Ba=i.Ba}}(function(){function t(t){for(var i=t,s=[];i.J;)s.unshift(i),i=i.J;return s}var i={search:function(s,e,r,n){s.Oa();var a=(n=n||{}).ka||i.Wa.La,o=n.Ja||!1,c=new h(function(t){return t.za}),u=e;for(e.Et=a(e,r),s.Ga(e),c.push(e);c.size()>0;){var l=c.pop();if(l===r)return t(l);l.Ua=!0;for(var d=s.Ha(l),f=0,v=d.length;f<v;++f){var m=d[f];if(!m.Ua&&!m.qa()){var p=l.ja+m.Ka(l),g=m.Ya;(!g||p<m.ja)&&(m.Ya=!0,m.J=l,m.Et=m.Et||a(m,r),m.ja=p,m.za=m.ja+m.Et,s.Ga(m),o&&(m.Et<u.Et||m.Et===u.Et&&m.ja<u.ja)&&(u=m),g?c.Qa(m):c.push(m))}}}return o?t(u):[]},Wa:{La:function(t,i){return Math.abs(i.nt-t.nt)+Math.abs(i.at-t.at)},Xa:function(t,i){var s=Math.sqrt(2),e=Math.abs(i.nt-t.nt),h=Math.abs(i.at-t.at);return 1*(e+h)+(s-2)*Math.min(e,h)}},Za:function(t){t.za=0,t.ja=0,t.Et=0,t.Ya=!1,t.Ua=!1,t.J=null}};function s(t,i){i=i||{},this.$a=[],this.Xa=!!i.Xa,this.to=[];for(var s=0;s<t.length;s++){this.to[s]=[];for(var h=0,r=t[s];h<r.length;h++){var n=new e(s,h,r[h]);this.to[s][h]=n,this.$a.push(n)}}this.jh()}function e(t,i,s){this.nt=t,this.at=i,this.io=s}function h(t){this.so=[],this.eo=t}return s.prototype.jh=function(){this.ho=[];for(var t=0;t<this.$a.length;t++)i.Za(this.$a[t])},s.prototype.Oa=function(){for(var t=0;t<this.ho.length;t++)i.Za(this.ho[t]);this.ho=[]},s.prototype.Ga=function(t){this.ho.push(t)},s.prototype.Ha=function(t){var i=[],s=t.nt,e=t.at,h=this.to;return h[s-1]&&h[s-1][e]&&i.push(h[s-1][e]),h[s+1]&&h[s+1][e]&&i.push(h[s+1][e]),h[s]&&h[s][e-1]&&i.push(h[s][e-1]),h[s]&&h[s][e+1]&&i.push(h[s][e+1]),this.Xa&&(h[s-1]&&h[s-1][e-1]&&i.push(h[s-1][e-1]),h[s+1]&&h[s+1][e-1]&&i.push(h[s+1][e-1]),h[s-1]&&h[s-1][e+1]&&i.push(h[s-1][e+1]),h[s+1]&&h[s+1][e+1]&&i.push(h[s+1][e+1])),i},s.prototype.toString=function(){for(var t=[],i=this.to,s=0;s<i.length;s++){for(var e=[],h=i[s],r=0;r<h.length;r++)e.push(h[r].io);t.push(e.join(" "))}return t.join("\n")},e.prototype.toString=function(){return"["+this.nt+" "+this.at+"]"},e.prototype.Ka=function(t){return t&&t.nt!=this.nt&&t.at!=this.at?1.41421*this.io:this.io},e.prototype.qa=function(){return 0===this.io},h.prototype={push:function(t){this.so.push(t),this.ro(this.so.length-1)},pop:function(){var t=this.so[0],i=this.so.pop();return this.so.length>0&&(this.so[0]=i,this.no(0)),t},ao:function(t){var i=this.so.indexOf(t),s=this.so.pop();i!==this.so.length-1&&(this.so[i]=s,this.eo(s)<this.eo(t)?this.ro(i):this.no(i))},size:function(){return this.so.length},Qa:function(t){this.ro(this.so.indexOf(t))},ro:function(t){for(var i=this.so[t];t>0;){var s=(t+1>>1)-1,e=this.so[s];if(!(this.eo(i)<this.eo(e)))break;this.so[s]=i,this.so[t]=e,t=s}},no:function(t){for(var i=this.so.length,s=this.so[t],e=this.eo(s);;){var h,r=t+1<<1,n=r-1,a=null;if(n<i){var o=this.so[n];(h=this.eo(o))<e&&(a=n)}if(r<i){var c=this.so[r];this.eo(c)<(null===a?e:h)&&(a=r)}if(null===a)break;this.so[t]=this.so[a],this.so[a]=s,t=a}}},{_a:i,Ba:s}}),function(){var t=[];(window.oo=function(i){var s=this;i=i||{},s.co=i.Pi||null,s.uo=s.co?s.co.lo("2d"):null,s.do=i.nt||0,s.fo=i.at||0,s.vo=i.mo||0,s.po=i.go||0,s.wo=i.Co||14,s.So=i.To||"Arial",s.xo=i.yo||"#000",s.Vo=i.Do||"#bfbebd",s.bo=i.Mo||"normal",s.Eo=i.Ao||"normal",s.No=i.Io||"",s.Po=i.Fo||0,s.Ro=i._o||0,s.Bo=i.Oo||0,s.ko=i.Lo||!1,s.Wo=i.Jo||null,s.zo=i.ui||150,s.Go=i.li||s.wo,s.Uo=i.Fi>=0?i.Fi:5,s.Ho=i.qo>=0?i.qo:1,s.jo=i.Ko||"#959595",s.Yo=i.Ri>=0?i.Ri:3,s.Qo=i.Xo||"",s.Zo=i._i||"1px 1px 0px rgba(255, 255, 255, 1)",s.$o=i.Bi||"0px 0px 4px rgba(0, 0, 0, 0.4)",s.tc=i.ic||"rgba(179, 212, 253, 0.8)",s.sc=i.ec||"",s.hc=(i.Ji||s.sc)+"",s.rc=i.ki||function(){},s.nc=i.Be||function(){},s.ac=i.ws||function(){},s.oc=i.cc||function(){},s.uc=i.lc||function(){},s.dc=!1,s.fc=0,s.vc=!1,s.mc=[0,0],s.pc=!1,s._i(s.Zo,!0),s.gc(),s.wc=document.Cc("canvas"),s.wc.Sc("width",s.Tc),s.wc.Sc("height",s.xc),s.yc=s.wc.lo("2d"),s.Vc=document.Cc("canvas"),s.Vc.Sc("width",s.zo+2*s.Uo),s.Vc.Sc("height",s.Go+2*s.Uo),s.Dc=s.Vc.lo("2d"),void 0!==i.bc?(s.Mc=s.yc.Ec(0,0,0,s.xc),s.Mc.Ac(0,i.bc[0]),s.Mc.Ac(1,i.bc[1])):s.Mc=i.Nc||"#fff",s.co&&(s.co.Ic("mousemove",function(t){t=t||window.Vi,s.Pc(t,s)},!1),s.co.Ic("mousedown",function(t){t=t||window.Vi,s.Fc(t,s)},!1),s.co.Ic("mouseup",function(t){t=t||window.Vi,s.Rc(t,s)},!1)),window.Ic("mouseup",function(t){t=t||window.Vi,s.vc&&!s._c&&s.Bc()},!0),s.Oc=document.Cc("input"),s.Oc.kc="text",s.Oc.Wc.Lc="absolute",s.Oc.Wc.Jc=0,s.Oc.Wc.zc="none",s.Oc.Wc.ke=s.do+s.vo+(s.co?s.co.Le:0)+"px",s.Oc.Wc.Je=s.fo+s.po+(s.co?s.co.ze:0)+"px",s.Oc.Wc.ui=s.zo+"px",s.Oc.Wc.li=s.Go+"px",s.Oc.Wc.Gc=0,s.Wo&&(s.Oc.Uc=s.Wo),document.qc.Hc(s.Oc),s.Oc.Ji=s.hc,s.Oc.Ic("keydown",function(t){t=t||window.Vi,s.vc&&s.gs(t,s)}),s.Oc.Ic("keyup",function(t){t=t||window.Vi,s.hc=s.Oc.Ji,s.fc=s.Oc.jc,s.mc=[s.Oc.jc,s.Oc.Kc],s.Yc(),s.vc&&s.ac(t,s)}),t.push(s),s.Qc=t.length-1,s.Yc()}).prototype={Pi:function(t){return void 0!==t?(this.co=t,this.uo=this.co.lo("2d"),this.Yc()):this.co},nt:function(t){return void 0!==t?(this.do=t,this.Yc()):this.do},at:function(t){return void 0!==t?(this.fo=t,this.Yc()):this.fo},mo:function(t){return void 0!==t?(this.vo=t,this.Yc()):this.vo},go:function(t){return void 0!==t?(this.po=t,this.Yc()):this.po},Co:function(t){return void 0!==t?(this.wo=t,this.Yc()):this.wo},To:function(t){return void 0!==t?(this.So=t,this.Yc()):this.So},yo:function(t){return void 0!==t?(this.xo=t,this.Yc()):this.xo},Do:function(t){return void 0!==t?(this.Vo=t,this.Yc()):this.Vo},Mo:function(t){return void 0!==t?(this.bo=t,this.Yc()):this.bo},Ao:function(t){return void 0!==t?(this.Eo=t,this.Yc()):this.Eo},Io:function(t){return void 0!==t?(this.No=t,this.Yc()):this.No},Fo:function(t){return void 0!==t?(this.Po=t,this.Yc()):this.Po},_o:function(t){return void 0!==t?(this.Ro=t,this.Yc()):this.Ro},Oo:function(t){return void 0!==t?(this.Bo=t,this.Yc()):this.Bo},ui:function(t){return void 0!==t?(this.zo=t,this.gc(),this.Xc(),this.Yc()):this.zo},li:function(t){return void 0!==t?(this.Go=t,this.gc(),this.Xc(),this.Yc()):this.Go},Fi:function(t){return void 0!==t?(this.Uo=t,this.gc(),this.Xc(),this.Yc()):this.Uo},qo:function(t){return void 0!==t?(this.Ho=t,this.gc(),this.Xc(),this.Yc()):this.Ho},Ko:function(t){return void 0!==t?(this.jo=t,this.Yc()):this.jo},Ri:function(t){return void 0!==t?(this.Yo=t,this.Yc()):this.Yo},Nc:function(t){return void 0!==t?(this.Mc=t,this.Yc()):this.Mc},bc:function(t){return void 0!==t?(this.Mc=this.yc.Ec(0,0,0,this.xc),this.Mc.Ac(0,t[0]),this.Mc.Ac(1,t[1]),this.Yc()):this.Mc},_i:function(t,i){if(void 0===t)return this.Zo;var s=t.split("px ");return this.Zo={nt:"none"===this.Zo?0:parseInt(s[0],10),at:"none"===this.Zo?0:parseInt(s[1],10),Bc:"none"===this.Zo?0:parseInt(s[2],10),Zc:"none"===this.Zo?"":s[3]},this.Zo.nt<0?(this.$c=Math.abs(this.Zo.nt)+this.Zo.Bc,this.tu=this.Zo.Bc+this.Zo.nt):(this.$c=Math.abs(this.Zo.Bc-this.Zo.nt),this.tu=this.Zo.Bc+this.Zo.nt),this.Zo.at<0?(this.iu=Math.abs(this.Zo.at)+this.Zo.Bc,this.su=this.Zo.Bc+this.Zo.at):(this.iu=Math.abs(this.Zo.Bc-this.Zo.at),this.su=this.Zo.Bc+this.Zo.at),this.eu=this.$c+this.tu,this.hu=this.iu+this.su,this.gc(),i?void 0:(this.Xc(),this.Yc())},Bi:function(t){return void 0!==t?(this.$o=t,this.Yc()):this.$o},ic:function(t){return void 0!==t?(this.tc=t,this.Yc()):this.tc},ec:function(t){return void 0!==t?(this.sc=t,this.Yc()):this.sc},Ji:function(t){return void 0!==t?(this.hc=t+"",this.Oc.Ji=t+"",this.fc=this.ru().length,this.Yc(),this):this.hc===this.sc?"":this.hc},ki:function(t){if(void 0!==t)return this.rc=t,this;this.rc()},Be:function(t){if(void 0!==t)return this.nc=t,this;this.nc()},ws:function(t){if(void 0!==t)return this.ac=t,this;this.ac()},nu:function(i){var s=this;if(!s.vc){s.oc(s);for(var e=0;e<t.length;e++)t[e].vc&&t[e].Bc()}if(s.au?delete s.au:s.mc=[0,0],s.vc=!0,!s.ko){s.Oc.ou=!1,s.fc="number"==typeof i?i:s.ru().length,s.sc===s.hc&&(s.hc="",s.Oc.Ji=""),s.dc=!0,s.cu&&clearInterval(s.cu),s.cu=setInterval(function(){s.dc=!s.dc,s.Yc()},500);var h=s.mc[0]>0||s.mc[1]>0;return s.Oc.nu(),s.Oc.jc=h?s.mc[0]:s.fc,s.Oc.Kc=h?s.mc[1]:s.fc,s.Yc()}s.Oc.ou=!0},Bc:function(t){var i=t||this;return i.uc(i),i.cu&&clearInterval(i.cu),i.vc=!1,i.dc=!1,i.mc=[0,0],i.Oc.Bc(),""===i.hc&&(i.hc=i.sc),i.Yc()},gs:function(i,s){var e=i.Ue;i.uu;if(!s.ko&&s.vc){if(s.nc(i,s),65===e&&(i.lu||i.du))return s.fu(),i.vu(),s.Yc();if(17===e||i.du||i.lu)return s;if(13===e)i.vu(),s.rc(i,s);else if(9===e&&(i.vu(),t.length>1)){var h=t[s.Qc+1]?s.Qc+1:0;s.Bc(),setTimeout(function(){t[h].nu()},10)}return s.hc=s.Oc.Ji,s.fc=s.Oc.jc,s.mc=[0,0],s.Yc()}},mu:function(t,i){var s=i.pu(t),e=s.nt,h=s.at;return i.gu?(delete i.gu,void delete i.au):i.co&&i.wu(e,h)||!i.co?i._c?(i._c=!1,i.mu(t,i),i.nu(i.Cu(e,h))):void 0:i.Bc()},Pc:function(t,i){var s=i.pu(t),e=s.nt,h=s.at,r=i.wu(e,h);if(r&&i.co?(i.co.Wc.Su="text",i.pc=!0):i.pc&&i.co&&(i.co.Wc.Su="default",i.pc=!1),i.vc&&i.Tu>=0){var n=i.Cu(e,h),a=Math.min(i.Tu,n),o=Math.max(i.Tu,n);if(!r)return i.au=!0,i.gu=!0,delete i.Tu,void i.Yc();i.mc[0]===a&&i.mc[1]===o||(i.mc=[a,o],i.Yc())}},Fc:function(t,i){var s=i.pu(t),e=s.nt,h=s.at,r=i.wu(e,h);i._c=r,i.vc&&r&&(i.Tu=i.Cu(e,h))},Rc:function(t,i){var s=i.pu(t),e=s.nt,h=s.at,r=i.Cu(e,h)!==i.Tu;i.vc&&i.Tu>=0&&i.wu(e,h)&&r?(i.au=!0,delete i.Tu,i.Yc()):delete i.Tu,i.mu(t,i)},fu:function(t){var i=this;t=t||[0,i.hc.length];return setTimeout(function(){i.mc=[t[0],t[1]],i.Oc.jc=t[0],i.Oc.Kc=t[1],i.Yc()},1),i},xu:function(){return this.wc},Yc:function(){},Gi:function(t,i){var s=this,e=s.yc,h=s.Tc,r=s.xc,n=s.Yo,a=s.Ho,o=s.eu,c=s.hu;e&&(e.yu=s.Zo.nt,e.Vu=s.Zo.at,e.Du=s.Zo.Bc,e.bu=s.Zo.Zc,s.Ho>0&&(e.Vt=s.jo,s.Mu(e,s.$c,s.iu,h-o,r-c,n),e.fill(),e.yu=0,e.Vu=0,e.Du=0),s.Eu(function(){e.yu=0,e.Vu=0,e.Du=0;var u=s.ru(),l=s.Uo+s.Ho+s.iu;if(s.mc[1]>0){var d=s.Au(u.substring(0,s.mc[0])),f=s.Au(u.substring(s.mc[0],s.mc[1]));e.Vt=s.tc,e.Nu(l+d,l,f,s.Go)}if(s.dc){var v=s.Au(u.substring(0,s.fc));e.Vt=s.xo,e.Nu(l+v,l,1,s.Go)}var m=s.Uo+s.Ho+s.$c,p=Math.round(l+s.Go/2);u=""===u&&s.sc?s.sc:u,e.Vt=""!==s.hc&&s.hc!==s.sc?s.xo:s.Vo,e.Iu=s.Eo+" "+s.bo+" "+s.wo+"px "+s.So,e.bu=s.No,e.Du=s.Po,e.yu=s.Ro,e.Vu=s.Bo,e.Pu="left",e.Fu="middle",e.Ru(u,m,p);var g=s.$o.split("px "),w="none"===s.$o?0:parseInt(g[0],10),C="none"===s.$o?0:parseInt(g[1],10),S="none"===s.$o?0:parseInt(g[2],10),T="none"===s.$o?"":g[3];if(S>0){var x=s.Dc,y=x.Pi.ui,V=x.Pi.li;x._u(0,0,y,V),x.Du=S,x.bu=T,x.yu=0,x.Vu=C,x.Nu(-1*h,-100,3*h,100),x.yu=w,x.Vu=0,x.Nu(y,-1*r,100,3*r),x.yu=0,x.Vu=C,x.Nu(-1*h,V,3*h,100),x.yu=w,x.Vu=0,x.Nu(-100,-1*r,100,3*r),s.Mu(e,a+s.$c,a+s.iu,h-2*a-o,r-2*a-c,n),e.Bu(),e.di(s.Vc,0,0,y,V,a+s.$c,a+s.iu,y,V)}return s.uo&&s.uo.di(s.wc,t,i),s}))},Ht:function(){var i=t.indexOf(this);-1!=i&&t.splice(i,1),this.vc&&this.Bc(),document.qc.Ts(this.Oc),this.wc=null,this.Vc=null,this.yc=null},Eu:function(t){var i=this,s=i.yc,e=i.Tc,h=i.xc,r=i.Yo,n=i.Ho,a=i.eu,o=i.hu;if(""===i.Qo)s.Vt=i.Mc,i.Mu(s,n+i.$c,n+i.iu,e-2*n-a,h-2*n-o,r),s.fill(),t();else{var c=new Image;c.Ou=i.Qo,c.ku=function(){s.di(c,0,0,c.ui,c.li,n+i.$c,n+i.iu,e,h),t()}}},Lu:function(){if(this.mc[1]>0){var t=this.mc[0],i=this.mc[1];return this.hc=this.hc.substr(0,t)+this.hc.substr(i),this.fc=t,this.fc=this.fc<0?0:this.fc,this.mc=[0,0],!0}return!1},ru:function(t){t=void 0===t?this.hc:t;var i=this.Au(t)/(this.zo-this.Uo);return(i>1?t.substr(-1*Math.floor(t.length/i)):t)+""},Au:function(t){var i=this.yc;return i.Iu=this.Eo+" "+this.bo+" "+this.wo+"px "+this.So,i.Pu="left",i.Wu(t).ui},gc:function(){this.Tc=this.zo+2*this.Uo+2*this.Ho+this.eu,this.xc=this.Go+2*this.Uo+2*this.Ho+this.hu},Xc:function(){this.wc.ui,this.wc.li;this.wc.Sc("width",this.Tc),this.wc.Sc("height",this.xc),this.Vc.Sc("width",this.zo+2*this.Uo),this.Vc.Sc("height",this.Go+2*this.Uo),this.uo},Mu:function(t,i,s,e,h,r){e<2*r&&(r=e/2),h<2*r&&(r=h/2),t.Ju(),t.zu(i+r,s),t.Gu(i+e-r,s),t.Uu(i+e,s,i+e,s+r),t.Gu(i+e,s+h-r),t.Uu(i+e,s+h,i+e-r,s+h),t.Gu(i+r,s+h),t.Uu(i,s+h,i,s+h-r),t.Gu(i,s+r),t.Uu(i,s,i+r,s),t.Hu()},wu:function(t,i){var s=t>=this.Oi.nt+this.vo,e=t<=this.Oi.nt+this.vo+this.zo+2*this.Uo,h=i>=this.Oi.at+this.po,r=i<=this.Oi.at+this.po+this.Go+2*this.Uo;return s&&e&&h&&r},Cu:function(t,i){var s=this.hc;this.hc===this.sc&&(s="");var e=this.ru(s),h=0,r=e.length;if(t-(this.Oi.nt+this.vo)<this.Au(e))for(var n=0;n<e.length;n++)if((h+=this.Au(e[n]))>=t-(this.Oi.nt+this.vo)){r=n;break}return r},pu:function(t){var i=t.zs,s=document.ju.qu(i,void 0),e=parseInt(s.Ku,10)||0,h=parseInt(s.Ku,10)||0,r=parseInt(s.Yu,10)||0,n=parseInt(s.Yu,10)||0,a=document.qc.Qu.ze||0,o=document.qc.Qu.Le||0,c=0,u=0;if(void 0!==i.Xu)do{c+=i.Le,u+=i.ze}while(i=i.Xu);return c+=e+r+o,u+=h+n+a,{nt:t.Zu-c,at:t.$u-u}}}}(),function(){var t,i=this;if("function"==typeof i.tl)try{var s=i.tl("crypto").il;t=s&&function(){return s(16)}}catch(t){}if(!t&&i.sl&&crypto.el){var e=new Uint8Array(16);t=function(){return crypto.el(e),e}}if(!t){var h=new Array(16);t=function(){for(var t,i=0;i<16;i++)0==(3&i)&&(t=4294967296*Math.random()),h[i]=t>>>((3&i)<<3)&255;return h}}for(var r="function"==typeof i.hl?i.hl:Array,n=[],a={},o=0;o<256;o++)n[o]=(o+256).toString(16).substr(1),a[n[o]]=o;function c(t,i){var s=i||0,e=n;return e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]}var u=t(),l=[1|u[0],u[1],u[2],u[3],u[4],u[5]],d=16383&(u[6]<<8|u[7]),f=0,v=0;function m(i,s,e){var h=s&&e||0;"string"==typeof i&&(s="binary"==i?new r(16):null,i=null);var n=(i=i||{}).random||(i.rl||t)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,s)for(var a=0;a<16;a++)s[h+a]=n[a];return s||c(n)}var p=m;if(p.nl=function(t,i,s){var e=i&&s||0,h=i||[],r=null!=(t=t||{}).al?t.al:d,n=null!=t.ol?t.ol:(new Date).getTime(),a=null!=t.cl?t.cl:v+1,o=n-f+(a-v)/1e4;if(o<0&&null==t.al&&(r=r+1&16383),(o<0||n>f)&&null==t.cl&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=n,v=a,d=r;var u=(1e4*(268435455&(n+=122192928e5))+a)%4294967296;h[e++]=u>>>24&255,h[e++]=u>>>16&255,h[e++]=u>>>8&255,h[e++]=255&u;var m=n/4294967296*1e4&268435455;h[e++]=m>>>8&255,h[e++]=255&m,h[e++]=m>>>24&15|16,h[e++]=m>>>16&255,h[e++]=r>>>8|128,h[e++]=255&r;for(var p=t.zi||l,g=0;g<6;g++)h[e+g]=p[g];return i||c(h)},p.ul=m,p.parse=function(t,i,s){var e=i&&s||0,h=0;for(i=i||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){h<16&&(i[e+h++]=a[t])});h<16;)i[e+h++]=0;return i},p.ll=c,p.dl=r,"function"==typeof define&&define.Ra)define(function(){return p});else if("undefined"!=typeof module&&module.Fa)module.Fa=p;else{var g=i.fl;p.vl=function(){return i.fl=g,p},i.fl=p}}.call(this);class Graphics{static get ml(){return Service.T("gfx").pl()}constructor(t){this.Pi=document.gl(t),this.Vt="#FF0000",this.Dt="#FFFFFF",this.Pt=1,this.Iu="30px Arial",this.wl=this.Pi.lo("2d"),this.Cl=!!Config&&Config.yh,this.Sl=!!Config&&Config.Sl,this.Ea=!1,Service.r("gfx",this)}y(){return this.Pi.Tl}V(){return this.Pi.xl}pl(){return new Vec2D(this.y(),this.V())}ri(t){this.wl.yl=t}Vl(){return this.wl.Dl}Ms(t){this.wl.Dl=t}oh(t){this.wl=this.Pi.lo("2d"),t&&this.bl()}bl(){this.wl._u(0,0,this.y(),this.V())}Ds(){this.wl.Ml()}Es(){this.wl.El()}bs(t,i){this.wl.bs(t,i)}rs(t,i){i&&(t*=-1),this.wl.rs(t)}O(t){this.wl.O(t,t)}Al(t,i){return""!=t&&(void 0==t?i:t)}Nl(t,i,s,e){this.wl.Vt=this.Vt,this.Ea&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cl&&(t-=s/2,i-=e/2),this.wl.Nu(t,i,s,e)}ai(t,i,s,e,h){this.wl.Vt=h||this.Vt,this.Ea&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cl&&(t-=s/2,i-=e/2),this.wl.Nu(t,i,s,e)}Il(t,i,s,e){this.wl.Dt=this.Dt,this.wl.Pl=this.Pt,this.Ea&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cl&&(t-=s/2,i-=e/2),this.wl.Fl(t,i,s,e)}Rl(t,i,s,e,h,r){this.wl.Dt=h||this.Dt,this.wl.Pl=r||this.Pt,this.Ea&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cl&&(t-=s/2,i-=e/2),this.wl.Fl(t,i,s,e)}oi(t,i,s,e){var h=this.Al(i,this.Vt),r=this.Al(s,this.Dt);this.wl.Vt=h,this.wl.Dt=r,this.wl.Pl=e||this.Pt,this.wl.Ju();var n=t[0];this.wl.zu(n.nt,n.at);for(var a=1;a<t.length;a++)this.wl.Gu(t[a].nt,t[a].at);this.wl.Hu(),h&&this.wl.fill(),r&&this.wl.It()}_l(t,i,s,e){var h=this.Al(i,this.Vt),r=this.Al(s,this.Dt);this.wl.Vt=h,this.wl.Dt=r,this.wl.Pl=e||this.Pt,this.wl.Ju();var n=t[0];this.wl.zu(n[0],n[1]);for(var a=1;a<t.length;a++)this.wl.Gu(t[a][0],t[a][1]);this.wl.Hu(),h&&this.wl.fill(),r&&this.wl.It()}Bl(t,i,s,e){var h=this.Al(i,this.Vt),r=this.Al(s,this.Dt);this.wl.Vt=h,this.wl.Dt=r,this.wl.Pl=e||this.Pt,4==t.length?(this.wl.Ju(),this.wl.zu(t[0].nt,t[0].at),this.wl.Ol(t[1].nt,t[1].at,t[2].nt,t[2].at,t[3].nt,t[3].at),this.wl.Hu(),h&&this.wl.fill(),r&&this.wl.It()):console.et("Graphics.drawCubicBezierEx() - invalid number of verts, must be 4")}kl(t,i,s,e){this.wl.Dt=this.Dt,this.wl.Pl=this.Pt,this.wl.Ju(),this.wl.zu(t,i),this.wl.Gu(s,e),this.wl.It(),this.wl.Hu(),this.Ea&&console.log("line at "+t+","+i+" x "+s+","+e)}Ll(t,i,s,e,h,r){this.wl.Dt=h||this.Dt,this.wl.Pl=r||this.Pt,this.wl.Ju(),this.wl.zu(t,i),this.wl.Gu(s,e),this.wl.It(),this.wl.Hu(),this.Ea&&console.log("line at "+t+","+i+" x "+s+","+e)}Wl(t,i,s){var e=this.Vt,h=this.Dt;this.wl.Vt=e,this.wl.Dt=h,this.wl.Pl=this.Pt,this.wl.Ju(),this.wl.Jl(t,i,s,0,2*Math.PI,!1),this.wl.Hu(),e&&this.wl.fill(),h&&this.wl.It(),this.Ea&&console.log("circle at "+t+","+i+" x "+s)}ni(t,i,s,e,h,r){var n=this.Al(e,this.Vt),a=this.Al(h,this.Dt);this.wl.Vt=n,this.wl.Dt=a,this.wl.Pl=r||this.Pt,this.wl.Ju(),this.wl.Jl(t,i,s,0,2*Math.PI,!1),this.wl.Hu(),n&&this.wl.fill(),a&&this.wl.It()}zl(t,i,s){if(this.wl.Iu=this.Iu,this.wl.Vt=this.Vt,this.Cl){var e=this.wl.Wu(t);i-=e.ui/2,this.Sl&&(s+=(e=this.wl.Wu("M")).ui/2)}this.wl.Ru(t,i,s)}Ei(t,i,s,e,h,r){var n=this.Al(h,this.Vt);if(this.wl.Iu=e||this.Iu,this.wl.Vt=n,r){var a=t.split("\n"),o=1.5*this.wl.Wu("m").ui;for(var c of a){var u=i;if(this.Cl)u-=this.wl.Wu(c).ui/2;this.wl.Ru(c,u,s),s+=o}}else{if(this.Cl){var l=this.wl.Wu(t);i-=l.ui/2,this.Sl&&(s+=(l=this.wl.Wu("M")).ui/2)}this.wl.Ru(t,i,s)}}Ai(t,i,s,e,h,r,n){this.wl.Iu=e||this.Iu;var a=this.Al(h,this.Dt);if(this.wl.Dt=a,this.wl.Pl=r||this.Pt,n){var o=t.split("\n"),c=1.5*this.wl.Wu("m").ui;for(var u of o){var l=i;if(this.Cl)l-=this.wl.Wu(u).ui/2;this.wl.Gl(u,l,s),s+=c}}else{if(this.Cl){var d=this.wl.Wu(t);i-=d.ui/2,this.Sl&&(s+=(d=this.wl.Wu("M")).ui/2)}this.wl.Gl(t,i,s)}}Mi(t,i,s){this.wl.Iu=i||this.Iu;var e=0,h=0;if(s){var r=t.split("\n");for(var n of r){var a=this.wl.Wu(n).ui;a>h&&(h=a),e++}}else e=1,h=this.wl.Wu(t).ui;var o=this.wl.Wu("m").ui*e*1.5;return new Vec2D(h,o)}di(t,i,s){this.Cl&&(i-=t.ui/2,s-=t.li/2),this.wl.di(t,i,s)}fi(t,i,s,e,h,r){r?(this.wl.Ml(),this.wl.O(-1,1),this.wl.di(t,0,0,t.ui,t.li,-1*i-t.ui,s,e,h),this.wl.El()):this.wl.di(t,0,0,t.ui,t.li,i,s,e,h)}Ul(t,i,s,e,h,r,n,a){this.Cl&&(i-=r/2,s-=n/2),a?(this.wl.Ml(),this.wl.O(-1,1),this.wl.di(t,e,h,r,n,-1*i-r,s,r,n),this.wl.El()):this.wl.di(t,e,h,r,n,i,s,r,n)}Hl(t,i,s,e,h,r){this.Cl&&(i-=e/2,s-=h/2),r=r||1;for(var n=t.ui*r,a=t.li*r,o=e/n,c=h/a,u=0;u<c;u++)for(var l=0;l<o;l++)this.wl.di(t,i+l*n,s+u*a,n,a)}}class Sprite{constructor(t){this.ql=t,this.Ks=t.substring(0,t.lastIndexOf("/")+1),this.jl=null,this.Kl=null,this.Yl=!1}Ql(t,i){var s=Service.T("rp");this.Kl=t,this.Xl=t.Xl||"xywh";var e=this,h=this.Ks+t.lt;this.jl=s.ci(h,function(t){e.Yl||(e.jl=t.Ce,e.Yl=!0,e.Ea&&console.log("sprite loaded late: "+h),i&&i())}),this.jl&&(this.Yl=this.jl.Yl,this.Ea&&console.log("sprite loaded immediately: "+h),this.Yl&&i&&i())}y(){return this.Kl.ui-2*this.Zl()}V(){return this.Kl.li-2*this.$l()}Zl(){return this.Kl.td||0}$l(){return this.Kl.id||0}wi(){return this.Kl.le||30}gi(){if("xywh"==this.Xl||"gridSub"==this.Xl)return this.Kl.sd.length;if("grid"==this.Xl){var t=this.Kl.ui,i=this.Kl.li,s=this.jl.ui,e=Math.floor(s/t);return Math.floor(this.jl.li/i)*e}return 0}mi(t,i,s,e,h){if("xywh"==this.Xl){var r=this.Kl.sd[e];t.Ul(this.jl,i-this.Zl(),s-this.$l(),r[0],r[1],r[2],r[3],h)}else if("grid"==this.Xl||"gridSub"==this.Xl){(e<0||e>this.Kl.sd.length)&&console.o("frameIdx OOB"),"gridSub"==this.Xl&&(e=this.Kl.sd[e]);var n=this.Kl.ui,a=this.Kl.li,o=this.jl.ui,c=Math.floor(o/n),u=e%c,l=(e-u)/c;t.Ul(this.jl,i-this.Zl(),s-this.$l(),u*n,l*a,n,a,h)}}}class SpriteBatch{constructor(t){this.name=t,this.ed=".sprite",this.Kl={},this.Yl=!1}pe(t,i){for(var s in this.Kl=t,this.Kl.me)this.hd(s);this.Yl=!0,i()}hd(t){var i=this.Kl.me[t];if(!i)return console.o("sprite batch could not find sprite - "+t),null;for(var s in this.Kl.rd)i.hasOwnProperty(s)||(i[s]=this.Kl.rd[s]);var e=t+this.ed,h=new Sprite(e),r=Service.T("rp");r.me[e]=h,h.Ql(i,()=>{r.nd(e,r.me[e])})}}class JsonManager{static T(){return JsonManager.Lr}constructor(){this.ad={},this.Ea=!0}od(t){if(t.constructor==={}.constructor)for(var i in t)this.ad[i]=t[i],this.Ea&&console.log("loaded json domain "+i)}cd(t,i){this.ad[t]=i}ud(t,i){if(this.ad.hasOwnProperty(t)){if(i){var s=i.split(".");if(1==s.length)return this.ad[t][i];for(var e=this.ad[t],h=0;h<s.length;h++)e.hasOwnProperty(i)&&(e=e[i]);return e}return this.ad[t]}return null}}JsonManager.Lr=new JsonManager;class LoadingState extends AppState{constructor(t){super(),this.t=new LoadingView(t[0],t[1])}}class LoadingView extends BaseStateView{constructor(t,i){super(),this.ld=0,this.dd=t.slice(),this.fd=t.length,this.ld=[],this.vd="",this.md=i,this.Ea=!1,this.pd(5)}pd(t){var i=Service.T("rp");if(this.ld.length!=this.fd){if(0!=this.dd.length){var s=this.dd[0];this.vd=s,this.dd.splice(0,1);var e=this;if("fpql"==this.vd.substr(0,4)){var h=(n=this.vd.split(":"))[1],r=n[2];console.log("LoadingState - quick load fourpoleanim "+h+" "+r),i.gd(h,r,function(t){e.ld.push(s),e.pd(1)})}else if("ql"==this.vd.substr(0,2)){var n;h=(n=this.vd.split(":"))[1],r=n[2];console.log("LoadingState - quick load animation "+h+" "+r),i.wd(h,r,function(t){e.ld.push(s),e.pd(1)})}else{var a=this.vd.substr(this.vd.lastIndexOf(".")+1);switch(this.Ea&&console.log("load in stride "+t+" : "+s),a){case"png":case"PNG":case"bmp":case"BMP":case"jpg":case"JPG":i.Cd(s,function(t){e.ld.push(s),e.pd(1)});break;case"sprite":i.Sd(s,function(t){e.ld.push(s),e.pd(1)});break;case"spb":i.Td(s,function(t){e.ld.push(s),e.pd(1)});break;default:i.ht(s,function(t){e.ld.push(s),e.pd(1)})}}t>0&&this.pd(t-1)}}else this.vd="completed",EventBus.d.Li({Wi:"loadingComplete"}),this.md&&Service.T("state").a(this.md)}F(t,i,s,e){var h=~~(this.ld.length/this.fd*100);t.ai(t.y()/2,t.V()/2,t.y(),t.V(),"#000000"),t.zl("("+h+"%) loading: "+this.vd,t.y()/2,50)}}class MenuView extends TableView{constructor(t,i,s){super(i||0,s||0,!0),t&&this.Th(t)}Th(t){if(t._e){var i=new NodeView;i.Bt(t._e),i.st(),this.re(i)}for(var s in t.xd){var e=t.xd[s],h=new NodeView;h.Bt(e.zt),h.$i(e.p),this.re(h)}var r=t.yd||"rgb(255,255,255)";this.bt(0,0,r),this.R&&(this.Vd=t)}X(t){if(!this.R)return console.o("MenuView - trying to serialize MenuView when seralizable == false"),{};var i=super.X(t);return i.Z="MenuView",i.Gt=this.Vd,i}ht(t){super.ht(t),this.Th(t.Gt)}}class ParticleModel{constructor(){this.b=new Vec2D,this.Dd=new Vec2D,this.bd()}bd(){this.b.x(0,0),this.Dd.x(0,0),this.Ws=0,this.Md=0,this.size=1,this.dt=null,this.Vt="#FF0000"}}class ParticleSystem{constructor(t){this.Jr=0,this.Ed=[],this.Ad=[];for(var i=0;i<t;i++)this.Ed.push(new ParticleModel)}Nd(t,i,s,e){0==this.Jr&&(this.Jr=e);for(var h=e-this.Jr,r=0;r<this.Ad.length;r++){var n=this.Ad[r];if(n.Md<=e)this.Ed.push(n),this.Ad.splice(r,1),n.bd(),r--;else if(n.b.si(n.Dd.Id(h)),n.dt){var a=e-n.Ws,o=Math.floor(a*n.dt.wi())%n.dt.gi();n.dt.mi(t,i+n.b.nt,s+n.b.at,o)}else t.ai(i+n.b.nt,s+n.b.at,n.size,n.size,n.Vt)}}Pd(t,i,s,e,h,r){if(!(this.Ed.length<1)){var n=this.Ed.pop();this.Ad.push(n),n.Ws=h,n.Md=h+r,n.b.x(t,i),n.Dd.x(s,e)}}Fd(t,i,s,e,h,r){if(!(this.Ed.length<1)){var n=this.Ed.pop();this.Ad.push(n),n.Ws=h;var a=r.gi()/r.wi();n.Md=h+a,n.b.x(t,i),n.Dd.x(s,e),n.dt=r}}}class Physics{constructor(){Service.r("physics",this)}Rd(){}nh(){}}class PIDController{constructor(t,i,s,e,h){this.reverse=h||!1,this._d=0,this.Bd=0,this.Od=0,this.kd=e,this.Ld(t,i,s),this.Wd=null,this.Jd=1e-4,this.zd=0,this.Gd=0,this.Ud=0,this.Hd=0,this.qd=0,this.jd=0,this.Kd=0,this.Yd=0,this.Qd=0,this.Xd=0}Zd(t){this.jd=0,this.Ud=0,this.qd=0,this.Hd=0,this.Kd=0,t&&(this.zd=0,this.Gd=0)}Ld(t,i,s){(t<0||i<0||s<0)&&console.log("error, PID constants must be positive!"),this.reverse?(this._d=0-t,this.$d=0-i,this.tf=0-s):(this._d=t,this.$d=i,this.tf=s)}if(t,i){this.Wd=t?{min:t,max:i}:null}sf(t,i,s){if(this.Gd+=s,this.Hd=t,this.qd=i,0==this.zd||this.zd+this.kd<=this.Gd){var e=this.Gd-(this.zd+this.kd),h=Math.floor(e/this.kd);this.zd+=h*this.kd;for(var r=0;r<h;r++)this.Kd=this.ef()}return this.Kd}ef(){var t=this.qd-this.Hd;Math.abs(t)<this.Jd&&(t=0);var i=this.Hd-this.Ud;this.Ud=this.Hd;var s=this._d*t;this.jd+=this.Bd*t,this.jd=this.hf(this.jd);var e=this.jd*this.kd,h=this.Od*i/this.kd;return this.Yd=s,this.Qd=e,this.Xd=h,s+e+h}hf(t){return this.Wd?(t>this.Wd.max?t=this.Wd.max:t<this.Wd.min&&(t=this.Wd.min),t):t}}class PIDFFController extends PIDController{constructor(t,i,s,e,h,r,n){super(t,i,s,r,n),this.rf(t,i,s,e,h)}rf(t,i,s,e,h){(t<0||i<0||s<0||e<0||h<0)&&console.log("error, PIDFF constants must be positive!"),this.reverse?(this._d=0-t,this.$d=0-i,this.tf=0-s,this.nf=0-e,this.af=0-h):(this._d=t,this.$d=i,this.tf=s,this.nf=e,this.af=h)}ef(){var t=this.qd-this.Hd;Math.abs(t)<this.Jd&&(t=0);var i=this.Hd-this.Ud;this.Ud=this.Hd;var s=this._d*t;this.jd+=this.Bd*t,this.jd=this.hf(this.jd);var e=this.jd*this.kd,h=this.Od*i/this.kd;return this.Yd=s,this.Qd=e,this.Xd=h,this.cf=0,this.uf=0,s+e+h+0+0}}class PIDTuneGraph{constructor(t){this.lf=t,this.df=0,this.ff=0,this.vf=[]}mf(t,i,s){2*i>this.df&&(this.df=2*i),this.vf.push({pf:t,gf:i,wf:s})}Cf(t,i,s,e,h,r,n){2*i>this.df&&(this.df=2*i),e>this.ff&&(this.ff=e),h>this.ff&&(this.ff=h),r>this.ff&&(this.ff=r),this.vf.push({pf:t,gf:i,wf:n,Sf:s,Tf:e,xf:h,yf:r})}ce(t,i,s,e,h){t.bs(i,s);var r=this.vf[this.vf.length-1].wf;t.ai(e/2,h/2,e,h,"#FFFFFF"),t.Ll(0,0,0,h,"#000000"),t.Ll(0,h,e,h,"#000000"),t.Ei("0.0",-15,h,"10px Arial","#000000"),t.Ei((this.df/2).toFixed(2),-15,h/2,"10px Arial","#000000"),t.Ei(this.df.toFixed(2),-15,0,"10px Arial","#000000"),t.Ei("0.0",0,h+15,"10px Arial","#000000"),t.Ei((r/2).toFixed(2),e/2,h+15,"10px Arial","#000000"),t.Ei(r.toFixed(2),e,h+15,"10px Arial","#000000");var n=0,a=h,o=h,c=h,u=h,l=h,d=h;for(var f of this.vf){var v=e/r*f.wf,m=h/this.df,p=h/this.ff,g=h-m*f.gf,w=h-m*f.pf,C=h-m*f.Sf,S=h-p*f.Tf,T=h-p*f.xf,x=h-p*f.yf;t.Ll(n,a,v,g,"#FF0000"),t.Ll(n,o,v,w,"#0000FF"),t.Ll(n,c,v,C,"#000000"),t.Ll(n,u,v,S,"#00FF00"),t.Ll(n,l,v,T,"#FFFF00"),t.Ll(n,d,v,x,"#00FFFF"),n=v,a=g,o=w,c=C,u=S,l=T,d=x}t.bs(-i,-s)}}class ResourceProvider{constructor(){this.Vf=new EventBus("RP"),this.Df={},this.bf=0,this.me={},this.Mf=0,this.Ef={},this.Af=0,this.Nf={},this.If=0,this.Pf={},this.Ff={},this.Rf=0,this._f={},this.Bf="",this.Ea=!1,this.Vf.Ea=!1,Service.r("rp",this)}Of(){return this.bf>0||(this.Mf>0||(this.Af>0||(this.If>0||this.Rf>0)))}nd(t,i){this.Vf.Li({Wi:t,kf:"loadComplete",Ce:i}),this.Vf.Aa(t)}ci(t,i){if(this.Df[t]&&this.Df[t].Yl)return i&&i({Wi:t,kf:"loadComplete",Ce:this.Df[t]}),this.Df[t];this.Cd(t,i)}Cd(t,i){var s=this;if(this.Df[t])this.Df[t].Yl?i&&i({Wi:t,kf:"loadComplete",Ce:this.Df[t]}):i&&s.Vf.f(t,i);else{this.Ea&&console.log("load image "+t);var e=new Image;e.Yl=!1,e.Ou=this.Bf+t,this.Df[t]=e,i&&s.Vf.f(t,i),e.ku=function(){s.Df[t].Yl=!0,s.bf--,s.nd(t,s.Df[t])},e.Lf?console.et("image already complete, abort loading"):this.bf++}}vi(t,i){if(this.me[t]&&this.me[t].Yl)return i&&i({Wi:t,kf:"loadComplete",Ce:this.me[t]}),this.me[t];this.Sd(t,i)}Sd(t,i){var s=this;if(this.me[t])this.me[t].Yl?i&&i({Wi:t,kf:"loadComplete",Ce:this.me[t]}):i&&s.Vf.f(t,i);else{this.Ea&&console.log("load sprite "+t);var e=new Sprite(t);i&&s.Vf.f(t,i),getJSON(this.Bf+t,function(i){s.Ea&&console.log("sprite loaded: "+t),s.me[t].Ql(i,function(){s.Mf--,s.nd(t,s.me[t])})}),this.me[t]=e,this.Mf++}}Ie(t){return void 0!=this.me[t]}Wf(t,i){if(this.Ef[t]&&this.Ef[t].Yl)return i&&i({Wi:t,kf:"loadComplete",Ce:this.Ef[t]}),this.Ef[t];this.Td(t,i)}Td(t,i){var s=this;if(this.Ef[t])this.Ef[t].Yl?i&&i({Wi:t,kf:"loadComplete",Ce:this.Ef[t]}):i&&s.Vf.f(t,i);else{this.Ea&&console.log("load spriteBatch "+t);var e=new SpriteBatch(t);i&&s.Vf.f(t,i),getJSON(this.Bf+t,function(i){s.Ea&&console.log("spriteBatch loaded: "+t),s.Ef[t].pe(i,function(){s.Af--,s.nd(t,s.Ef[t])})}),this.Ef[t]=e,this.Af++}}Jf(t,i,s){var e=t+":"+i;if(this.Pf[e]&&this.Pf[e].Yl)return s&&s({Wi:e,kf:"loadComplete",Ce:this.Pf[e]}),this.Pf[e];this.wd(t,i,s)}wd(t,i,s){var e=t+":"+i,h=this;if(this.Pf[e])this.Pf[e].Yl?s&&s({Wi:e,kf:"loadComplete",Ce:this.Pf[e]}):s&&h.Vf.f(e,s);else{this.Ea&&console.log("load animation quickAttach "+t);var r=new Animation;r.Yl=!1,s&&h.Vf.f(e,s),getJSON(this.Bf+t,function(t){r.pe(t),r.we(i,".sprite",function(){h.Ea&&console.log("animation quickAttach loaded: "+e),r.Yl=!0,h.Rf--,h.nd(e,h.Pf[e])})}),this.Pf[e]=r,this.Rf++}}zf(t,i,s){var e=t+":"+i;if(this.Ff[e]&&this.Ff[e].Yl)return s&&s({Wi:e,kf:"loadComplete",Ce:this.Ff[e]}),this.Ff[e];this.wd(t,i,s)}gd(t,i,s){var e=t+":"+i,h=this;if(this.Ff[e])this.Ff[e].Yl?s&&s({Wi:e,kf:"loadComplete",Ce:this.Ff[e]}):s&&h.Vf.f(e,s);else{this.Ea&&console.log("load FourPole quickAttach "+t);var r=new FourPoleAnimation;r.Yl=!1,s&&h.Vf.f(e,s),getJSON(this.Bf+t,function(t){r.pe(t),r.we(i,".sprite",function(){h.Ea&&console.log("FourPole quickAttach loaded: "+e),r.Yl=!0,h.Rf--,h.nd(e,h.Ff[e])})}),this.Ff[e]=r,this.Rf++}}ud(t,i){if(this.Nf[t]&&this.Nf[t].Yl)return i&&i({Wi:t,kf:"loadComplete",Ce:this.Nf[t].Kl}),this.Nf[t].Kl;this.ht(t,i)}ht(t,i){var s=this;if(this.Nf[t])this.Nf[t].Yl?i&&i({Wi:t,kf:"loadComplete",Ce:this.Nf[t].Kl}):i&&s.Vf.f(t,i);else{this.Ea&&console.log("load json: "+t),i&&s.Vf.f(t,i);var e=this;getJSON(this.Bf+t,function(i){e.Ea&&console.log("json loaded: "+t),s.Nf[t].Kl=i,s.Nf[t].Yl=!0,s.If--,s.nd(t,s.Nf[t].Kl)}),this.Ea&&console.log("json being loaded: "+t),this.Nf[t]={vh:t,Kl:null,Yl:!1},this.If++}}Gf(t,i){this._f.hasOwnProperty(t)?console.et("tried to set already existing resource "+t):this._f[t]=i}Uf(t){return this._f[t]}}class SaveData{constructor(t){this.Hf=t,Service.r("sd",this),this.Ea=!1}jh(t,i){null===localStorage.qf(this.Hf+t)&&(this.Ml(t,i),this.Ea&&console.log("saved initial value for "+t))}Ml(t,i){localStorage.jf(this.Hf+t,JSON.stringify(i))}Kf(t,i){var s=localStorage.qf(this.Hf+t);return null===s?(this.Ea&&console.log("used default value for load of ",t),i):JSON.parse(s)}clear(t){localStorage.Yf(this.Hf+t)}}class Service{static T(t){return this.Qf||(this.Qf=[]),this.Qf[t]}static r(t,i){this.Qf||(this.Qf=[]),this.Qf[t]&&console.et("Service "+t+" overrided!"),this.Qf[t]=i}static Xf(t){delete this.Qf[t]}}class TiledMap{constructor(t,i,s){this.Ks=t.substring(0,t.lastIndexOf("/")+1),this.ui=i,this.li=s,this.Yl=!1,this.Zf=[],this.$f=[],this.tv=[],this.iv="player",this.sv=null,this.ev=[],this.hv=[],this.rv=[],this.nv=null,this.av=[],this.Ea=!0,this.ov=!1}pe(t){var i=Service.T("rp");this.Kl=t;for(var s=0;s<this.Kl.cv.length;s++){var e=this.Kl.cv[s],h=new Sprite(this.Ks),r={lt:e.lt,Xl:"grid",ui:e.uv,li:e.lv};h.Ql(r),e.dt=h,this.Zf.push(e)}for(var n=0;n<this.Kl.dv.length;n++){var a=this.Kl.dv[n];if("imagelayer"==a.kc)this.tv.push(a),i.Cd(this.Ks+a.lt);else if("tilelayer"==a.kc)console.log("add tile layer"),this.$f.push(a);else if("objectgroup"==a.kc&&"ground"==a.name)for(var o=0;o<a.fv.length;o++){var c=a.fv[o];this.ev.push(c)}else if("objectgroup"==a.kc&&"wall"==a.name)for(o=0;o<a.fv.length;o++){c=a.fv[o];this.hv.push(c)}else if("objectgroup"==a.kc&&"spawn"==a.name)for(o=0;o<a.fv.length;o++){c=a.fv[o];this.rv.push(c)}}this.Yl=!0}vv(t){if(0==t)return 0;for(var i=0;i<this.Zf.length;i++){if(this.Zf[i].mv>t||i==this.Zf.length-1)return i}return console.et("TiledMap: couldnt find tilesetIdx for gid "+t),-1}F(t,i,s,e){if(this.Yl){t.Ds(),t.bs(i,s);for(var h=Service.T("rp"),r=0;r<this.tv.length;r++){var n=this.Kl.dv[r],a=h.ci(this.Ks+n.lt);a&&t.di(a,n.nt,n.at),n.name==this.iv&&this.sv&&this.sv()}for(r=0;r<this.$f.length;r++){for(var o=this.$f[r],c=o.ui,u=o.li,l=0;l<u;l++)for(var d=l*c,f=0;f<c;f++){var v=o.Kl[f+d],m=this.vv(v);if(!(v<=0)){var p=v-this.Zf[m].mv,g=this.Zf[m].uv,w=this.Zf[m].lv;this.Zf[m].dt.mi(t,f*g,l*w,p)}}o.name==this.iv&&this.sv&&this.sv(t,0,0,e)}if(t.Es(),this.ov){for(var C=0;C<this.ev.length;C++){var S=this.ev[C];t.Nl(i+S.nt,s+S.at,S.ui,S.li)}for(C=0;C<this.hv.length;C++){S=this.hv[C];t.Nl(i+S.nt,s+S.at,S.ui,S.li)}for(C=0;C<this.rv.length;C++){S=this.rv[C];t.Nl(i+S.nt,s+S.at,S.ui,S.li)}}}}pv(t){return this.rv[t]}gv(){var t=this.rv.length-1,i=Math.floor(Math.random()*(t-0))+0;return this.rv[i]}wv(t,i){for(var s=0,e=0;e<this.rv.length;e++){Math.abs(this.rv.nt-t)+Math.abs(this.rv.at-i)>0&&(s=e)}return this.rv[s]}Cv(){var t=this,i=new NodeView;return i.Zi((i,s,e,h)=>{var r=i.Cl;i.Cl=!1,t.F(i,s,e,h),i.Cl=r}),i}}function getRand(t,i){return~~(Math.random()*(i-t+1))+t}function radToDeg(t){return 180*t/Math.PI}function dicLength(t){return Object.keys(t).length}function arrayContains(t,i){return!!t.some(function(t){return t==i})}function removeFromArray(t,i){var s=t.indexOf(i);return s>-1&&(t.splice(s,1),!0)}function isString(t){return"string"==typeof t||t instanceof String}function isArray(t){return t.constructor===Array||Array.isArray(t)}function generateUUID(){var t=Date.now();return window.Sv&&"function"==typeof window.Sv.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==i?s:3&s|8).toString(16)})}function getJSON(t,i){var s=new XMLHttpRequest;s.Tv("GET",t,!0),s.ku=function(){if(this.kf>=200&&this.kf<400||0==this.kf&&this.xv){var s=JSON.parse(this.xv);i(s)}else console.o("unable to download "+t+" error: "+this.kf+" "+this.yv),i(null)},s.Vv=function(){console.o("unable to download "+t+" unable to connect"),i(null)},s.Dv()}function CreateScreenShade(t){t=t||.5;var i=Graphics.ml,s=new NodeView;return s.bt(i.nt,i.at,"rgba(0,0,0,"+t+")"),s.b.x(i.nt/2,i.at/2),s.st(),s}function CreateSimpleButton(t,i,s){var e=new Vec2D(100,40);s||(s=EventBus.d),isString(s)&&(s=EventBus.T(s));var h=new NodeView;return h.bt(e.nt,e.at,"rgb(50,150,50)"),h.Bt(t,"16px Arial"),h.$i(function(){s.Li({Wi:i,from:h})}),h}function CreateSimpleImageButton(t,i,s,e){e||(e=EventBus.d),isString(e)&&(e=EventBus.T(e));var h=new NodeView;return h.Ft(i),t&&h.Bt(t,"14px Arial"),h.$i(function(){e.Li({Wi:s,from:h})}),h}function CreateSimplePopup(t,i,s,e){var h=new Vec2D(300,250),r=new NodeView;r.bt(h.nt,h.at,"rgb(200,200,200)");var n=CreateSimpleButton(i,s,e);n.b.at=h.at/2,r.M(n),console.log("button size "+n.size.nt+","+n.size.at),h.at-=n.size.at;var a=new NodeView;return a.Bt(t,"24px Arial","rgb(0,0,0)",!0),a.b.at=h.at,r.M(a),r}function CreateSimpleVerticleSlider(t,i,s,e){e||(e=EventBus.d),isString(e)&&(e=EventBus.T(e));var h=new NodeView;return h.bt(10,i,"rgb(128,128,128)"),h.bv=0,h.Mv=new NodeView,h.Mv.bt(t,20,"rgb(255,255,255)"),h.M(h.Mv),h.$i(function(t,r,n){h.bv=1-(n/(i-20)+.5),h.bv=Math.min(h.bv,1),h.bv=Math.max(h.bv,0),e.Li({Wi:s,bv:h.bv})},!1),h.Zi(function(t,s,e,r){h.Mv.b.at=(1-h.bv)*i-i/2}),h}function CreateSimpleEditBox(t,i,s,e,h){var r=new Vec2D(300,250),n=new NodeView;n.bt(r.nt,r.at,"rgb(200,200,200)");var a=CreateSimpleButton(s,e,h);a.b.at=r.at/2,n.M(a),console.log("button size "+a.size.nt+","+a.size.at),r.at-=a.size.at;var o=new NodeView;return o.Bt(t,"24px Arial","rgb(0,0,0)",!0),o.b.at=r.at,n.M(o),n}function CreateSimpleProgressBar(t,i,s,e){new Vec2D(s,e);var h=new NodeView;return h.bv=0,h.bt(s,e,i),h.G.push(function(i,r,n,a){var o=h.bv*(s-2),c=t;i.ai(r-s/2+o/2+1,n,o,e-2,c)}),h}exports.Ev=getRand,exports.Av=radToDeg,exports.Nv=arrayContains,exports.Iv=removeFromArray,exports.isArray=isArray,exports.Pv=isString;class Vec2D{constructor(t,i){this.nt=t||0,this.at=i||0}Fv(t){this.nt=t.nt,this.at=t.at}X(){return{nt:this.nt,at:this.at}}ht(t){this.nt=t.nt||0,this.at=t.at||0}ii(){return new Vec2D(this.nt,this.at)}toString(){return this.nt.toFixed(4)+","+this.at.toFixed(4)}X(){return{nt:this.nt,at:this.at}}x(t,i){return this.nt=t,this.at=i,this}cs(t){return this.nt=t.nt,this.at=t.at,this}si(t){return this.nt+=t.nt,this.at+=t.at,this}Rv(t){return this.nt-=t.nt,this.at-=t.at,this}ms(t){return this.nt=this.nt*t,this.at=this.at*t,this}_v(){return 0!=this.nt||0!=this.at}Bv(){var t=this.Ov();return new Vec2D(this.nt/t,this.at/t)}oa(){return this.nt*this.nt+this.at*this.at}Ov(){return Math.sqrt(this.nt*this.nt+this.at*this.at)}Id(t){return new Vec2D(this.nt*t,this.at*t)}Os(t){return new Vec2D(this.nt+t.nt,this.at+t.at)}fs(t){return new Vec2D(this.nt-t.nt,this.at-t.at)}kv(t){return this.nt*t.nt+this.at*t.at}Lv(t){return t.fs(this).oa()}Wv(t){return this.nt==t.nt&&this.at==t.at}Jv(){return 0==this.at&&0==this.nt?0:Math.atan2(this.at,this.nt)+Math.PI/2}zv(t){return t-=Math.PI/2,this.nt=Math.cos(t),this.at=Math.sin(t),this}static Gv(t){return t-=Math.PI/2,new Vec2D(Math.cos(t),Math.sin(t))}rs(t){if(0==this.nt&&0==this.at)return this;var i=Math.cos(t),s=Math.sin(t),e=this.nt*i-this.at*s,h=this.nt*s+this.at*i;return Math.abs(e)<1e-7&&(e=0),Math.abs(h)<1e-7&&(h=0),this.nt=e,this.at=h,this}Uv(t){if(0==this.nt&&0==this.at)return new Vec2D(0,0);var i=Math.cos(t),s=Math.sin(t),e=this.nt*i-this.at*s,h=this.nt*s+this.at*i;return Math.abs(e)<1e-7&&(e=0),Math.abs(h)<1e-7&&(h=0),new Vec2D(e,h)}}class Segment2D{constructor(t,i){this.Hv=t,this.qv=i}X(){return{Hv:this.Hv.X(),qv:this.qv.X()}}ht(t){this.Hv=(new Vec2D).ht(t.Hv),this.qv=(new Vec2D).ht(t.qv)}toString(){return this.Hv.toString()+" -> "+this.qv.toString()}jv(){var t=this.qv.fs(this.Hv);return t.rs(Math.PI/180*90),t.Bv()}Kv(){return this.qv.fs(this.Hv).Ov()}Yv(t,i,s,e){return new Segment2D(new Vec2D(t,i),new Vec2D(s,e))}Qv(t){return Segment2D.Xv(this.Hv,this.qv,t.Hv,t.qv)}static Zv(t,i,s){var e=t.jv(),h=s.fs(i.Hv),r=h.fs(e.Id(2*h.kv(e))).Bv(),n=i.Kv()-h.Ov(),a=r.ms(n);return s.Os(a)}static Xv(t,i,s,e){var h=i.fs(t),r=e.fs(s),n=h.nt*r.at-h.at*r.nt;if(0==n)return null;var a=s.fs(t),o=(a.nt*r.at-a.at*r.nt)/n;if(o<0||o>1)return null;var c=(a.nt*h.at-a.at*h.nt)/n;return c<0||c>1?null:t.Os(h.Id(o))}}class Rect2D{constructor(t,i,s,e){this.nt=t||0,this.at=i||0,this.Mt=s||0,this.Et=e||0}static get $v(){return 0}static get tm(){return 1}static get im(){return 2}static get sm(){return 3}X(){return{nt:this.nt,at:this.at,Mt:this.Mt,Et:this.Et}}ht(t){this.nt=t.nt||0,this.at=t.at||0,this.Mt=t.Mt||0,this.Et=t.Et||0}toString(){return this.nt.toFixed(4)+","+this.at.toFixed(4)+":"+this.Mt.toFixed(4)+"x"+this.Et.toFixed(4)}ii(){return new Rect2D(this.nt,this.at,this.Mt,this.Et)}em(){return new Vec2D(this.nt+this.Mt/2,this.at+this.Et/2)}hm(){return this.nt+this.Mt}rm(){return this.at+this.Et}nm(){return new Vec2D(this.nt,this.at)}am(){return new Vec2D(this.nt+this.Mt,this.at)}om(){return new Vec2D(this.nt,this.at+this.Et)}cm(){return new Vec2D(this.nt+this.Mt,this.at+this.Et)}um(){return new Vec2D(-this.Mt/2,-this.Et/2)}lm(){return new Vec2D(this.Mt/2,-this.Et/2)}dm(){return new Vec2D(-this.Mt/2,this.Et/2)}fm(){return new Vec2D(this.Mt/2,this.Et/2)}vm(){return Segment2D.Yv(this.nt,this.at,this.nt+this.Mt,this.at)}mm(){return Segment2D.Yv(this.nt,this.at+this.Et,this.nt+this.Mt,this.at+this.Et)}pm(){return Segment2D.Yv(this.nt,this.at,this.nt,this.at+this.Et)}gm(){return Segment2D.Yv(this.nt,this.at+this.Et,this.nt+this.Mt,this.at+this.Et)}wm(t){return this.nt==t.nt&&this.at==t.at&&this.Mt==t.Mt&&this.Et==t.Et}bt(t){return this.nt=t.nt,this.at=t.at,this.Mt=t.Mt,this.Et=t.Et,this}x(t,i,s,e){return this.nt=t,this.at=i,this.Mt=s,this.Et=e,this}Cm(t){return this.Mt=t.nt,this.Et=t.at,this}Sm(t,i){return this.Mt=t,this.Et=i,this}Tm(){return new Vec2D(this.Mt,this.Et)}xm(t,i){return this.nt=t,this.at=i,this}ym(t,i){return this.nt=t-this.Mt/2,this.at=i-this.Et/2,this}Vm(t){return this.nt=t.nt-this.Mt/2,this.at=t.at-this.Et/2,this}Dm(t){return this.nt+=t.nt,this.at+=t.at,this}bm(t){return this.nt-=t.nt,this.at-=t.at,this}Mm(t,i){return this.nt+=t,this.at+=i,this}Em(t){return!(t.nt<this.nt)&&(!(t.at<this.at)&&(!(t.nt>this.nt+this.Mt)&&!(t.at>this.at+this.Et)))}Am(t){return!(t.nt>this.nt+this.Mt)&&(!(t.at>this.at+this.Et)&&(!(t.nt+t.Mt<this.nt)&&!(t.at+t.Et<this.at)))}ps(t){t.nt<this.nt&&(t.nt=this.nt),t.nt>this.nt+this.Mt&&(t.nt=this.nt+this.Mt),t.at<this.at&&(t.at=this.at),t.at>this.at+this.Et&&(t.at=this.at+this.Et)}static ns(t,i,s,e,h,r){return!(t<s)&&(!(i<e)&&(!(t>s+h)&&!(i>e+r)))}static Nm(t,i,s){return!(t.nt<i.nt)&&(!(t.at<i.at)&&(!(t.nt>i.nt+s.nt)&&!(t.at>i.at+s.at)))}static Im(t,i){var s=new Rect2D;s.nt=t.nt<i.nt?t.nt:i.nt,s.at=t.at<i.at?t.at:i.at;var e=t.nt+t.Mt,h=i.nt+i.Mt;s.Mt=e>h?e-s.nt:h-s.nt;var r=t.at+t.Et,n=i.at+i.Et;return s.Et=r>n?r-s.at:n-s.at,s}static Pm(t,i){var s=new Rect2D;s.nt=t.nt>i.nt?t.nt:i.nt,s.at=t.at>i.at?t.at:i.at;var e=t.nt+t.Mt,h=i.nt+i.Mt;s.Mt=e<h?e-s.nt:h-s.nt;var r=t.at+t.Et,n=i.at+i.Et;return s.Et=r<n?r-s.at:n-s.at,s}static Fm(t,i){var s=t.em(),e=t.um().rs(i).si(s),h=t.lm().rs(i).si(s),r=t.dm().rs(i).si(s),n=t.fm().rs(i).si(s),a=Math.min(e.nt,h.nt,r.nt,n.nt),o=Math.max(e.nt,h.nt,r.nt,n.nt),c=Math.min(e.at,h.at,r.at,n.at),u=Math.max(e.at,h.at,r.at,n.at);return new Rect2D(a,c,o-a,u-c)}static Rm(){console.log("Beginning Rect2D unit tests...");var t=new Rect2D(0,0,100,100),i=new Rect2D(50,50,100,100),s=new Rect2D(-10,-20,10,20);console.log("test unions: ");var e=Rect2D.Im(t,i);console.log("expect "+new Rect2D(0,0,150,150).toString()),console.log("result "+e.toString());var h=Rect2D.Im(t,s);console.log("expect "+new Rect2D(-10,-20,110,120).toString()),console.log("result "+h.toString()),console.log("test intersects: ");var r=Rect2D.Pm(t,i);console.log("expect "+new Rect2D(50,50,50,50).toString()),console.log("result "+r.toString());var n=Rect2D.Pm(t,s);console.log("expect "+new Rect2D(0,0,0,0).toString()),console.log("result "+n.toString())}}exports._m=Vec2D,exports.Bm=Rect2D;