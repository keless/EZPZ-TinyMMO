var exports={};class AppState{constructor(){this.t=null,this.i=null}s(){this.t&&this.t.s&&this.t.s(),this.i&&this.i.s&&this.i.s()}}class AppStateController{constructor(){this.e={},this.h=null,Service.r("state",this)}n(t,i){this.e[t]=i}a(t,i){this.e[t]?(this.h&&(this.h.s(),this.h=null),this.h=new this.e[t](i)):console.o("no state named "+t+" available")}}class BaseListener{constructor(){this.l=[]}s(){this.c()}u(t,i,s){s||(s=EventBus.d),i||console.o("SetListener given invalid callback function for "+t),s.f(t,i.bind(this)),this.l.push({v:s,m:t,p:i})}g(t,i,s){s||(s=EventBus.d),s.w(t,i.bind(this))}c(){for(var t of this.l)t.v.w(t.m,t.p)}}class BaseStateModel extends BaseListener{constructor(){super()}s(){super.s()}C(t,i){}}class BaseStateView extends BaseListener{constructor(){super(),this.S=new NodeView;var t=Service.V("gfx");this.S.size.T(t.b(),t.x())}s(){super.s()}y(t,i,s,e){var h=new ButtonView(t,"gfx/btn_blue.sprite",i,"12px Arial","#FFFFFF");h.D.T(s,e),this.S.M(h)}N(t,i,s){this.S&&this.S.N(t,i,s)}A(t,i){}I(t,i,s){this.S&&this.S.I(t,i,s)}F(t,i,s){this.S&&this.S.F(t,i,s)}P(t,i,s,e){this.S&&this.S.P(t,i,s,e)}}class NodeView extends BaseListener{constructor(){super(),this._=Config&&Config.R||!1,this.D=new Vec2D,this.size=new Vec2D,this.B=0,this.L=1,this.k=!0,this.O=null,this.J=[],this.z=null,this.W=[],this.U=[],this.G=1,this.H=!1,this.K=null,this.q=!1,this.j=!0,this.Y=!0,this._&&(this.Q=[])}X(t){if(!this._)return console.o("NodeView - trying to serialize NodeView when seralizable == false"),{};t=t||!1;var i={Z:"NodeView"};if(i.D=this.D.X(),i.size=this.size.X(),0!=this.B&&(i.B=this.B),1!=this.L&&(i.L=this.L),1!=this.k&&(i.$=this.k),1!=this.G&&(i.G=this.G),0!=this.H&&(i.H=this.H),0!=this.q&&(i.tt=this.q),1!=this.j&&(i.it=this.j),1!=this.Y&&(i.st=this.Y),null!=this.O&&console.et("NodeView.toJson() - cant serialize pUser"),null!=this.K&&console.et("NodeView.toJson() - cant serialize fnOnClick"),this.W.length>0&&console.et("NodeView.toJson() - cant serialize actions.. yet"),i.Q=this.Q,this.J.length>0&&!t){var s=[];for(var e of this.J)s.push(e.X());i.J=s}return i}ht(t){this.rt(),this.D=new Vec2D(t.D.nt,t.D.at),this.size=new Vec2D(t.size.nt,t.size.at),this.B=t.B||0,this.L=t.L||1,this.k=t.$||!0,this.G=t.G||1,this.H=t.H||!1,this.q=t.tt||!1,this.j=t.it||!0,this.Y=t.st||!0,this.ot(t.Q||[]),this.lt(t.J||[])}rt(){this.J.length=0,this.U.length=0,this.W.length=0,this._&&(this.Q=[]),delete this.ct,delete this.ut,delete this.dt,delete this.ft,delete this.vt,delete this.mt,delete this.pt,delete this.gt,delete this.wt,delete this.Ct,delete this.St,delete this.Vt}ot(t){for(var i of t)switch(i.call){case"setCircle":this.Tt(i.bt,i.xt,i.yt);break;case"setRect":this.Dt(i.Mt,i.Nt,i.xt);break;case"setPolygon":this.At(i.Et,i.fill,i.It,i.Ft);break;case"setImage":this.Pt(i.ut);break;case"setImageStretch":this._t(i.ut,i.nt,i.at,i.Mt,i.Nt);break;case"setSprite":this.Rt(i.dt);break;case"setLabel":this.Bt(i.pt,i.wt,i.gt,i.Lt);break;case"setLabelWithOutline":this.kt(i.pt,i.wt,i.gt,i.Ot,i.size,i.Lt);break;case"setTextInput":this.Jt(i.Mt,i.Nt)}}lt(t){for(var i of(this.J.length=0,t)){var s=null;switch(i.Z){case"NodeView":s=new NodeView;break;case"ButtonView":s=new ButtonView(i.zt,i.dt,i.Wt,i.wt,i.gt);break;case"MenuView":s=new MenuView(i.Ut,i.Mt,i.Nt);break;case"TableView":s=new TableView(i.Mt,i.Nt,i.Gt);break;default:console.et("NodeView _loadChildrenJson unknown classType "+i.Z);continue}s.ht(i),this.M(s)}}s(){for(var t of(this.Vt&&this.Vt.Ht(),this.J))t.s();super.s()}get $(){return this.k}set $(t){this.k=t,this.Vt&&(this.Vt.Kt=t)}qt(){return this.z}jt(t){for(var i=0;i<this.J.length;i++)if(this.J[i]==t)return i;return-1}Yt(t){return t<0||t>=this.J.length?null:this.J[t]}Qt(){return this.J.length}get Xt(){return this.z?this.z.Xt+this.B:this.B}get Zt(){return this.$t.D}get $t(){var t={L:this.L,ti:this.B,D:this.D.ii()};if(this.z){var i=this.z.$t;t.L+=i.L,t.ti+=i.ti,t.D.si(i.D)}return t}ei(t){this.O=t}hi(){return this.O}Tt(t,i,s){if(this._&&this.Q.push({call:"setCircle",bt:t,xt:i,yt:s}),this.ct)console.o("NodeView: already has a circle, abort!");else{this.ct=t;var e=this;this.U.push(function(t,h,r,n){1!=e.G&&t.ri(e.G),t.ni(h,r,e.ct,i,s),1!=e.G&&t.ri(1)})}}Dt(t,i,s){this._&&this.Q.push({call:"setRect",Mt:t,Nt:i,xt:s}),this.size.T(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.U.push(function(t,i,h,r){1!=e.G&&t.ri(e.G),t.ai(i,h,e.size.nt,e.size.at,s),1!=e.G&&t.ri(1)})}At(t,i,s,e){this._&&this.Q.push({call:"setPolygon",Et:t,fill:i,It:s,Ft:e});var h=this;this.U.push(function(r,n,a,o){1!=h.G&&r.ri(h.G),r.oi(t,i,s,e),1!=h.G&&r.ri(1)})}Pt(t){(this._&&(isString(t)?this.Q.push({call:"setImage",ut:t}):console.et("NodeView - cannot serialize setImage with non-string image parameter")),isString(t))&&(t=Service.V("rp").li(t));if(this.ut)console.o("NodeView: already has an image, abort!");else{this.ut=t,this.size.T(Math.max(this.size.nt,t.ci),Math.max(this.size.at,t.ui));var i=this;this.U.push(function(t,s,e,h){1!=i.G&&t.ri(i.G),t.di(i.ut,s,e),1!=i.G&&t.ri(1)})}}_t(t,i,s,e,h){(this._&&(isString(t)?this.Q.push({call:"setImageStretch",ut:t,nt:i,at:s,Mt:e,Nt:h}):console.et("NodeView - cannot serialize setImageStretch with non-string image parameter")),isString(t))&&(t=Service.V("rp").li(t));if(this.ut)console.o("NodeView: already has an image, abort!");else{this.ut=t,this.size.T(Math.max(this.size.nt,t.ci),Math.max(this.size.at,t.ui));var r=this;this.U.push(function(t,i,s,n){1!=r.G&&t.ri(r.G),t.fi(r.ut,i,s,e,h),1!=r.G&&t.ri(1)})}}Rt(t,i,s){(this._&&(isString(t)?this.Q.push({call:"setSprite",dt:t,ft:i,vt:s}):console.et("NodeView - cannot serialize setSprite with non-string image parameter")),s=s||!1,isString(t))&&(t=Service.V("rp").vi(t));if(t)if(this.dt)console.o("NodeView: already has a sprite, abort!");else{this.dt=t,this.ft=i,this.vt=s,this.size.T(Math.max(this.size.nt,t.b()),Math.max(this.size.at,t.x()));var e=this;this.U.push(function(t,i,s,h){1!=e.G&&t.ri(e.G),e.dt.mi(t,i,s,Math.floor(e.ft),e.vt),1!=e.G&&t.ri(1)})}}pi(t,i){this.Rt(t,0,i);var s=this.dt.gi(),e=this.dt.wi()/s,h=this,r=function(){h.ft=0,h.Ci("spriteFrame",e,s-1,r)};r()}Si(t){if(this._&&console.et("NodeView - cannot serialize setAnim"),this.Vi)console.o("NodeView: already has an anim, abort!");else{this.Vi=t.Ti();var i=this;this.U.push(function(t,s,e,h){1!=i.G&&t.ri(i.G),i.Vi.C(h),i.Vi.P(t,s,e,i.vt),1!=i.G&&t.ri(1)}),this.bi=function(t,i){this.Vi.xi(t,i)},this.yi=function(t,i){this.Vi.yi(t,i)},this.Di=function(t,i){this.Vi.Di(t,i)}}}bi(t,i){this.Vi&&this.Vi.xi(t,i)}Bt(t,i,s,e){if(this._&&this.Q.push({call:"setLabel",pt:t,wt:i,gt:s,Lt:e}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=e||!1,this.pt=t.toString(),this.wt=i,this.gt=s;var h=Service.V("gfx").Mi(this.pt,this.wt,this.mt);this.size.T(Math.max(this.size.nt,h.nt),Math.max(this.size.at,h.at));var r=this;this.U.push(function(t,i,s,e){t.Ni(r.pt,i,s,r.wt,r.gt,r.mt)})}}kt(t,i,s,e,h,r){if(this._&&this.Q.push({call:"setLabelWithOutline",pt:t,wt:i,gt:s,Ot:e,size:h,Lt:r}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=r||!1,this.pt=t.toString(),this.wt=i,this.gt=s||"#FFFFFF",this.St=e||"#000000",this.Ct=h||2;var n=Service.V("gfx").Mi(this.pt,this.wt,this.mt);this.size.T(Math.max(this.size.nt,n.nt),Math.max(this.size.at,n.at));var a=this;this.U.push(function(t,i,s,e){t.Ai(a.pt,i,s,a.wt,a.St,a.Ct,a.mt)}),this.U.push(function(t,i,s,e){t.Ni(a.pt,i,s,a.wt,a.gt,a.mt)})}}Ei(t){isString(this.pt)?this.pt=t.toString():console.o("NodeView: cant update label, dont have one!")}Ii(t){this.gt=t}Jt(t,i){if(this._&&this.Q.push({call:"setTextInput",Mt:t,Nt:i}),this.Vt)console.o("NodeView: already has a text input, abort!");else{var s=Service.V("gfx");this.Vt=new CanvasInput({Fi:s.Fi,ci:t-2,ui:i-2,Pi:0,_i:2,Ri:"1px 1px 0px #fff",Bi:"0px 0px 2px rgba(0, 0, 0, 0.5)"}),this.Vt.Li=this.D,this.size.T(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.Vt.ki(function(t,i){EventBus.d.Oi({Ji:"textInputSubmitted",zi:i.zi(),Wi:e})}),this.U.push(function(t,i,s,h){e.Vt.Ui(i,s)})}}Gi(){return this.Vt?this.Vt.zi():null}Hi(t){this.Vt&&this.Vt.zi(t)}Ki(){this.Vt&&this.Vt.zi("")}qi(t){this.ji=t}Yi(t,i,s,e){this._&&this.Q.push({call:"setProgressBar",Mt:t,Nt:i,Qi:s,Xi:e}),this.ji=.5,this.size.T(Math.max(this.size.nt,t),Math.max(this.size.at,i));var h=this;this.U.push(function(t,i,r,n){1!=h.G&&t.ri(h.G),t.ai(i,r,h.size.nt,h.size.at,s);var a=h.size.nt,o=h.ji*(a-2);t.ai(Math.floor(i-a/2+o/2+1),r,Math.floor(h.size.nt*h.ji),h.size.at,e),1!=h.G&&t.ri(1)})}Zi(t){this._&&console.et("NodeView - cannot serialize addCustomDraw"),this.U.push(t)}$i(t,i,s){this.Y=i||!0,this.j=s||!0,this.K=t}st(){this.K||this.$i(function(t,i,s){t.ts=!0},!0)}ss(t){this.q=!0,this.es=new Vec2D,this.hs=t?t.ii():null}N(t,i,s){if(this.$&&!t.ts){if(i-=this.D.nt,s-=this.D.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}if(this.j)for(var h=this.J.length-1;h>=0;h--){if(this.J[h].N(t,i,s),t.ts)return}var r=-this.size.nt/2,n=-this.size.at/2;this.K&&Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)&&(this.K&&(this.K(t,i,s),this.Y&&(t.ts=!0)),t.ts)||!this.q||this.as||!Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)||(this.os(),t.ts=!0,t.ts)}}os(){this.as=!0;var t=Service.V("app");this.es.ls(t.cs),this.u("onMouseMove",this.us),this.u("onMouseUp",this.ds)}us(t){var i=this.es.fs(t.vs);i.ms(-1),this.es.ls(t.vs),this.D.si(i),this.hs&&this.hs.ps(this.D)}ds(t){this.as=!1,this.g("onMouseMove",this.us),this.g("onMouseUp",this.ds)}I(t,i,s){if(this.$){if(i-=this.D.nt,s-=this.D.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Vt&&this.Vt.gs(t,this.Vt),this.J))if(h.I(t,i,s),t.ts)return}}F(t,i,s){if(this.$){if(i-=this.D.nt,s-=this.D.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Vt&&this.Vt.ws(t,this.Vt),this.J))if(h.F(t,i,s),t.ts)return}}b(){return this.size.nt}x(){return this.size.at}M(t){t.Cs(),this.J.push(t),t.z=this}Ss(t){var i=t.Zt,s=this.Zt,e=i.fs(s);t.D.ls(e),this.M(t)}Cs(t){t=t||!1,this.z&&(this.z.Vs(this,t),this.z=null)}Vs(t,i){i=i||!1;var s=this.J.indexOf(t);this.Ts(s,i)}Ts(t,i){if(i=i||!1,!(t<0)){var s=this.J.splice(t,1)[0];s.z===this&&(s.z=null),i&&s.s()}}bs(t){t=t||!1;for(var i=this.J.length-1;i>=0;i--){var s=this.J[i];this.Vs(s,t)}}P(t,i,s,e){if(this.$){for(var h of(this.xs(e),t.ys(),t.Ds(i+this.D.nt,s+this.D.at),0!=this.B&&t.rs(this.B),1!=this.L&&t.L(this.L),this.H&&t.Ms(!1),this.U))h(t,0,0,e);for(var r of(this.H&&t.Ms(!0),this.J))r.P(t,0,0,e);t.Ns()}}xs(t){if(0!=this.W.length){for(var i=[],s=0;s<this.W.length;s++){var e=this.W[s];e.ts?i.push(s):e.C(t)}if(i.length>0)for(var h=i.length-1;h>=0;h--)this.W.splice(i[h],1)}}As(){for(var t=0;t<this.W.length;t++)this.W[t].s();this.W.length=0}Es(t,i){var s=new NodeAction_noProperty(t);s.Is=function(){i&&i()},this.W.push(s)}Fs(t,i){var s=this;this.Es(t,function(){s.Cs()})}Ps(t,i,s){this.Ci("scale",t,i,s)}_s(t,i,s){this.Rs("pos",t,i,s)}Bs(t,i,s){var e=this.D.Ls(i);this.Rs("pos",t,e,s)}Ci(t,i,s,e){var h=new NodeAction_float(t,i,s);h.ks(this),h.Is=e||null,this.W.push(h)}Rs(t,i,s,e){var h=new NodeAction_vec2d(t,i,s);h.ks(this),h.Is=e||null,this.W.push(h)}Os(t,i,s,e){var h=new NodeAction_arrayPath(t,i,s);h.ks(this),h.Is=e||null,this.W.push(h)}}class NodeAction{constructor(t,i,s){this.Js=0,this.zs=i,this.Ws=null,this.Us=t,this.ts=!1,this.Is=null,this.Gs=null,this.Hs=s}s(){this.Ws=null}ks(t){this.Ws=t,this.Gs=this.Ws[this.Us]}Ks(t){var i=t-this.Js;return i<0?0:i>=this.zs?1:i/this.zs}C(t){0==this.Js&&(this.Js=t);var i=this.Ks(t);if(i>=1)this.Ws[this.Us]=this.Hs,this.ts=!0,this.Is&&(this.Is(),this.Is=null);else{var s=this.qs(i);this.Ws[this.Us]=s}}qs(t){}}class NodeAction_float extends NodeAction{qs(t){var i=this.Hs-this.Gs;return this.Gs+i*t}}class NodeAction_vec2d extends NodeAction{qs(t){var i=this.Hs.fs(this.Gs);return this.Gs.Ls(i.ms(t))}}class NodeAction_noProperty extends NodeAction{constructor(t){super(void 0,t,void 0)}ks(t){this.Ws=t,this.Gs=0}C(t){0==this.Js&&(this.Js=t),this.Ks(t)>=1&&(this.ts=!0,this.Is&&(this.Is(),this.Is=null))}}class NodeAction_arrayPath extends NodeAction{constructor(t,i,s){super(t,i,new Vec2D(s[s.length-1][0],s[s.length-1][1])),this.js=s}qs(t){var i=this.js.length,s=~~(i*t);s>=i-1&&(s=i-2);var e=1/i,h=(t-s*e)/e;h>1&&(h=1);var r=new Vec2D(this.js[s][0],this.js[s][1]);console.log("vTo idx "+(s+1));var n=new Vec2D(this.js[s+1][0],this.js[s+1][1]).fs(r);return r.Ls(n.ms(h))}}class TableView extends NodeView{static get Ys(){return 0}static get Qs(){return 1}static get Xs(){return 0}static get Zs(){return 1}static get $s(){return 2}constructor(t,i,s){super(),this.te=[],this.ie=0,this.se=0,this.Pi=5,this.ee=TableView.Xs,this.Gt=s||!1,this.size.T(t,i),this.he=TableView.Ys}X(t){if(!this._)return console.o("TableView - trying to serialize TableView when seralizable == false"),{};var i=super.X(t);return i.Z="TableView",i.Pi=this.Pi,i.ee=this.ee,i.Gt=this.Gt,i.Mt=this.size.nt,i.Nt=this.size.at,i.he=this.he,i}ht(t){super.ht(t),this.Gt=t.Gt,this.size.T(t.Mt,t.Nt),this.Pi=t.Pi,this.ee=t.ee,this.he=t.he}re(t){this.te.push(t),this.Gt&&(this.he==TableView.Ys?(this.size.at+=t.x()+this.Pi,this.size.nt=Math.max(this.size.nt,t.b())):(this.size.nt+=t.b()+this.Pi,this.size.at=Math.max(this.size.at,t.x())))}ne(t){this.te=this.te.splice(t,1),this.Gt&&(direction==TableView.Ys?this.size.at-=cell.x()+this.Pi:this.size.nt-=cell.b()+this.Pi)}ae(){if(this.Gt)for(var t=this.te.length-1;t>=0;t--)this.ne(t);else this.te.length=0}N(t,i,s){i-=this.D.nt,s-=this.D.at,i-=this.ie,s-=this.se;var e=0;this.Gt&&this.te.length>0&&(this.he==TableView.Ys?e-=this.te[0].x():e-=this.te[0].b());var h=0;if(this.he==TableView.Ys)for(var r=0;r<this.te.length;r++){if(this.te[r].N(t,i,s-e),t.ts)return;e+=this.te[r].x()+this.Pi}else{this.ee==TableView.Xs&&(h-=this.size.nt/2*.8);for(r=0;r<this.te.length;r++){if(this.te[r].N(t,i-(h+e),s),t.ts)return;e+=this.te[r].b()+this.Pi}}}P(t,i,s,e){for(var h of(t.ys(),t.Ds(i+this.D.nt,s+this.D.at),0!=this.B&&t.rs(this.B),1!=this.L&&t.L(this.L),this.U))h(t,0,0,e);i-=this.ie,s-=this.se;var r=0;this.Gt&&this.te.length>0&&(this.he==TableView.Ys?r-=this.te[0].x():r-=this.te[0].b());var n=0;if(this.he==TableView.Ys)for(var a=0;a<this.te.length;a++)this.te[a].P(t,0,r,e),r+=this.te[a].x()+this.Pi;else{this.ee==TableView.Xs&&(n-=this.size.nt/2*.8);for(a=0;a<this.te.length;a++)this.te[a].P(t,n+r,0,e),r+=this.te[a].b()+this.Pi}for(var o of this.J)o.P(t,0,0,e);t.Ns()}}class Animation{constructor(){this.oe=["end"],this.le={ce:{ue:5,de:{fe:"idle"}}},this.ve="idle",this.me={}}pe(t){this.oe=t.oe,this.le=t.le,this.ve=t.ge}we(t,i,s){var e=Service.V("rp"),h=this,r=Object.keys(this.le).length;for(var n in this.le)!function(a){e.vi(t+n+i,function(t){var i=t.Ce;i&&(h.Se(a,i),s&&0==--r&&s())})}(n)}Se(t,i){this.me[t]=i}Ti(){return new AnimationInstance(this)}}class AnimationInstance{constructor(t){this.Ve=t,this.Js=0,this.Te="null",this.mi=0,this.be=null,this.ue=5,this.yi(0,this.Ve.ve),this.xe=!1}xi(t,i){var s=this.Ve.le[this.Te].de[i];return s?(this.yi(t,s),!0):(i!=this.Te&&console.et("failed to handle event "+i),!1)}yi(t,i){i=i||this.Ve.ve,this.Te=i,this.Js=t,this.mi=0,this.be=this.Ve.me[this.Te];var s=this.Ve.le[this.Te];this.ue=s.ue||this.be.wi(),this.be||console.et("no sprite for startAnim("+i+")")}C(t){if(!this.xe){var i=this.be.gi(),s=i/this.ue,e=t-this.Js;e>s?this.xi(t,"end"):this.mi=Math.floor(e/s*i)}}P(t,i,s,e){this.be.mi(t,i,s,this.mi,e)}ye(){return this.be}}class FourPoleAnimation extends Animation{static get De(){return 0}static get Me(){return 1}static get Ne(){return 2}static get Ae(){return 3}constructor(){super(),this.Ee=["N","E","S","W"]}we(t,i,s){var e=Service.V("rp"),h=this,r=0,n=!1;for(var a in this.le)!function(a){for(var o in e.Ie(t+a+i)&&(r++,e.vi(t+a+i,function(t){var i=t.Ce;i&&(h.Se(a,i),r--,s&&0==r&&n&&s())})),h.Ee)!function(o){var l=h.Ee[o];e.Ie(t+a+l+i)&&(r++,e.vi(t+a+l+i,function(t){var i=t.Ce;i&&(h.Se(a+l,i),r--,s&&0==r&&n&&s())}))}(o)}(a);n=!0}Ti(){return new FourPoleAnimationInstance(this)}}class FourPoleAnimationInstance extends AnimationInstance{Di(t,i){(i<0||i>this.Ve.Ee.length)&&console.o("invalid direction index "+i+" for FourPoleAnimation with "+this.Ve.Ee.length+" directions");var s=this.Ve.Ee[i];s!=this.Fe&&(this.Fe=s,this.yi(t,this.Te))}yi(t,i){void 0==this.Fe&&(this.Fe=this.Ve.Ee[0]),i=i||this.Ve.ve,this.Te=i,this.Js=t,this.mi=0,this.Ve.me[this.Te+this.Fe]?this.be=this.Ve.me[this.Te+this.Fe]:this.be=this.Ve.me[this.Te];var s=this.Ve.le[this.Te];this.ue=s.ue||this.be.wi(),this.be||console.et("no sprite for startAnim("+i+")")}}var KEY_LEFT=37,KEY_UP=38,KEY_RIGHT=39,KEY_DOWN=40;class Application{static getTime(){return Service.V("app").Pe}constructor(t,i,s){this._e=t,this.cs=new Vec2D;var e=this;document.Re=t,document.Be=function(t){e.I(t)},document.ws=function(t){e.F(t)},test=function(t,i){return t<5?i+.01*t:i+.01*(10-t)};var h=function(t){var i=Service.V("gfx").Fi,s=t.Le-(i.ke||i.Oe),h=t.Je-(i.ze||i.We);e.cs.T(s,h)};document.Ue=function(t){h(t),e.N(t,e.cs.nt,e.cs.at,t.Ge)},document.He=function(t){h(t),EventBus.d.Oi({Ji:"onMouseMove",vs:e.cs},!0)},document.Ke=function(t){h(t),EventBus.d.Oi({Ji:"onMouseUp",vs:e.cs},!0)},document.qe=function(t){h(t)},document.je=function(t){var i=t.Ye;e.A(t,i)},this.Qe=0,this.Pe=0,Service.r("app",this),this.Xe(t,i)}Xe(t,i){new ResourceProvider,new Graphics(i),new AudioManager,new Physics,new SaveData(t),new AppStateController}Ze(){this.$e()}th(){this.ih()}sh(){return null==this.eh}$e(){null==this.eh&&(this.Qe=(new Date).getTime(),this.eh=setInterval(this.hh.bind(this),33))}ih(){null!=this.eh&&(clearInterval(this.eh.bind(this)),this.eh=null)}hh(){var t=Service.V("state").h,i=Date.now();i/=1e3;var s=Math.abs(i-this.Qe);this.Qe=i,this.Pe+=s,this.rh(s,this.Pe),t.i&&t.i.C(i,s),Service.V("physics").nh(),this.ah(s,this.Pe);var e=Service.V("gfx");e.oh(!0),t.t&&t.t.P(e,0,0,this.Pe),this.lh(e,s,this.Pe)}ch(){console.log("override me: Application.onApplicationLoaded()")}rh(t,i){}ah(t,i){}lh(t,i,s){}I(t){Service.V("state").h.t.I(t,this.cs.nt,this.cs.at)}F(t){Service.V("state").h.t.F(t,this.cs.nt,this.cs.at)}N(t,i,s){Service.V("state").h.t.N(t,i,s)}A(t,i){}}class AppState{constructor(){this.t=null,this.i=null}s(){this.t&&this.t.s&&this.t.s(),this.i&&this.i.s&&this.i.s()}}class AppStateController{constructor(){this.e={},this.h=null,Service.r("state",this)}n(t,i){this.e[t]=i}a(t,i){this.e[t]?(this.h&&(this.h.s(),this.h=null),this.h=new this.e[t](i)):console.o("no state named "+t+" available")}}class BaseListener{constructor(){this.l=[]}s(){this.c()}u(t,i,s){s||(s=EventBus.d),i||console.o("SetListener given invalid callback function for "+t),s.f(t,i.bind(this)),this.l.push({v:s,m:t,p:i})}g(t,i,s){s||(s=EventBus.d),s.w(t,i.bind(this))}c(){for(var t of this.l)t.v.w(t.m,t.p)}}class BaseStateModel extends BaseListener{constructor(){super()}s(){super.s()}C(t,i){}}class BaseStateView extends BaseListener{constructor(){super(),this.S=new NodeView;var t=Service.V("gfx");this.S.size.T(t.b(),t.x())}s(){super.s()}y(t,i,s,e){var h=new ButtonView(t,"gfx/btn_blue.sprite",i,"12px Arial","#FFFFFF");h.D.T(s,e),this.S.M(h)}N(t,i,s){this.S&&this.S.N(t,i,s)}A(t,i){}I(t,i,s){this.S&&this.S.I(t,i,s)}F(t,i,s){this.S&&this.S.F(t,i,s)}P(t,i,s,e){this.S&&this.S.P(t,i,s,e)}}class AudioManager{constructor(){console.log("AudioManager created"),Service.r("audio",this),EventBus.uh.f("play",AudioManager.dh.bind(this))}static dh(t){this.fh||(this.fh={});var i=t.vh;this.fh[i]||(this.fh[i]=new Audio(i));var s=this.fh[t.vh];s.mh||console.log("cutting sfx short "+i),s.ph()}}class ButtonView extends NodeView{static get gh(){return 0}static get wh(){return 1}constructor(t,i,s,e,h,r){super(),this.Ch=ButtonView.gh,this.Sh=!1,this.m=r||{},this.m.Ji=t||"btnID",(i||s)&&this.Vh(i,s,e,h),this.Th=null}Vh(t,i,s,e){t&&this.Rt(t),i&&(s=s||"10px Arial",e=e||"#CCCCCC",this.Bt(i,s,e))}X(t){if(!this._)return console.o("ButtonView - trying to serialize ButtonView when seralizable == false"),{};var i=super.X(t);return i.Z="ButtonView",i.zt=this.m.Ji,this.Sh&&(i.Sh=this.Sh),i}ht(t){super.ht(t),this.m.Ji=t.zt,this.Sh=t.Sh||!1,this.Vh(t.dt,t.Wt,t.wt,t.gt)}s(){this.Th&&clearTimeout(this.Th),this.Th=null,super.s()}Rt(t){super.Rt(t),this.size.T(this.dt.b(),this.dt.x())}P(t,i,s,e){this.ft=this.Ch,super.P(t,i,s,e)}N(t,i,s){if(!this.Sh){if(i-=this.D.nt,s-=this.D.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}var h=0,r=0;if(Config.bh&&(h-=this.size.nt/2,r-=this.size.at/2),Rect2D.ns(i,s,h,r,this.size.nt,this.size.at)&&this.Ch==ButtonView.gh){this.Ch=ButtonView.wh,EventBus.d.Oi(this.m);var n=this;return this.Th=setTimeout(function(){n.Ch=ButtonView.gh},150),void(t.ts=!0)}super.N(t,i,s)}}}class CastCommandState{static get xh(){return 0}static get yh(){return 1}static get Dh(){return 2}static get Mh(){return 3}constructor(t,i){this.Nh=CastCommandState.xh,this.Ah=0,this.Eh=0,this.Ih=0,this.Fh=t,this.Ph=i,this._h=t.Rh||"",this.Bh=t.Lh||0}kh(){if(this.Nh==CastCommandState.yh){var t=CastWorldModel.V();if(t.Oh(this.Ph)){if(this.Ph.Jh(CastCommandTime.V()),0!=this.Bh){var i=this.Ph.zh(this._h);if(this.Bh>0&&this.Bh>i)return void this.Wh()}var s=CastCommandTime.V();if(this.Ah=s,this.Ph.Gh().Uh(this.Fh.Hh(),this.Ph)){for(var e=!1,h=0;h<this.Fh.Kh();h++){var r=new CastEffect;r.qh(this,h,this.Ph,!1),t.jh(this.Ph,r,this.Ph.Gh(),s),e=!0}e&&0!=this.Bh&&this.Ph.Yh(this._h,-1*this.Bh,null),this.Fh.Qh>0?this.Xh():this.Wh()}else this.Wh()}}}Xh(){this.Nh=CastCommandState.Dh,this.Ph.Zh(CastCommandTime.V()),this.$h(this.Fh.tr)}ir(){this.Nh==CastCommandState.Dh&&CastWorldModel.V().Oh(this.Ph)&&(this.Ph.sr(CastCommandTime.V()),this.Wh())}er(){this.Ph.Gh().hr();for(var t=0;t<this.Fh.rr();t++){var i=new CastEffect;i.qh(this,t,this.Ph,!0),CastWorldModel.V().jh(this.Ph,i,this.Ph.Gh(),CastCommandTime.V())}}Wh(){this.Nh=CastCommandState.Mh,this.$h(this.Fh.nr)}ar(){if(this.Nh==CastCommandState.Mh){var t=CastCommandTime.V();this.Ah=t,this.Nh=CastCommandState.xh}}$h(t){CastCommandScheduler.V().or(this.lr.bind(this),t)}cr(){CastCommandScheduler.V().ur(this.lr.bind(this))}dr(){return this.Fh?this.Fh.dr():null}fr(){return 0==this.Ih||this.Ph.zh(this._h)>=this.Bh}vr(){return this.Nh==CastCommandState.yh}mr(){if(this.Nh==CastCommandState.yh){var t=CastCommandTime.V()-this.Ah;return t>this.Fh.pr&&(t=this.Fh.pr),t<0&&(t=0),t/this.Fh.pr}return 0}gr(){return this.Nh==CastCommandState.Dh}wr(){if(this.Nh==CastCommandState.Dh){var t=CastCommandTime.V()-this.Ah;return t>this.Fh.Qh&&(t=this.Fh.Qh),t<0&&(t=0),t/this.Fh.Qh}return 0}Cr(){return this.Nh==CastCommandState.Mh}Sr(){if(this.Nh==CastCommandState.Mh){var t=CastCommandTime.V()-this.Ah;return t>this.Fh.nr&&(t=this.Fh.nr),t<0&&(t=0),t/this.Fh.nr}return 0}Vr(){return this.Nh==CastCommandState.xh}Hh(){return this.Fh?this.Fh.Hh():0}Tr(t){return(t=t||"")?this.Fh.br[t]||{}:this.Fh.br}xr(){return!!this.Vr()&&(this.Nh=CastCommandState.yh,this.Ah=CastCommandTime.V(),this.Eh=0,this.Ph.yr(CastCommandTime.V(),this.Tr("startCast")),0==this.Fh.pr?this.lr(0):this.$h(this.Fh.pr),!0)}lr(t){var i=CastCommandTime.V()-this.Ah;if(this.Nh==CastCommandState.yh)i>=this.Fh.pr?this.kh():console.o("shouldnt happen, cast time");else if(this.Nh==CastCommandState.Dh){i>this.Fh.Qh&&(i=this.Fh.Qh);for(var s=i/this.Fh.tr-this.Eh,e=0;e<s;e++)this.er(),this.Eh++;i>=this.Fh.Qh?this.ir():this.$h(this.Fh.tr)}else this.Nh==CastCommandState.Mh&&(i>=this.Fh.nr?this.ar():console.o("shouldnt happen, cooldown time"))}}class CastCommandModel{constructor(t){var i=t;this.name=i.name||"effectName",this.pr=i.pr||0,this.Qh=i.Qh||0,this.tr=i.tr||1,this.Dr=i.Dr||0,this.Mr=i.Mr||0,this.Nr=i.Ar||!1,this.Er=i.Er||!1,this.nr=i.nr||0,this.Ir=i.Ir||0,this.Fr=0,this.br=i}Pr(){return this.Qh>0}_r(){return this.pr<=0}rr(){return this.br.Rr.length}Br(t){return this.br.Rr[t]}Kh(){return this.br.Lr.length}kr(t){return this.br.Lr[t]}Hh(){return this.Mr}dr(){return this.name}}class CastCommandScheduler{static V(){return CastCommandScheduler.Or||(CastCommandScheduler.Or=new CastCommandScheduler),CastCommandScheduler.Or}constructor(){this.Jr={},this.zr=0}or(t,i){var s=CastCommandTime.V()+i;this.Jr.hasOwnProperty(s)?this.Jr[s].push(t):this.Jr[s]=[t]}ur(t){delete this.Jr[t]}C(){var t=CastCommandTime.V();if(t!=this.zr){this.zr=t;var i=[];for(var s in this.Jr)if(s<=t)for(var e of(i.push(s),this.Jr[s]))e();for(var h=0;h<i.length;h++)delete this.Jr[i[h]]}}}CastCommandScheduler.Or=null;class CastEffectType{static get Wr(){return"DAMAGE_STAT"}static get Ur(){return"SUPPRESS_STAT"}static get Gr(){return"HEAL_STAT"}static get Hr(){return"BUFF_STAT"}static get Kr(){return"SEND_EVENT"}}class CastEffect{constructor(){this.qr=CastEffectType.Wr,this.jr=0,this.Yr=0,this.Qr=0,this.Xr=0,this.Zr=!1,this.$r=!1,this.tn=!1,this.in="",this.sn="",this.en="",this.hn="",this.rn=0,this.nn=0,this.an=null,this.on=null,this.Fh=null,this.ln=null,this.cn=0}s(){this.un()}dn(t){this.$r=!0;var i=t.fn(),s=t.vn(),e=t.cn,h=t.Zr;this.qh(i,e,s,h)}qh(t,i,s,e){this.ln=t,this.Fh=t.Fh,this.cn=i,this.Zr=e;var h=this.Tr();h.hasOwnProperty("name")?this.in=h.name.mn():this.in=this.Fh.dr();var r=h.pn||"damage";if("damage"==r?this.qr=CastEffectType.Wr:"heal"==r?this.qr=CastEffectType.Gr:"buff"==r?this.qr=CastEffectType.Hr:"debuff"==r?this.qr=CastEffectType.Ur:"event"==r&&(this.qr=CastEffectType.Kr),this.on=s,this.tn=h.gn||!1,this.sn=h.wn||"",this.en=h.Cn||"",this.nn=h.Sn||0,h.Vn){var n=this.on.zh(h.Vn);if(void 0==n)console.o("entity does not define value stat "+h.Vn);else{var a=h.Tn;this.nn+=n*a}}this.Yr=h.bn||0,this.Qr=h.xn||this.Qr}ks(t){CastWorldModel.V().Oh(t)&&(this.an=t)}yn(){this.qr==CastEffectType.Hr||this.qr==CastEffectType.Ur||this.qr==CastEffectType.Kr?this.Dn():(this.rn=0,CastCommandScheduler.V().or(this.Mn.bind(this),this.Qr))}Nn(){return this.Yr/this.Qr+1}dr(){return this.in}An(){return this.qr}En(){return this.jr}Gh(){return this.an}In(){return this.on}Fn(){return this.Yr}fn(){return this.ln}vn(){return this.on}Pn(t){return t-this.Yr}_n(){return this.qr==CastEffectType.Hr||this.qr==CastEffectType.Gr}Rn(){this.$r=!0;var t=parent.ln,i=parent.on,s=parent.cn,e=parent.Zr;this.qh(t,s,i,e)}Bn(){return this.Tr().Ln("returnEffect")}kn(){return this.tn}On(){return this.Fh.br.Dr||0}Mn(t){if(CastWorldModel.V().Oh(this.an)){var i=CastCommandTime.V()-this.jr;if(i>this.Yr&&(i=this.Yr),this.qr==CastEffectType.Ur||this.qr==CastEffectType.Hr)i==this.Yr&&(CastCommandScheduler.V().ur(this.Mn.bind(this)),this.qr==CastEffectType.Hr?this.an.Jn(this.en,-1*this.nn,this):this.an.Jn(this.en,this.nn,this),this.an.zn(this));else{for(var s=i/this.Qr-this.rn,e=0;e<s;e++)this.Dn(),this.rn++;i>=this.Yr&&(this.an.zn(this),this.un())}}}un(){CastCommandScheduler.V().ur(this.Mn.bind(this))}Dn(){var t=CastWorldModel.V();if(t.Oh(this.an)){0==this.jr&&(this.jr=CastCommandTime.V());var i=this.Tr();switch(i.hasOwnProperty("react")&&this.an.Wn(i.Un,this),this.qr){case CastEffectType.Wr:this.an.Yh(this.en,-1*this.nn,this);break;case CastEffectType.Gr:this.an.Yh(this.en,this.nn,this);break;case CastEffectType.Ur:this.an.Gn(this.en,-1*this.nn,this),CastCommandScheduler.V().or(this.Mn.bind(this),this.Yr);break;case CastEffectType.Hr:this.an.Gn(this.en,this.nn,this),CastCommandScheduler.V().or(this.Mn.bind(this),this.Yr);break;case CastEffectType.Kr:this.an.Hn(this.in,this);break;default:console.log("TODO: handle effect type "+this.qr)}if(i.Ln("returnEffect")){if(i=i.Kn,!t.Oh(this.on))return;var s=new CastEffect;s.Rn(this),s.nn=this.nn;var e=this.an,h=this.on,r=new CastTarget;r.qn(h),t.jh(e,s,r,CastCommandTime.V()),r=null}}}Tr(t){return null==this.Fh||this.cn<0?{}:t?i[t]||{}:(i=this.Zr?this.Fh.Br(this.cn):this.Fh.kr(this.cn),this.$r&&(i=i.Kn||{}),i);var i}ii(){var t=new CastEffect;return t.qr=this.qr,t.jr=this.jr,t.Yr=this.Yr,t.Qr=this.Qr,t.sn=this.sn,t.en=this.en,t.hn=this.hn,t.rn=this.rn,t.nn=this.nn,t.an=this.an,t.on=this.on,t.Fh=this.Fh,t.ln=this.ln,t.cn=this.cn,t.Zr=this.Zr,t.$r=this.$r,t.in=this.in,t}}class ICastEntity{constructor(){CastWorldModel.V().jn(this)}s(){CastWorldModel.V().Yn(this)}Qn(t,i,s){}Yh(t,i,s){}Gn(t,i,s){}Jn(t,i,s){}zh(t){return 0}Gh(){return null}Wn(t,i){}Hn(t,i){}Xn(t){}zn(t){}yr(t,i){}Zh(t,i){}Jh(t){}sr(t){}}class CastTargetType{static get Zn(){return 0}static get $n(){return 1}static get ta(){return 2}}class CastTarget{constructor(t){t=t||CastTargetType.Zn,this.qr=t,this.ia=new Vec2D,this.sa=[]}ea(){return this.sa}An(){return this.qr}ha(){this.sa.length=0}qn(t){t&&(this.qr=CastTargetType.Zn,this.sa.push(t))}ra(t){this.ia=t}hr(){for(var t=CastWorldModel.V(),i=this.sa.length-1;i>=0;i--)t.Oh(this.sa[i])||this.sa.splice(i,1)}Uh(t,i){var s=t*t;if(this.qr==CastTargetType.Zn){for(var e=!1,h=CastWorldModel.V(),r=this.sa.length-1;r>=0;r--)if(h.Oh(this.sa[r])){if(!e){var n=this.sa[r],a=h.aa().na(i,n);a&&a.oa()<=s&&(e=!0)}}else this.sa.splice(r,1);return e}return!0}la(){return this.qr!=CastTargetType.Zn||(this.hr(),this.sa.length>0)}}class CastEffectPath{constructor(){this.Js=0,this.ca=0,this.from=null,this.ua=null,this.da=new Vec2D,this.bt=0,this.fa=[]}}class CastWorldModel{static V(){return CastWorldModel.Or||(CastWorldModel.Or=new CastWorldModel),CastWorldModel.Or}constructor(){this.va={},this.ma=[],this.pa=null}jn(t){this.va[t]=t}Yn(t){this.va[t]&&delete this.va[t]}ga(t){this.pa=t}aa(){return this.pa}jh(t,i,s,e){var h=i.On();if(0!=h)if(s.An()==CastTargetType.Zn){var r=new CastEffectPath;r.from=t,r.bt=0,r.ca=h,r.Js=e;for(var n=s.ea(),a=0;a<n.length;a++){var o=n[a];CastWorldModel.V().Oh(t)&&(CastWorldModel.V().Oh(o)&&(console.log("add effect in transit"),r.ua=o,r.fa.push(i)))}this.ma.push(r)}else console.et("non-entity target type not yet implemented");else this.wa(t,i,s,e)}wa(t,i,s,e){if(s.An()==CastTargetType.Zn){var h=new CastEffectPath;h.from=t,h.bt=0,h.ca=0,h.Js=e;for(var r=s.ea(),n=0;n<r.length;n++){var a=r[n];CastWorldModel.V().Oh(t)&&(CastWorldModel.V().Oh(a)&&(h.ua=a,h.fa.push(i)))}this.Ca(h),i=null}else console.et("non-entity target type not yet implemented")}Ca(t){for(var i=CastCommandTime.V(),s=0;s<t.fa.length;s++){var e=t.fa[s],h=[];if(null!=t.ua){if(CastWorldModel.V().Oh(t.ua)&&(h.push(t.ua),e.kn())){var r=e.Tr("aoeRadius"),n=this.pa.Sa(t.ua,n);n&&(console.log("possible bug here -- add targets dont overwrite it?"),h=this.pa.Va(n,r))}}else h=this.pa.Va(t.da,t.bt);for(var a={},o=0;o<h.length;o++){var l=h[o];if(!a[l]){a[l]=l;var c=e;o>0&&(c=e.ii()),c.ks(l),c.jr=i,l.Xn(c)}}}}Ta(t){var i=[];CastCommandTime.ba(t);for(var s=CastCommandTime.V(),e=0;e<this.ma.length;e++){var h=this.ma[e],r=1/h.ca;s-h.Js>=r&&(this.Ca(h),i.push(e));for(e=i.length-1;e>=0;e--){for(var n=this.ma[e].fa.length-1;n>=0;n--)this.ma[e].fa[n]=null;this.ma[e].fa.length=0,this.ma.splice(e,1)}}CastCommandScheduler.V().C()}Oh(t){return!!this.va[t]}}CastWorldModel.Or=null;class CastCommandTime{static V(){return CastCommandTime.xa}static ba(t){return CastCommandTime.xa+=t,CastCommandTime.xa}static ya(t){return CastCommandTime.xa=t,CastCommandTime.xa}}CastCommandTime.xa=0;class ICastPhysics{na(t,i){return null}Sa(t){return null}Va(t,i,s){return null}}class EventBus{constructor(t){this.Da={},this.Ma=t,this.Na=!0}s(){for(var t of this.Da)this.Aa(t)}f(t,i){t in this.Da||(this.Da[t]=[]),this.Da[t].push(i)}w(t,i){if(t in this.Da){var s=this.Da[t].indexOf(i);this.Da[t].splice(s,1)}}Aa(t){this.Da[t]=[]}Oi(t,i){("string"==typeof t||t instanceof String)&&(t={Ji:t}),t.Ji?(this.Na&&!i&&console.log("EB["+this.Ma+"] "+t.Ji+":%O",t),this.Da[t.Ji]&&this.Da[t.Ji].forEach(function(i,s,e){i(t)})):console.log("abort dispatch event -- no evtName %O",t)}static V(t){return this.Ea||(this.Ea={}),this.Ea[t]||(this.Ea[t]=new EventBus(t)),this.Ea[t]}static get Ia(){return this.V("game")}static get d(){return this.V("ui")}static get uh(){return this.V("sfx")}}exports.Fa=EventBus,function(t){if("object"==typeof module&&"object"==typeof module.Pa)module.Pa=t();else if("function"==typeof define&&define._a)define([],t);else{var i=t();window.Ra=i.Ra,window.Ba=i.Ba}}(function(){function t(t){for(var i=t,s=[];i.z;)s.unshift(i),i=i.z;return s}var i={search:function(s,e,r,n){s.La();var a=(n=n||{}).ka||i.Ja.Oa,o=n.za||!1,l=new h(function(t){return t.Wa}),c=e;for(e.Nt=a(e,r),s.Ua(e),l.push(e);l.size()>0;){var u=l.pop();if(u===r)return t(u);u.Ga=!0;for(var d=s.Ha(u),f=0,v=d.length;f<v;++f){var m=d[f];if(!m.Ga&&!m.Ka()){var p=u.qa+m.ja(u),g=m.Ya;(!g||p<m.qa)&&(m.Ya=!0,m.z=u,m.Nt=m.Nt||a(m,r),m.qa=p,m.Wa=m.qa+m.Nt,s.Ua(m),o&&(m.Nt<c.Nt||m.Nt===c.Nt&&m.qa<c.qa)&&(c=m),g?l.Qa(m):l.push(m))}}}return o?t(c):[]},Ja:{Oa:function(t,i){return Math.abs(i.nt-t.nt)+Math.abs(i.at-t.at)},Xa:function(t,i){var s=Math.sqrt(2),e=Math.abs(i.nt-t.nt),h=Math.abs(i.at-t.at);return 1*(e+h)+(s-2)*Math.min(e,h)}},Za:function(t){t.Wa=0,t.qa=0,t.Nt=0,t.Ya=!1,t.Ga=!1,t.z=null}};function s(t,i){i=i||{},this.$a=[],this.Xa=!!i.Xa,this.to=[];for(var s=0;s<t.length;s++){this.to[s]=[];for(var h=0,r=t[s];h<r.length;h++){var n=new e(s,h,r[h]);this.to[s][h]=n,this.$a.push(n)}}this.qh()}function e(t,i,s){this.nt=t,this.at=i,this.io=s}function h(t){this.so=[],this.eo=t}return s.prototype.qh=function(){this.ho=[];for(var t=0;t<this.$a.length;t++)i.Za(this.$a[t])},s.prototype.La=function(){for(var t=0;t<this.ho.length;t++)i.Za(this.ho[t]);this.ho=[]},s.prototype.Ua=function(t){this.ho.push(t)},s.prototype.Ha=function(t){var i=[],s=t.nt,e=t.at,h=this.to;return h[s-1]&&h[s-1][e]&&i.push(h[s-1][e]),h[s+1]&&h[s+1][e]&&i.push(h[s+1][e]),h[s]&&h[s][e-1]&&i.push(h[s][e-1]),h[s]&&h[s][e+1]&&i.push(h[s][e+1]),this.Xa&&(h[s-1]&&h[s-1][e-1]&&i.push(h[s-1][e-1]),h[s+1]&&h[s+1][e-1]&&i.push(h[s+1][e-1]),h[s-1]&&h[s-1][e+1]&&i.push(h[s-1][e+1]),h[s+1]&&h[s+1][e+1]&&i.push(h[s+1][e+1])),i},s.prototype.toString=function(){for(var t=[],i=this.to,s=0;s<i.length;s++){for(var e=[],h=i[s],r=0;r<h.length;r++)e.push(h[r].io);t.push(e.join(" "))}return t.join("\n")},e.prototype.toString=function(){return"["+this.nt+" "+this.at+"]"},e.prototype.ja=function(t){return t&&t.nt!=this.nt&&t.at!=this.at?1.41421*this.io:this.io},e.prototype.Ka=function(){return 0===this.io},h.prototype={push:function(t){this.so.push(t),this.ro(this.so.length-1)},pop:function(){var t=this.so[0],i=this.so.pop();return this.so.length>0&&(this.so[0]=i,this.no(0)),t},ao:function(t){var i=this.so.indexOf(t),s=this.so.pop();i!==this.so.length-1&&(this.so[i]=s,this.eo(s)<this.eo(t)?this.ro(i):this.no(i))},size:function(){return this.so.length},Qa:function(t){this.ro(this.so.indexOf(t))},ro:function(t){for(var i=this.so[t];t>0;){var s=(t+1>>1)-1,e=this.so[s];if(!(this.eo(i)<this.eo(e)))break;this.so[s]=i,this.so[t]=e,t=s}},no:function(t){for(var i=this.so.length,s=this.so[t],e=this.eo(s);;){var h,r=t+1<<1,n=r-1,a=null;if(n<i){var o=this.so[n];(h=this.eo(o))<e&&(a=n)}if(r<i){var l=this.so[r];this.eo(l)<(null===a?e:h)&&(a=r)}if(null===a)break;this.so[t]=this.so[a],this.so[a]=s,t=a}}},{Ra:i,Ba:s}}),function(){var t=[];(window.oo=function(i){var s=this;i=i||{},s.lo=i.Fi||null,s.co=s.lo?s.lo.uo("2d"):null,s.do=i.nt||0,s.fo=i.at||0,s.vo=i.mo||0,s.po=i.go||0,s.wo=i.Co||14,s.So=i.Vo||"Arial",s.To=i.bo||"#000",s.xo=i.yo||"#bfbebd",s.Do=i.Mo||"normal",s.No=i.Ao||"normal",s.Eo=i.Io||"",s.Fo=i.Po||0,s._o=i.Ro||0,s.Bo=i.Lo||0,s.ko=i.Oo||!1,s.Jo=i.zo||null,s.Wo=i.ci||150,s.Uo=i.ui||s.wo,s.Go=i.Pi>=0?i.Pi:5,s.Ho=i.Ko>=0?i.Ko:1,s.qo=i.jo||"#959595",s.Yo=i._i>=0?i._i:3,s.Qo=i.Xo||"",s.Zo=i.Ri||"1px 1px 0px rgba(255, 255, 255, 1)",s.$o=i.Bi||"0px 0px 4px rgba(0, 0, 0, 0.4)",s.tl=i.il||"rgba(179, 212, 253, 0.8)",s.sl=i.el||"",s.hl=(i.zi||s.sl)+"",s.rl=i.ki||function(){},s.nl=i.Be||function(){},s.al=i.ws||function(){},s.ol=i.ll||function(){},s.cl=i.ul||function(){},s.dl=!1,s.fl=0,s.vl=!1,s.ml=[0,0],s.pl=!1,s.Ri(s.Zo,!0),s.gl(),s.wl=document.Cl("canvas"),s.wl.Sl("width",s.Vl),s.wl.Sl("height",s.Tl),s.bl=s.wl.uo("2d"),s.xl=document.Cl("canvas"),s.xl.Sl("width",s.Wo+2*s.Go),s.xl.Sl("height",s.Uo+2*s.Go),s.yl=s.xl.uo("2d"),void 0!==i.Dl?(s.Ml=s.bl.Nl(0,0,0,s.Tl),s.Ml.Al(0,i.Dl[0]),s.Ml.Al(1,i.Dl[1])):s.Ml=i.El||"#fff",s.lo&&(s.lo.Il("mousemove",function(t){t=t||window.xi,s.Fl(t,s)},!1),s.lo.Il("mousedown",function(t){t=t||window.xi,s.Pl(t,s)},!1),s.lo.Il("mouseup",function(t){t=t||window.xi,s._l(t,s)},!1)),window.Il("mouseup",function(t){t=t||window.xi,s.vl&&!s.Rl&&s.Bl()},!0),s.Ll=document.Cl("input"),s.Ll.kl="text",s.Ll.Jl.Ol="absolute",s.Ll.Jl.zl=0,s.Ll.Jl.Wl="none",s.Ll.Jl.ke=s.do+s.vo+(s.lo?s.lo.Oe:0)+"px",s.Ll.Jl.ze=s.fo+s.po+(s.lo?s.lo.We:0)+"px",s.Ll.Jl.ci=s.Wo+"px",s.Ll.Jl.ui=s.Uo+"px",s.Ll.Jl.Ul=0,s.Jo&&(s.Ll.Gl=s.Jo),document.Kl.Hl(s.Ll),s.Ll.zi=s.hl,s.Ll.Il("keydown",function(t){t=t||window.xi,s.vl&&s.gs(t,s)}),s.Ll.Il("keyup",function(t){t=t||window.xi,s.hl=s.Ll.zi,s.fl=s.Ll.ql,s.ml=[s.Ll.ql,s.Ll.jl],s.Yl(),s.vl&&s.al(t,s)}),t.push(s),s.Ql=t.length-1,s.Yl()}).prototype={Fi:function(t){return void 0!==t?(this.lo=t,this.co=this.lo.uo("2d"),this.Yl()):this.lo},nt:function(t){return void 0!==t?(this.do=t,this.Yl()):this.do},at:function(t){return void 0!==t?(this.fo=t,this.Yl()):this.fo},mo:function(t){return void 0!==t?(this.vo=t,this.Yl()):this.vo},go:function(t){return void 0!==t?(this.po=t,this.Yl()):this.po},Co:function(t){return void 0!==t?(this.wo=t,this.Yl()):this.wo},Vo:function(t){return void 0!==t?(this.So=t,this.Yl()):this.So},bo:function(t){return void 0!==t?(this.To=t,this.Yl()):this.To},yo:function(t){return void 0!==t?(this.xo=t,this.Yl()):this.xo},Mo:function(t){return void 0!==t?(this.Do=t,this.Yl()):this.Do},Ao:function(t){return void 0!==t?(this.No=t,this.Yl()):this.No},Io:function(t){return void 0!==t?(this.Eo=t,this.Yl()):this.Eo},Po:function(t){return void 0!==t?(this.Fo=t,this.Yl()):this.Fo},Ro:function(t){return void 0!==t?(this._o=t,this.Yl()):this._o},Lo:function(t){return void 0!==t?(this.Bo=t,this.Yl()):this.Bo},ci:function(t){return void 0!==t?(this.Wo=t,this.gl(),this.Xl(),this.Yl()):this.Wo},ui:function(t){return void 0!==t?(this.Uo=t,this.gl(),this.Xl(),this.Yl()):this.Uo},Pi:function(t){return void 0!==t?(this.Go=t,this.gl(),this.Xl(),this.Yl()):this.Go},Ko:function(t){return void 0!==t?(this.Ho=t,this.gl(),this.Xl(),this.Yl()):this.Ho},jo:function(t){return void 0!==t?(this.qo=t,this.Yl()):this.qo},_i:function(t){return void 0!==t?(this.Yo=t,this.Yl()):this.Yo},El:function(t){return void 0!==t?(this.Ml=t,this.Yl()):this.Ml},Dl:function(t){return void 0!==t?(this.Ml=this.bl.Nl(0,0,0,this.Tl),this.Ml.Al(0,t[0]),this.Ml.Al(1,t[1]),this.Yl()):this.Ml},Ri:function(t,i){if(void 0===t)return this.Zo;var s=t.split("px ");return this.Zo={nt:"none"===this.Zo?0:parseInt(s[0],10),at:"none"===this.Zo?0:parseInt(s[1],10),Bl:"none"===this.Zo?0:parseInt(s[2],10),Zl:"none"===this.Zo?"":s[3]},this.Zo.nt<0?(this.$l=Math.abs(this.Zo.nt)+this.Zo.Bl,this.tc=this.Zo.Bl+this.Zo.nt):(this.$l=Math.abs(this.Zo.Bl-this.Zo.nt),this.tc=this.Zo.Bl+this.Zo.nt),this.Zo.at<0?(this.ic=Math.abs(this.Zo.at)+this.Zo.Bl,this.sc=this.Zo.Bl+this.Zo.at):(this.ic=Math.abs(this.Zo.Bl-this.Zo.at),this.sc=this.Zo.Bl+this.Zo.at),this.ec=this.$l+this.tc,this.hc=this.ic+this.sc,this.gl(),i?void 0:(this.Xl(),this.Yl())},Bi:function(t){return void 0!==t?(this.$o=t,this.Yl()):this.$o},il:function(t){return void 0!==t?(this.tl=t,this.Yl()):this.tl},el:function(t){return void 0!==t?(this.sl=t,this.Yl()):this.sl},zi:function(t){return void 0!==t?(this.hl=t+"",this.Ll.zi=t+"",this.fl=this.rc().length,this.Yl(),this):this.hl===this.sl?"":this.hl},ki:function(t){if(void 0!==t)return this.rl=t,this;this.rl()},Be:function(t){if(void 0!==t)return this.nl=t,this;this.nl()},ws:function(t){if(void 0!==t)return this.al=t,this;this.al()},nc:function(i){var s=this;if(!s.vl){s.ol(s);for(var e=0;e<t.length;e++)t[e].vl&&t[e].Bl()}if(s.ac?delete s.ac:s.ml=[0,0],s.vl=!0,!s.ko){s.Ll.oc=!1,s.fl="number"==typeof i?i:s.rc().length,s.sl===s.hl&&(s.hl="",s.Ll.zi=""),s.dl=!0,s.lc&&clearInterval(s.lc),s.lc=setInterval(function(){s.dl=!s.dl,s.Yl()},500);var h=s.ml[0]>0||s.ml[1]>0;return s.Ll.nc(),s.Ll.ql=h?s.ml[0]:s.fl,s.Ll.jl=h?s.ml[1]:s.fl,s.Yl()}s.Ll.oc=!0},Bl:function(t){var i=t||this;return i.cl(i),i.lc&&clearInterval(i.lc),i.vl=!1,i.dl=!1,i.ml=[0,0],i.Ll.Bl(),""===i.hl&&(i.hl=i.sl),i.Yl()},gs:function(i,s){var e=i.Ge;i.cc;if(!s.ko&&s.vl){if(s.nl(i,s),65===e&&(i.uc||i.dc))return s.fc(),i.vc(),s.Yl();if(17===e||i.dc||i.uc)return s;if(13===e)i.vc(),s.rl(i,s);else if(9===e&&(i.vc(),t.length>1)){var h=t[s.Ql+1]?s.Ql+1:0;s.Bl(),setTimeout(function(){t[h].nc()},10)}return s.hl=s.Ll.zi,s.fl=s.Ll.ql,s.ml=[0,0],s.Yl()}},mc:function(t,i){var s=i.pc(t),e=s.nt,h=s.at;return i.gc?(delete i.gc,void delete i.ac):i.lo&&i.wc(e,h)||!i.lo?i.Rl?(i.Rl=!1,i.mc(t,i),i.nc(i.Cc(e,h))):void 0:i.Bl()},Fl:function(t,i){var s=i.pc(t),e=s.nt,h=s.at,r=i.wc(e,h);if(r&&i.lo?(i.lo.Jl.Sc="text",i.pl=!0):i.pl&&i.lo&&(i.lo.Jl.Sc="default",i.pl=!1),i.vl&&i.Vc>=0){var n=i.Cc(e,h),a=Math.min(i.Vc,n),o=Math.max(i.Vc,n);if(!r)return i.ac=!0,i.gc=!0,delete i.Vc,void i.Yl();i.ml[0]===a&&i.ml[1]===o||(i.ml=[a,o],i.Yl())}},Pl:function(t,i){var s=i.pc(t),e=s.nt,h=s.at,r=i.wc(e,h);i.Rl=r,i.vl&&r&&(i.Vc=i.Cc(e,h))},_l:function(t,i){var s=i.pc(t),e=s.nt,h=s.at,r=i.Cc(e,h)!==i.Vc;i.vl&&i.Vc>=0&&i.wc(e,h)&&r?(i.ac=!0,delete i.Vc,i.Yl()):delete i.Vc,i.mc(t,i)},fc:function(t){var i=this;t=t||[0,i.hl.length];return setTimeout(function(){i.ml=[t[0],t[1]],i.Ll.ql=t[0],i.Ll.jl=t[1],i.Yl()},1),i},Tc:function(){return this.wl},Yl:function(){},Ui:function(t,i){var s=this,e=s.bl,h=s.Vl,r=s.Tl,n=s.Yo,a=s.Ho,o=s.ec,l=s.hc;e&&(e.bc=s.Zo.nt,e.xc=s.Zo.at,e.yc=s.Zo.Bl,e.Dc=s.Zo.Zl,s.Ho>0&&(e.xt=s.qo,s.Mc(e,s.$l,s.ic,h-o,r-l,n),e.fill(),e.bc=0,e.xc=0,e.yc=0),s.Nc(function(){e.bc=0,e.xc=0,e.yc=0;var c=s.rc(),u=s.Go+s.Ho+s.ic;if(s.ml[1]>0){var d=s.Ac(c.substring(0,s.ml[0])),f=s.Ac(c.substring(s.ml[0],s.ml[1]));e.xt=s.tl,e.Ec(u+d,u,f,s.Uo)}if(s.dl){var v=s.Ac(c.substring(0,s.fl));e.xt=s.To,e.Ec(u+v,u,1,s.Uo)}var m=s.Go+s.Ho+s.$l,p=Math.round(u+s.Uo/2);c=""===c&&s.sl?s.sl:c,e.xt=""!==s.hl&&s.hl!==s.sl?s.To:s.xo,e.Ic=s.No+" "+s.Do+" "+s.wo+"px "+s.So,e.Dc=s.Eo,e.yc=s.Fo,e.bc=s._o,e.xc=s.Bo,e.Fc="left",e.Pc="middle",e._c(c,m,p);var g=s.$o.split("px "),w="none"===s.$o?0:parseInt(g[0],10),C="none"===s.$o?0:parseInt(g[1],10),S="none"===s.$o?0:parseInt(g[2],10),V="none"===s.$o?"":g[3];if(S>0){var T=s.yl,b=T.Fi.ci,x=T.Fi.ui;T.Rc(0,0,b,x),T.yc=S,T.Dc=V,T.bc=0,T.xc=C,T.Ec(-1*h,-100,3*h,100),T.bc=w,T.xc=0,T.Ec(b,-1*r,100,3*r),T.bc=0,T.xc=C,T.Ec(-1*h,x,3*h,100),T.bc=w,T.xc=0,T.Ec(-100,-1*r,100,3*r),s.Mc(e,a+s.$l,a+s.ic,h-2*a-o,r-2*a-l,n),e.Bc(),e.di(s.xl,0,0,b,x,a+s.$l,a+s.ic,b,x)}return s.co&&s.co.di(s.wl,t,i),s}))},Ht:function(){var i=t.indexOf(this);-1!=i&&t.splice(i,1),this.vl&&this.Bl(),document.Kl.Vs(this.Ll),this.wl=null,this.xl=null,this.bl=null},Nc:function(t){var i=this,s=i.bl,e=i.Vl,h=i.Tl,r=i.Yo,n=i.Ho,a=i.ec,o=i.hc;if(""===i.Qo)s.xt=i.Ml,i.Mc(s,n+i.$l,n+i.ic,e-2*n-a,h-2*n-o,r),s.fill(),t();else{var l=new Image;l.Lc=i.Qo,l.kc=function(){s.di(l,0,0,l.ci,l.ui,n+i.$l,n+i.ic,e,h),t()}}},Oc:function(){if(this.ml[1]>0){var t=this.ml[0],i=this.ml[1];return this.hl=this.hl.substr(0,t)+this.hl.substr(i),this.fl=t,this.fl=this.fl<0?0:this.fl,this.ml=[0,0],!0}return!1},rc:function(t){t=void 0===t?this.hl:t;var i=this.Ac(t)/(this.Wo-this.Go);return(i>1?t.substr(-1*Math.floor(t.length/i)):t)+""},Ac:function(t){var i=this.bl;return i.Ic=this.No+" "+this.Do+" "+this.wo+"px "+this.So,i.Fc="left",i.Jc(t).ci},gl:function(){this.Vl=this.Wo+2*this.Go+2*this.Ho+this.ec,this.Tl=this.Uo+2*this.Go+2*this.Ho+this.hc},Xl:function(){this.wl.ci,this.wl.ui;this.wl.Sl("width",this.Vl),this.wl.Sl("height",this.Tl),this.xl.Sl("width",this.Wo+2*this.Go),this.xl.Sl("height",this.Uo+2*this.Go),this.co},Mc:function(t,i,s,e,h,r){e<2*r&&(r=e/2),h<2*r&&(r=h/2),t.zc(),t.Wc(i+r,s),t.Uc(i+e-r,s),t.Gc(i+e,s,i+e,s+r),t.Uc(i+e,s+h-r),t.Gc(i+e,s+h,i+e-r,s+h),t.Uc(i+r,s+h),t.Gc(i,s+h,i,s+h-r),t.Uc(i,s+r),t.Gc(i,s,i+r,s),t.Hc()},wc:function(t,i){var s=t>=this.Li.nt+this.vo,e=t<=this.Li.nt+this.vo+this.Wo+2*this.Go,h=i>=this.Li.at+this.po,r=i<=this.Li.at+this.po+this.Uo+2*this.Go;return s&&e&&h&&r},Cc:function(t,i){var s=this.hl;this.hl===this.sl&&(s="");var e=this.rc(s),h=0,r=e.length;if(t-(this.Li.nt+this.vo)<this.Ac(e))for(var n=0;n<e.length;n++)if((h+=this.Ac(e[n]))>=t-(this.Li.nt+this.vo)){r=n;break}return r},pc:function(t){var i=t.Ws,s=document.qc.Kc(i,void 0),e=parseInt(s.jc,10)||0,h=parseInt(s.jc,10)||0,r=parseInt(s.Yc,10)||0,n=parseInt(s.Yc,10)||0,a=document.Kl.Qc.We||0,o=document.Kl.Qc.Oe||0,l=0,c=0;if(void 0!==i.Xc)do{l+=i.Oe,c+=i.We}while(i=i.Xc);return l+=e+r+o,c+=h+n+a,{nt:t.Zc-l,at:t.$c-c}}}}(),function(){var t,i=this;if("function"==typeof i.tu)try{var s=i.tu("crypto").iu;t=s&&function(){return s(16)}}catch(t){}if(!t&&i.su&&crypto.eu){var e=new Uint8Array(16);t=function(){return crypto.eu(e),e}}if(!t){var h=new Array(16);t=function(){for(var t,i=0;i<16;i++)0==(3&i)&&(t=4294967296*Math.random()),h[i]=t>>>((3&i)<<3)&255;return h}}for(var r="function"==typeof i.hu?i.hu:Array,n=[],a={},o=0;o<256;o++)n[o]=(o+256).toString(16).substr(1),a[n[o]]=o;function l(t,i){var s=i||0,e=n;return e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]}var c=t(),u=[1|c[0],c[1],c[2],c[3],c[4],c[5]],d=16383&(c[6]<<8|c[7]),f=0,v=0;function m(i,s,e){var h=s&&e||0;"string"==typeof i&&(s="binary"==i?new r(16):null,i=null);var n=(i=i||{}).random||(i.ru||t)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,s)for(var a=0;a<16;a++)s[h+a]=n[a];return s||l(n)}var p=m;if(p.nu=function(t,i,s){var e=i&&s||0,h=i||[],r=null!=(t=t||{}).au?t.au:d,n=null!=t.ou?t.ou:(new Date).getTime(),a=null!=t.lu?t.lu:v+1,o=n-f+(a-v)/1e4;if(o<0&&null==t.au&&(r=r+1&16383),(o<0||n>f)&&null==t.lu&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=n,v=a,d=r;var c=(1e4*(268435455&(n+=122192928e5))+a)%4294967296;h[e++]=c>>>24&255,h[e++]=c>>>16&255,h[e++]=c>>>8&255,h[e++]=255&c;var m=n/4294967296*1e4&268435455;h[e++]=m>>>8&255,h[e++]=255&m,h[e++]=m>>>24&15|16,h[e++]=m>>>16&255,h[e++]=r>>>8|128,h[e++]=255&r;for(var p=t.Wi||u,g=0;g<6;g++)h[e+g]=p[g];return i||l(h)},p.cu=m,p.parse=function(t,i,s){var e=i&&s||0,h=0;for(i=i||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){h<16&&(i[e+h++]=a[t])});h<16;)i[e+h++]=0;return i},p.uu=l,p.du=r,"function"==typeof define&&define._a)define(function(){return p});else if("undefined"!=typeof module&&module.Pa)module.Pa=p;else{var g=i.fu;p.vu=function(){return i.fu=g,p},i.fu=p}}.call(this);class Graphics{static get mu(){return Service.V("gfx").pu()}constructor(t){this.Fi=document.gu(t),this.xt="#FF0000",this.yt="#FFFFFF",this.Ft=1,this.Ic="30px Arial",this.wu=this.Fi.uo("2d"),this.Cu=!!Config&&Config.bh,this.Su=!!Config&&Config.Su,this.Na=!1,Service.r("gfx",this)}b(){return this.Fi.Vu}x(){return this.Fi.Tu}pu(){return new Vec2D(this.b(),this.x())}ri(t){this.wu.bu=t}xu(){return this.wu.yu}Ms(t){this.wu.yu=t}oh(t){this.wu=this.Fi.uo("2d"),t&&this.Du()}Du(){this.wu.Rc(0,0,this.b(),this.x())}ys(){this.wu.Mu()}Ns(){this.wu.Nu()}Ds(t,i){this.wu.Ds(t,i)}rs(t,i){i&&(t*=-1),this.wu.rs(t)}L(t){this.wu.L(t,t)}Au(t,i){return""!=t&&(void 0==t?i:t)}Eu(t,i,s,e){this.wu.xt=this.xt,this.Na&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cu&&(t-=s/2,i-=e/2),this.wu.Ec(t,i,s,e)}ai(t,i,s,e,h){this.wu.xt=h||this.xt,this.Na&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cu&&(t-=s/2,i-=e/2),this.wu.Ec(t,i,s,e)}Iu(t,i,s,e){this.wu.yt=this.yt,this.wu.Fu=this.Ft,this.Na&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cu&&(t-=s/2,i-=e/2),this.wu.Pu(t,i,s,e)}_u(t,i,s,e,h,r){this.wu.yt=h||this.yt,this.wu.Fu=r||this.Ft,this.Na&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Cu&&(t-=s/2,i-=e/2),this.wu.Pu(t,i,s,e)}oi(t,i,s,e){var h=this.Au(i,this.xt),r=this.Au(s,this.yt);this.wu.xt=h,this.wu.yt=r,this.wu.Fu=e||this.Ft,this.wu.zc();var n=t[0];this.wu.Wc(n.nt,n.at);for(var a=1;a<t.length;a++)this.wu.Uc(t[a].nt,t[a].at);this.wu.Hc(),h&&this.wu.fill(),r&&this.wu.It()}Ru(t,i,s,e){var h=this.Au(i,this.xt),r=this.Au(s,this.yt);this.wu.xt=h,this.wu.yt=r,this.wu.Fu=e||this.Ft,this.wu.zc();var n=t[0];this.wu.Wc(n[0],n[1]);for(var a=1;a<t.length;a++)this.wu.Uc(t[a][0],t[a][1]);this.wu.Hc(),h&&this.wu.fill(),r&&this.wu.It()}Bu(t,i,s,e){var h=this.Au(i,this.xt),r=this.Au(s,this.yt);this.wu.xt=h,this.wu.yt=r,this.wu.Fu=e||this.Ft,4==t.length?(this.wu.zc(),this.wu.Wc(t[0].nt,t[0].at),this.wu.Lu(t[1].nt,t[1].at,t[2].nt,t[2].at,t[3].nt,t[3].at),this.wu.Hc(),h&&this.wu.fill(),r&&this.wu.It()):console.et("Graphics.drawCubicBezierEx() - invalid number of verts, must be 4")}ku(t,i,s,e){this.wu.yt=this.yt,this.wu.Fu=this.Ft,this.wu.zc(),this.wu.Wc(t,i),this.wu.Uc(s,e),this.wu.It(),this.wu.Hc(),this.Na&&console.log("line at "+t+","+i+" x "+s+","+e)}Ou(t,i,s,e,h,r){this.wu.yt=h||this.yt,this.wu.Fu=r||this.Ft,this.wu.zc(),this.wu.Wc(t,i),this.wu.Uc(s,e),this.wu.It(),this.wu.Hc(),this.Na&&console.log("line at "+t+","+i+" x "+s+","+e)}Ju(t,i,s){var e=this.xt,h=this.yt;this.wu.xt=e,this.wu.yt=h,this.wu.Fu=this.Ft,this.wu.zc(),this.wu.zu(t,i,s,0,2*Math.PI,!1),this.wu.Hc(),e&&this.wu.fill(),h&&this.wu.It(),this.Na&&console.log("circle at "+t+","+i+" x "+s)}ni(t,i,s,e,h,r){var n=this.Au(e,this.xt),a=this.Au(h,this.yt);this.wu.xt=n,this.wu.yt=a,this.wu.Fu=r||this.Ft,this.wu.zc(),this.wu.zu(t,i,s,0,2*Math.PI,!1),this.wu.Hc(),n&&this.wu.fill(),a&&this.wu.It()}Wu(t,i,s){if(this.wu.Ic=this.Ic,this.wu.xt=this.xt,this.Cu){var e=this.wu.Jc(t);i-=e.ci/2,this.Su&&(s+=(e=this.wu.Jc("M")).ci/2)}this.wu._c(t,i,s)}Ni(t,i,s,e,h,r){var n=this.Au(h,this.xt);if(this.wu.Ic=e||this.Ic,this.wu.xt=n,r){var a=t.split("\n"),o=1.5*this.wu.Jc("m").ci;for(var l of a){var c=i;if(this.Cu)c-=this.wu.Jc(l).ci/2;this.wu._c(l,c,s),s+=o}}else{if(this.Cu){var u=this.wu.Jc(t);i-=u.ci/2,this.Su&&(s+=(u=this.wu.Jc("M")).ci/2)}this.wu._c(t,i,s)}}Ai(t,i,s,e,h,r,n){this.wu.Ic=e||this.Ic;var a=this.Au(h,this.yt);if(this.wu.yt=a,this.wu.Fu=r||this.Ft,n){var o=t.split("\n"),l=1.5*this.wu.Jc("m").ci;for(var c of o){var u=i;if(this.Cu)u-=this.wu.Jc(c).ci/2;this.wu.Uu(c,u,s),s+=l}}else{if(this.Cu){var d=this.wu.Jc(t);i-=d.ci/2,this.Su&&(s+=(d=this.wu.Jc("M")).ci/2)}this.wu.Uu(t,i,s)}}Mi(t,i,s){this.wu.Ic=i||this.Ic;var e=0,h=0;if(s){var r=t.split("\n");for(var n of r){var a=this.wu.Jc(n).ci;a>h&&(h=a),e++}}else e=1,h=this.wu.Jc(t).ci;var o=this.wu.Jc("m").ci*e*1.5;return new Vec2D(h,o)}di(t,i,s){this.Cu&&(i-=t.ci/2,s-=t.ui/2),this.wu.di(t,i,s)}fi(t,i,s,e,h,r){r?(this.wu.Mu(),this.wu.L(-1,1),this.wu.di(t,0,0,t.ci,t.ui,-1*i-t.ci,s,e,h),this.wu.Nu()):this.wu.di(t,0,0,t.ci,t.ui,i,s,e,h)}Gu(t,i,s,e,h,r,n,a){this.Cu&&(i-=r/2,s-=n/2),a?(this.wu.Mu(),this.wu.L(-1,1),this.wu.di(t,e,h,r,n,-1*i-r,s,r,n),this.wu.Nu()):this.wu.di(t,e,h,r,n,i,s,r,n)}Hu(t,i,s,e,h,r){this.Cu&&(i-=e/2,s-=h/2),r=r||1;for(var n=t.ci*r,a=t.ui*r,o=e/n,l=h/a,c=0;c<l;c++)for(var u=0;u<o;u++)this.wu.di(t,i+u*n,s+c*a,n,a)}}class Sprite{constructor(t){this.Ku=t,this.js=t.substring(0,t.lastIndexOf("/")+1),this.qu=null,this.ju=null,this.Yu=!1}Qu(t,i){var s=Service.V("rp");this.ju=t,this.Xu=t.Xu||"xywh";var e=this,h=this.js+t.ut;this.qu=s.li(h,function(t){e.Yu||(e.qu=t.Ce,e.Yu=!0,e.Na&&console.log("sprite loaded late: "+h),i&&i())}),this.qu&&(this.Yu=this.qu.Yu,this.Na&&console.log("sprite loaded immediately: "+h),this.Yu&&i&&i())}b(){return this.ju.ci-2*this.Zu()}x(){return this.ju.ui-2*this.$u()}Zu(){return this.ju.td||0}$u(){return this.ju.id||0}wi(){return this.ju.ue||30}gi(){if("xywh"==this.Xu||"gridSub"==this.Xu)return this.ju.sd.length;if("grid"==this.Xu){var t=this.ju.ci,i=this.ju.ui,s=this.qu.ci,e=Math.floor(s/t);return Math.floor(this.qu.ui/i)*e}return 0}mi(t,i,s,e,h){if("xywh"==this.Xu){var r=this.ju.sd[e];t.Gu(this.qu,i-this.Zu(),s-this.$u(),r[0],r[1],r[2],r[3],h)}else if("grid"==this.Xu||"gridSub"==this.Xu){(e<0||e>this.ju.sd.length)&&console.o("frameIdx OOB"),"gridSub"==this.Xu&&(e=this.ju.sd[e]);var n=this.ju.ci,a=this.ju.ui,o=this.qu.ci,l=Math.floor(o/n),c=e%l,u=(e-c)/l;t.Gu(this.qu,i-this.Zu(),s-this.$u(),c*n,u*a,n,a,h)}}}class SpriteBatch{constructor(t){this.name=t,this.ed=".sprite",this.ju={},this.Yu=!1}pe(t,i){for(var s in this.ju=t,this.ju.me)this.hd(s);this.Yu=!0,i()}hd(t){var i=this.ju.me[t];if(!i)return console.o("sprite batch could not find sprite - "+t),null;for(var s in this.ju.rd)i.hasOwnProperty(s)||(i[s]=this.ju.rd[s]);var e=t+this.ed,h=new Sprite(e),r=Service.V("rp");r.me[e]=h,h.Qu(i,()=>{r.nd(e,r.me[e])})}}class JsonManager{static V(){return JsonManager.Or}constructor(){this.ad={},this.Na=!0}od(t){if(t.constructor==={}.constructor)for(var i in t)this.ad[i]=t[i],this.Na&&console.log("loaded json domain "+i)}ld(t,i){this.ad[t]=i}cd(t,i){if(this.ad.hasOwnProperty(t)){if(i){var s=i.split(".");if(1==s.length)return this.ad[t][i];for(var e=this.ad[t],h=0;h<s.length;h++)e.hasOwnProperty(i)&&(e=e[i]);return e}return this.ad[t]}return null}}JsonManager.Or=new JsonManager;class LoadingState extends AppState{constructor(t){super(),this.t=new LoadingView(t[0],t[1])}}class LoadingView extends BaseStateView{constructor(t,i){super(),this.ud=0,this.dd=t.slice(),this.fd=t.length,this.ud=[],this.vd="",this.md=i,this.Na=!1,this.pd(5)}pd(t){var i=Service.V("rp");if(this.ud.length!=this.fd){if(0!=this.dd.length){var s=this.dd[0];this.vd=s,this.dd.splice(0,1);var e=this;if("fpql"==this.vd.substr(0,4)){var h=(n=this.vd.split(":"))[1],r=n[2];console.log("LoadingState - quick load fourpoleanim "+h+" "+r),i.gd(h,r,function(t){e.ud.push(s),e.pd(1)})}else if("ql"==this.vd.substr(0,2)){var n;h=(n=this.vd.split(":"))[1],r=n[2];console.log("LoadingState - quick load animation "+h+" "+r),i.wd(h,r,function(t){e.ud.push(s),e.pd(1)})}else{var a=this.vd.substr(this.vd.lastIndexOf(".")+1);switch(this.Na&&console.log("load in stride "+t+" : "+s),a){case"png":case"PNG":case"bmp":case"BMP":case"jpg":case"JPG":i.Cd(s,function(t){e.ud.push(s),e.pd(1)});break;case"sprite":i.Sd(s,function(t){e.ud.push(s),e.pd(1)});break;case"spb":i.Vd(s,function(t){e.ud.push(s),e.pd(1)});break;default:i.ht(s,function(t){e.ud.push(s),e.pd(1)})}}t>0&&this.pd(t-1)}}else this.vd="completed",EventBus.d.Oi({Ji:"loadingComplete"}),this.md&&Service.V("state").a(this.md)}P(t,i,s,e){var h=~~(this.ud.length/this.fd*100);t.ai(t.b()/2,t.x()/2,t.b(),t.x(),"#000000"),t.Wu("("+h+"%) loading: "+this.vd,t.b()/2,50)}}class MenuView extends TableView{constructor(t,i,s){super(i||0,s||0,!0),t&&this.Vh(t)}Vh(t){if(t.Re){var i=new NodeView;i.Bt(t.Re),i.st(),this.re(i)}for(var s in t.Td){var e=t.Td[s],h=new NodeView;h.Bt(e.Wt),h.$i(e.p),this.re(h)}var r=t.bd||"rgb(255,255,255)";this.Dt(0,0,r),this._&&(this.xd=t)}X(t){if(!this._)return console.o("MenuView - trying to serialize MenuView when seralizable == false"),{};var i=super.X(t);return i.Z="MenuView",i.Ut=this.xd,i}ht(t){super.ht(t),this.Vh(t.Ut)}}class NodeView extends BaseListener{constructor(){super(),this._=Config&&Config.R||!1,this.D=new Vec2D,this.size=new Vec2D,this.B=0,this.L=1,this.k=!0,this.O=null,this.J=[],this.z=null,this.W=[],this.U=[],this.G=1,this.H=!1,this.K=null,this.q=!1,this.j=!0,this.Y=!0,this._&&(this.Q=[])}X(t){if(!this._)return console.o("NodeView - trying to serialize NodeView when seralizable == false"),{};t=t||!1;var i={Z:"NodeView"};if(i.D=this.D.X(),i.size=this.size.X(),0!=this.B&&(i.B=this.B),1!=this.L&&(i.L=this.L),1!=this.k&&(i.$=this.k),1!=this.G&&(i.G=this.G),0!=this.H&&(i.H=this.H),0!=this.q&&(i.tt=this.q),1!=this.j&&(i.it=this.j),1!=this.Y&&(i.st=this.Y),null!=this.O&&console.et("NodeView.toJson() - cant serialize pUser"),null!=this.K&&console.et("NodeView.toJson() - cant serialize fnOnClick"),this.W.length>0&&console.et("NodeView.toJson() - cant serialize actions.. yet"),i.Q=this.Q,this.J.length>0&&!t){var s=[];for(var e of this.J)s.push(e.X());i.J=s}return i}ht(t){this.rt(),this.D=new Vec2D(t.D.nt,t.D.at),this.size=new Vec2D(t.size.nt,t.size.at),this.B=t.B||0,this.L=t.L||1,this.k=t.$||!0,this.G=t.G||1,this.H=t.H||!1,this.q=t.tt||!1,this.j=t.it||!0,this.Y=t.st||!0,this.ot(t.Q||[]),this.lt(t.J||[])}rt(){this.J.length=0,this.U.length=0,this.W.length=0,this._&&(this.Q=[]),delete this.ct,delete this.ut,delete this.dt,delete this.ft,delete this.vt,delete this.mt,delete this.pt,delete this.gt,delete this.wt,delete this.Ct,delete this.St,delete this.Vt}ot(t){for(var i of t)switch(i.call){case"setCircle":this.Tt(i.bt,i.xt,i.yt);break;case"setRect":this.Dt(i.Mt,i.Nt,i.xt);break;case"setPolygon":this.At(i.Et,i.fill,i.It,i.Ft);break;case"setImage":this.Pt(i.ut);break;case"setImageStretch":this._t(i.ut,i.nt,i.at,i.Mt,i.Nt);break;case"setSprite":this.Rt(i.dt);break;case"setLabel":this.Bt(i.pt,i.wt,i.gt,i.Lt);break;case"setLabelWithOutline":this.kt(i.pt,i.wt,i.gt,i.Ot,i.size,i.Lt);break;case"setTextInput":this.Jt(i.Mt,i.Nt)}}lt(t){for(var i of(this.J.length=0,t)){var s=null;switch(i.Z){case"NodeView":s=new NodeView;break;case"ButtonView":s=new ButtonView(i.zt,i.dt,i.Wt,i.wt,i.gt);break;case"MenuView":s=new MenuView(i.Ut,i.Mt,i.Nt);break;case"TableView":s=new TableView(i.Mt,i.Nt,i.Gt);break;default:console.et("NodeView _loadChildrenJson unknown classType "+i.Z);continue}s.ht(i),this.M(s)}}s(){for(var t of(this.Vt&&this.Vt.Ht(),this.J))t.s();super.s()}get $(){return this.k}set $(t){this.k=t,this.Vt&&(this.Vt.Kt=t)}qt(){return this.z}jt(t){for(var i=0;i<this.J.length;i++)if(this.J[i]==t)return i;return-1}Yt(t){return t<0||t>=this.J.length?null:this.J[t]}Qt(){return this.J.length}get Xt(){return this.z?this.z.Xt+this.B:this.B}get Zt(){return this.$t.D}get $t(){var t={L:this.L,ti:this.B,D:this.D.ii()};if(this.z){var i=this.z.$t;t.L+=i.L,t.ti+=i.ti,t.D.si(i.D)}return t}ei(t){this.O=t}hi(){return this.O}Tt(t,i,s){if(this._&&this.Q.push({call:"setCircle",bt:t,xt:i,yt:s}),this.ct)console.o("NodeView: already has a circle, abort!");else{this.ct=t;var e=this;this.U.push(function(t,h,r,n){1!=e.G&&t.ri(e.G),t.ni(h,r,e.ct,i,s),1!=e.G&&t.ri(1)})}}Dt(t,i,s){this._&&this.Q.push({call:"setRect",Mt:t,Nt:i,xt:s}),this.size.T(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.U.push(function(t,i,h,r){1!=e.G&&t.ri(e.G),t.ai(i,h,e.size.nt,e.size.at,s),1!=e.G&&t.ri(1)})}At(t,i,s,e){this._&&this.Q.push({call:"setPolygon",Et:t,fill:i,It:s,Ft:e});var h=this;this.U.push(function(r,n,a,o){1!=h.G&&r.ri(h.G),r.oi(t,i,s,e),1!=h.G&&r.ri(1)})}Pt(t){(this._&&(isString(t)?this.Q.push({call:"setImage",ut:t}):console.et("NodeView - cannot serialize setImage with non-string image parameter")),isString(t))&&(t=Service.V("rp").li(t));if(this.ut)console.o("NodeView: already has an image, abort!");else{this.ut=t,this.size.T(Math.max(this.size.nt,t.ci),Math.max(this.size.at,t.ui));var i=this;this.U.push(function(t,s,e,h){1!=i.G&&t.ri(i.G),t.di(i.ut,s,e),1!=i.G&&t.ri(1)})}}_t(t,i,s,e,h){(this._&&(isString(t)?this.Q.push({call:"setImageStretch",ut:t,nt:i,at:s,Mt:e,Nt:h}):console.et("NodeView - cannot serialize setImageStretch with non-string image parameter")),isString(t))&&(t=Service.V("rp").li(t));if(this.ut)console.o("NodeView: already has an image, abort!");else{this.ut=t,this.size.T(Math.max(this.size.nt,t.ci),Math.max(this.size.at,t.ui));var r=this;this.U.push(function(t,i,s,n){1!=r.G&&t.ri(r.G),t.fi(r.ut,i,s,e,h),1!=r.G&&t.ri(1)})}}Rt(t,i,s){(this._&&(isString(t)?this.Q.push({call:"setSprite",dt:t,ft:i,vt:s}):console.et("NodeView - cannot serialize setSprite with non-string image parameter")),s=s||!1,isString(t))&&(t=Service.V("rp").vi(t));if(t)if(this.dt)console.o("NodeView: already has a sprite, abort!");else{this.dt=t,this.ft=i,this.vt=s,this.size.T(Math.max(this.size.nt,t.b()),Math.max(this.size.at,t.x()));var e=this;this.U.push(function(t,i,s,h){1!=e.G&&t.ri(e.G),e.dt.mi(t,i,s,Math.floor(e.ft),e.vt),1!=e.G&&t.ri(1)})}}pi(t,i){this.Rt(t,0,i);var s=this.dt.gi(),e=this.dt.wi()/s,h=this,r=function(){h.ft=0,h.Ci("spriteFrame",e,s-1,r)};r()}Si(t){if(this._&&console.et("NodeView - cannot serialize setAnim"),this.Vi)console.o("NodeView: already has an anim, abort!");else{this.Vi=t.Ti();var i=this;this.U.push(function(t,s,e,h){1!=i.G&&t.ri(i.G),i.Vi.C(h),i.Vi.P(t,s,e,i.vt),1!=i.G&&t.ri(1)}),this.bi=function(t,i){this.Vi.xi(t,i)},this.yi=function(t,i){this.Vi.yi(t,i)},this.Di=function(t,i){this.Vi.Di(t,i)}}}bi(t,i){this.Vi&&this.Vi.xi(t,i)}Bt(t,i,s,e){if(this._&&this.Q.push({call:"setLabel",pt:t,wt:i,gt:s,Lt:e}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=e||!1,this.pt=t.toString(),this.wt=i,this.gt=s;var h=Service.V("gfx").Mi(this.pt,this.wt,this.mt);this.size.T(Math.max(this.size.nt,h.nt),Math.max(this.size.at,h.at));var r=this;this.U.push(function(t,i,s,e){t.Ni(r.pt,i,s,r.wt,r.gt,r.mt)})}}kt(t,i,s,e,h,r){if(this._&&this.Q.push({call:"setLabelWithOutline",pt:t,wt:i,gt:s,Ot:e,size:h,Lt:r}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=r||!1,this.pt=t.toString(),this.wt=i,this.gt=s||"#FFFFFF",this.St=e||"#000000",this.Ct=h||2;var n=Service.V("gfx").Mi(this.pt,this.wt,this.mt);this.size.T(Math.max(this.size.nt,n.nt),Math.max(this.size.at,n.at));var a=this;this.U.push(function(t,i,s,e){t.Ai(a.pt,i,s,a.wt,a.St,a.Ct,a.mt)}),this.U.push(function(t,i,s,e){t.Ni(a.pt,i,s,a.wt,a.gt,a.mt)})}}Ei(t){isString(this.pt)?this.pt=t.toString():console.o("NodeView: cant update label, dont have one!")}Ii(t){this.gt=t}Jt(t,i){if(this._&&this.Q.push({call:"setTextInput",Mt:t,Nt:i}),this.Vt)console.o("NodeView: already has a text input, abort!");else{var s=Service.V("gfx");this.Vt=new CanvasInput({Fi:s.Fi,ci:t-2,ui:i-2,Pi:0,_i:2,Ri:"1px 1px 0px #fff",Bi:"0px 0px 2px rgba(0, 0, 0, 0.5)"}),this.Vt.Li=this.D,this.size.T(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.Vt.ki(function(t,i){EventBus.d.Oi({Ji:"textInputSubmitted",zi:i.zi(),Wi:e})}),this.U.push(function(t,i,s,h){e.Vt.Ui(i,s)})}}Gi(){return this.Vt?this.Vt.zi():null}Hi(t){this.Vt&&this.Vt.zi(t)}Ki(){this.Vt&&this.Vt.zi("")}qi(t){this.ji=t}Yi(t,i,s,e){this._&&this.Q.push({call:"setProgressBar",Mt:t,Nt:i,Qi:s,Xi:e}),this.ji=.5,this.size.T(Math.max(this.size.nt,t),Math.max(this.size.at,i));var h=this;this.U.push(function(t,i,r,n){1!=h.G&&t.ri(h.G),t.ai(i,r,h.size.nt,h.size.at,s);var a=h.size.nt,o=h.ji*(a-2);t.ai(Math.floor(i-a/2+o/2+1),r,Math.floor(h.size.nt*h.ji),h.size.at,e),1!=h.G&&t.ri(1)})}Zi(t){this._&&console.et("NodeView - cannot serialize addCustomDraw"),this.U.push(t)}$i(t,i,s){this.Y=i||!0,this.j=s||!0,this.K=t}st(){this.K||this.$i(function(t,i,s){t.ts=!0},!0)}ss(t){this.q=!0,this.es=new Vec2D,this.hs=t?t.ii():null}N(t,i,s){if(this.$&&!t.ts){if(i-=this.D.nt,s-=this.D.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}if(this.j)for(var h=this.J.length-1;h>=0;h--){if(this.J[h].N(t,i,s),t.ts)return}var r=-this.size.nt/2,n=-this.size.at/2;this.K&&Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)&&(this.K&&(this.K(t,i,s),this.Y&&(t.ts=!0)),t.ts)||!this.q||this.as||!Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)||(this.os(),t.ts=!0,t.ts)}}os(){this.as=!0;var t=Service.V("app");this.es.ls(t.cs),this.u("onMouseMove",this.us),this.u("onMouseUp",this.ds)}us(t){var i=this.es.fs(t.vs);i.ms(-1),this.es.ls(t.vs),this.D.si(i),this.hs&&this.hs.ps(this.D)}ds(t){this.as=!1,this.g("onMouseMove",this.us),this.g("onMouseUp",this.ds)}I(t,i,s){if(this.$){if(i-=this.D.nt,s-=this.D.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Vt&&this.Vt.gs(t,this.Vt),this.J))if(h.I(t,i,s),t.ts)return}}F(t,i,s){if(this.$){if(i-=this.D.nt,s-=this.D.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Vt&&this.Vt.ws(t,this.Vt),this.J))if(h.F(t,i,s),t.ts)return}}b(){return this.size.nt}x(){return this.size.at}M(t){t.Cs(),this.J.push(t),t.z=this}Ss(t){var i=t.Zt,s=this.Zt,e=i.fs(s);t.D.ls(e),this.M(t)}Cs(t){t=t||!1,this.z&&(this.z.Vs(this,t),this.z=null)}Vs(t,i){i=i||!1;var s=this.J.indexOf(t);this.Ts(s,i)}Ts(t,i){if(i=i||!1,!(t<0)){var s=this.J.splice(t,1)[0];s.z===this&&(s.z=null),i&&s.s()}}bs(t){t=t||!1;for(var i=this.J.length-1;i>=0;i--){var s=this.J[i];this.Vs(s,t)}}P(t,i,s,e){if(this.$){for(var h of(this.xs(e),t.ys(),t.Ds(i+this.D.nt,s+this.D.at),0!=this.B&&t.rs(this.B),1!=this.L&&t.L(this.L),this.H&&t.Ms(!1),this.U))h(t,0,0,e);for(var r of(this.H&&t.Ms(!0),this.J))r.P(t,0,0,e);t.Ns()}}xs(t){if(0!=this.W.length){for(var i=[],s=0;s<this.W.length;s++){var e=this.W[s];e.ts?i.push(s):e.C(t)}if(i.length>0)for(var h=i.length-1;h>=0;h--)this.W.splice(i[h],1)}}As(){for(var t=0;t<this.W.length;t++)this.W[t].s();this.W.length=0}Es(t,i){var s=new NodeAction_noProperty(t);s.Is=function(){i&&i()},this.W.push(s)}Fs(t,i){var s=this;this.Es(t,function(){s.Cs()})}Ps(t,i,s){this.Ci("scale",t,i,s)}_s(t,i,s){this.Rs("pos",t,i,s)}Bs(t,i,s){var e=this.D.Ls(i);this.Rs("pos",t,e,s)}Ci(t,i,s,e){var h=new NodeAction_float(t,i,s);h.ks(this),h.Is=e||null,this.W.push(h)}Rs(t,i,s,e){var h=new NodeAction_vec2d(t,i,s);h.ks(this),h.Is=e||null,this.W.push(h)}Os(t,i,s,e){var h=new NodeAction_arrayPath(t,i,s);h.ks(this),h.Is=e||null,this.W.push(h)}}class NodeAction{constructor(t,i,s){this.Js=0,this.zs=i,this.Ws=null,this.Us=t,this.ts=!1,this.Is=null,this.Gs=null,this.Hs=s}s(){this.Ws=null}ks(t){this.Ws=t,this.Gs=this.Ws[this.Us]}Ks(t){var i=t-this.Js;return i<0?0:i>=this.zs?1:i/this.zs}C(t){0==this.Js&&(this.Js=t);var i=this.Ks(t);if(i>=1)this.Ws[this.Us]=this.Hs,this.ts=!0,this.Is&&(this.Is(),this.Is=null);else{var s=this.qs(i);this.Ws[this.Us]=s}}qs(t){}}class NodeAction_float extends NodeAction{qs(t){var i=this.Hs-this.Gs;return this.Gs+i*t}}class NodeAction_vec2d extends NodeAction{qs(t){var i=this.Hs.fs(this.Gs);return this.Gs.Ls(i.ms(t))}}class NodeAction_noProperty extends NodeAction{constructor(t){super(void 0,t,void 0)}ks(t){this.Ws=t,this.Gs=0}C(t){0==this.Js&&(this.Js=t),this.Ks(t)>=1&&(this.ts=!0,this.Is&&(this.Is(),this.Is=null))}}class NodeAction_arrayPath extends NodeAction{constructor(t,i,s){super(t,i,new Vec2D(s[s.length-1][0],s[s.length-1][1])),this.js=s}qs(t){var i=this.js.length,s=~~(i*t);s>=i-1&&(s=i-2);var e=1/i,h=(t-s*e)/e;h>1&&(h=1);var r=new Vec2D(this.js[s][0],this.js[s][1]);console.log("vTo idx "+(s+1));var n=new Vec2D(this.js[s+1][0],this.js[s+1][1]).fs(r);return r.Ls(n.ms(h))}}class ParticleModel{constructor(){this.D=new Vec2D,this.yd=new Vec2D,this.Dd()}Dd(){this.D.T(0,0),this.yd.T(0,0),this.Js=0,this.Md=0,this.size=1,this.dt=null,this.xt="#FF0000"}}class ParticleSystem{constructor(t){this.zr=0,this.Nd=[],this.Ad=[];for(var i=0;i<t;i++)this.Nd.push(new ParticleModel)}Ed(t,i,s,e){0==this.zr&&(this.zr=e);for(var h=e-this.zr,r=0;r<this.Ad.length;r++){var n=this.Ad[r];if(n.Md<=e)this.Nd.push(n),this.Ad.splice(r,1),n.Dd(),r--;else if(n.D.si(n.yd.Id(h)),n.dt){var a=e-n.Js,o=Math.floor(a*n.dt.wi())%n.dt.gi();n.dt.mi(t,i+n.D.nt,s+n.D.at,o)}else t.ai(i+n.D.nt,s+n.D.at,n.size,n.size,n.xt)}}Fd(t,i,s,e,h,r){if(!(this.Nd.length<1)){var n=this.Nd.pop();this.Ad.push(n),n.Js=h,n.Md=h+r,n.D.T(t,i),n.yd.T(s,e)}}Pd(t,i,s,e,h,r){if(!(this.Nd.length<1)){var n=this.Nd.pop();this.Ad.push(n),n.Js=h;var a=r.gi()/r.wi();n.Md=h+a,n.D.T(t,i),n.yd.T(s,e),n.dt=r}}}class Physics{constructor(){Service.r("physics",this)}_d(){}nh(){}}class PIDController{constructor(t,i,s,e,h){this.reverse=h||!1,this.Rd=0,this.Bd=0,this.Ld=0,this.kd=e,this.Od(t,i,s),this.Jd=null,this.zd=1e-4,this.Wd=0,this.Ud=0,this.Gd=0,this.Hd=0,this.Kd=0,this.qd=0,this.jd=0,this.Yd=0,this.Qd=0,this.Xd=0}Zd(t){this.qd=0,this.Gd=0,this.Kd=0,this.Hd=0,this.jd=0,t&&(this.Wd=0,this.Ud=0)}Od(t,i,s){(t<0||i<0||s<0)&&console.log("error, PID constants must be positive!"),this.reverse?(this.Rd=0-t,this.$d=0-i,this.tf=0-s):(this.Rd=t,this.$d=i,this.tf=s)}if(t,i){this.Jd=t?{min:t,max:i}:null}sf(t,i,s){if(this.Ud+=s,this.Hd=t,this.Kd=i,0==this.Wd||this.Wd+this.kd<=this.Ud){var e=this.Ud-(this.Wd+this.kd),h=Math.floor(e/this.kd);this.Wd+=h*this.kd;for(var r=0;r<h;r++)this.jd=this.ef()}return this.jd}ef(){var t=this.Kd-this.Hd;Math.abs(t)<this.zd&&(t=0);var i=this.Hd-this.Gd;this.Gd=this.Hd;var s=this.Rd*t;this.qd+=this.Bd*t,this.qd=this.hf(this.qd);var e=this.qd*this.kd,h=this.Ld*i/this.kd;return this.Yd=s,this.Qd=e,this.Xd=h,s+e+h}hf(t){return this.Jd?(t>this.Jd.max?t=this.Jd.max:t<this.Jd.min&&(t=this.Jd.min),t):t}}class PIDFFController extends PIDController{constructor(t,i,s,e,h,r,n){super(t,i,s,r,n),this.rf(t,i,s,e,h)}rf(t,i,s,e,h){(t<0||i<0||s<0||e<0||h<0)&&console.log("error, PIDFF constants must be positive!"),this.reverse?(this.Rd=0-t,this.$d=0-i,this.tf=0-s,this.nf=0-e,this.af=0-h):(this.Rd=t,this.$d=i,this.tf=s,this.nf=e,this.af=h)}ef(){var t=this.Kd-this.Hd;Math.abs(t)<this.zd&&(t=0);var i=this.Hd-this.Gd;this.Gd=this.Hd;var s=this.Rd*t;this.qd+=this.Bd*t,this.qd=this.hf(this.qd);var e=this.qd*this.kd,h=this.Ld*i/this.kd;return this.Yd=s,this.Qd=e,this.Xd=h,this.lf=0,this.cf=0,s+e+h+0+0}}class PIDTuneGraph{constructor(t){this.uf=t,this.df=0,this.ff=0,this.vf=[]}mf(t,i,s){2*i>this.df&&(this.df=2*i),this.vf.push({pf:t,gf:i,wf:s})}Cf(t,i,s,e,h,r,n){2*i>this.df&&(this.df=2*i),e>this.ff&&(this.ff=e),h>this.ff&&(this.ff=h),r>this.ff&&(this.ff=r),this.vf.push({pf:t,gf:i,wf:n,Sf:s,Vf:e,Tf:h,bf:r})}le(t,i,s,e,h){t.Ds(i,s);var r=this.vf[this.vf.length-1].wf;t.ai(e/2,h/2,e,h,"#FFFFFF"),t.Ou(0,0,0,h,"#000000"),t.Ou(0,h,e,h,"#000000"),t.Ni("0.0",-15,h,"10px Arial","#000000"),t.Ni((this.df/2).toFixed(2),-15,h/2,"10px Arial","#000000"),t.Ni(this.df.toFixed(2),-15,0,"10px Arial","#000000"),t.Ni("0.0",0,h+15,"10px Arial","#000000"),t.Ni((r/2).toFixed(2),e/2,h+15,"10px Arial","#000000"),t.Ni(r.toFixed(2),e,h+15,"10px Arial","#000000");var n=0,a=h,o=h,l=h,c=h,u=h,d=h;for(var f of this.vf){var v=e/r*f.wf,m=h/this.df,p=h/this.ff,g=h-m*f.gf,w=h-m*f.pf,C=h-m*f.Sf,S=h-p*f.Vf,V=h-p*f.Tf,T=h-p*f.bf;t.Ou(n,a,v,g,"#FF0000"),t.Ou(n,o,v,w,"#0000FF"),t.Ou(n,l,v,C,"#000000"),t.Ou(n,c,v,S,"#00FF00"),t.Ou(n,u,v,V,"#FFFF00"),t.Ou(n,d,v,T,"#00FFFF"),n=v,a=g,o=w,l=C,c=S,u=V,d=T}t.Ds(-i,-s)}}class ResourceProvider{constructor(){this.xf=new EventBus("RP"),this.yf={},this.Df=0,this.me={},this.Mf=0,this.Nf={},this.Af=0,this.Ef={},this.If=0,this.Ff={},this.Pf={},this._f=0,this.Rf={},this.Bf="",this.Na=!1,this.xf.Na=!1,Service.r("rp",this)}Lf(){return this.Df>0||(this.Mf>0||(this.Af>0||(this.If>0||this._f>0)))}nd(t,i){this.xf.Oi({Ji:t,kf:"loadComplete",Ce:i}),this.xf.Aa(t)}li(t,i){if(this.yf[t]&&this.yf[t].Yu)return i&&i({Ji:t,kf:"loadComplete",Ce:this.yf[t]}),this.yf[t];this.Cd(t,i)}Cd(t,i){var s=this;if(this.yf[t])this.yf[t].Yu?i&&i({Ji:t,kf:"loadComplete",Ce:this.yf[t]}):i&&s.xf.f(t,i);else{this.Na&&console.log("load image "+t);var e=new Image;e.Yu=!1,e.Lc=this.Bf+t,this.yf[t]=e,i&&s.xf.f(t,i),e.kc=function(){s.yf[t].Yu=!0,s.Df--,s.nd(t,s.yf[t])},e.Of?console.et("image already complete, abort loading"):this.Df++}}vi(t,i){if(this.me[t]&&this.me[t].Yu)return i&&i({Ji:t,kf:"loadComplete",Ce:this.me[t]}),this.me[t];this.Sd(t,i)}Sd(t,i){var s=this;if(this.me[t])this.me[t].Yu?i&&i({Ji:t,kf:"loadComplete",Ce:this.me[t]}):i&&s.xf.f(t,i);else{this.Na&&console.log("load sprite "+t);var e=new Sprite(t);i&&s.xf.f(t,i),getJSON(this.Bf+t,function(i){s.Na&&console.log("sprite loaded: "+t),s.me[t].Qu(i,function(){s.Mf--,s.nd(t,s.me[t])})}),this.me[t]=e,this.Mf++}}Ie(t){return void 0!=this.me[t]}Jf(t,i){if(this.Nf[t]&&this.Nf[t].Yu)return i&&i({Ji:t,kf:"loadComplete",Ce:this.Nf[t]}),this.Nf[t];this.Vd(t,i)}Vd(t,i){var s=this;if(this.Nf[t])this.Nf[t].Yu?i&&i({Ji:t,kf:"loadComplete",Ce:this.Nf[t]}):i&&s.xf.f(t,i);else{this.Na&&console.log("load spriteBatch "+t);var e=new SpriteBatch(t);i&&s.xf.f(t,i),getJSON(this.Bf+t,function(i){s.Na&&console.log("spriteBatch loaded: "+t),s.Nf[t].pe(i,function(){s.Af--,s.nd(t,s.Nf[t])})}),this.Nf[t]=e,this.Af++}}zf(t,i,s){var e=t+":"+i;if(this.Ff[e]&&this.Ff[e].Yu)return s&&s({Ji:e,kf:"loadComplete",Ce:this.Ff[e]}),this.Ff[e];this.wd(t,i,s)}wd(t,i,s){var e=t+":"+i,h=this;if(this.Ff[e])this.Ff[e].Yu?s&&s({Ji:e,kf:"loadComplete",Ce:this.Ff[e]}):s&&h.xf.f(e,s);else{this.Na&&console.log("load animation quickAttach "+t);var r=new Animation;r.Yu=!1,s&&h.xf.f(e,s),getJSON(this.Bf+t,function(t){r.pe(t),r.we(i,".sprite",function(){h.Na&&console.log("animation quickAttach loaded: "+e),r.Yu=!0,h._f--,h.nd(e,h.Ff[e])})}),this.Ff[e]=r,this._f++}}Wf(t,i,s){var e=t+":"+i;if(this.Pf[e]&&this.Pf[e].Yu)return s&&s({Ji:e,kf:"loadComplete",Ce:this.Pf[e]}),this.Pf[e];this.wd(t,i,s)}gd(t,i,s){var e=t+":"+i,h=this;if(this.Pf[e])this.Pf[e].Yu?s&&s({Ji:e,kf:"loadComplete",Ce:this.Pf[e]}):s&&h.xf.f(e,s);else{this.Na&&console.log("load FourPole quickAttach "+t);var r=new FourPoleAnimation;r.Yu=!1,s&&h.xf.f(e,s),getJSON(this.Bf+t,function(t){r.pe(t),r.we(i,".sprite",function(){h.Na&&console.log("FourPole quickAttach loaded: "+e),r.Yu=!0,h._f--,h.nd(e,h.Pf[e])})}),this.Pf[e]=r,this._f++}}cd(t,i){if(this.Ef[t]&&this.Ef[t].Yu)return i&&i({Ji:t,kf:"loadComplete",Ce:this.Ef[t].ju}),this.Ef[t].ju;this.ht(t,i)}ht(t,i){var s=this;if(this.Ef[t])this.Ef[t].Yu?i&&i({Ji:t,kf:"loadComplete",Ce:this.Ef[t].ju}):i&&s.xf.f(t,i);else{this.Na&&console.log("load json: "+t),i&&s.xf.f(t,i);var e=this;getJSON(this.Bf+t,function(i){e.Na&&console.log("json loaded: "+t),s.Ef[t].ju=i,s.Ef[t].Yu=!0,s.If--,s.nd(t,s.Ef[t].ju)}),this.Na&&console.log("json being loaded: "+t),this.Ef[t]={vh:t,ju:null,Yu:!1},this.If++}}Uf(t,i){this.Rf.hasOwnProperty(t)?console.et("tried to set already existing resource "+t):this.Rf[t]=i}Gf(t){return this.Rf[t]}}class SaveData{constructor(t){this.Hf=t,Service.r("sd",this),this.Na=!1}qh(t,i){null===localStorage.Kf(this.Hf+t)&&(this.Mu(t,i),this.Na&&console.log("saved initial value for "+t))}Mu(t,i){localStorage.qf(this.Hf+t,JSON.stringify(i))}jf(t,i){var s=localStorage.Kf(this.Hf+t);return null===s?(this.Na&&console.log("used default value for load of ",t),i):JSON.parse(s)}clear(t){localStorage.Yf(this.Hf+t)}}class Service{static V(t){return this.Qf||(this.Qf=[]),this.Qf[t]}static r(t,i){this.Qf||(this.Qf=[]),this.Qf[t]&&console.et("Service "+t+" overrided!"),this.Qf[t]=i}static Xf(t){delete this.Qf[t]}}class TableView extends NodeView{static get Ys(){return 0}static get Qs(){return 1}static get Xs(){return 0}static get Zs(){return 1}static get $s(){return 2}constructor(t,i,s){super(),this.te=[],this.ie=0,this.se=0,this.Pi=5,this.ee=TableView.Xs,this.Gt=s||!1,this.size.T(t,i),this.he=TableView.Ys}X(t){if(!this._)return console.o("TableView - trying to serialize TableView when seralizable == false"),{};var i=super.X(t);return i.Z="TableView",i.Pi=this.Pi,i.ee=this.ee,i.Gt=this.Gt,i.Mt=this.size.nt,i.Nt=this.size.at,i.he=this.he,i}ht(t){super.ht(t),this.Gt=t.Gt,this.size.T(t.Mt,t.Nt),this.Pi=t.Pi,this.ee=t.ee,this.he=t.he}re(t){this.te.push(t),this.Gt&&(this.he==TableView.Ys?(this.size.at+=t.x()+this.Pi,this.size.nt=Math.max(this.size.nt,t.b())):(this.size.nt+=t.b()+this.Pi,this.size.at=Math.max(this.size.at,t.x())))}ne(t){this.te=this.te.splice(t,1),this.Gt&&(direction==TableView.Ys?this.size.at-=cell.x()+this.Pi:this.size.nt-=cell.b()+this.Pi)}ae(){if(this.Gt)for(var t=this.te.length-1;t>=0;t--)this.ne(t);else this.te.length=0}N(t,i,s){i-=this.D.nt,s-=this.D.at,i-=this.ie,s-=this.se;var e=0;this.Gt&&this.te.length>0&&(this.he==TableView.Ys?e-=this.te[0].x():e-=this.te[0].b());var h=0;if(this.he==TableView.Ys)for(var r=0;r<this.te.length;r++){if(this.te[r].N(t,i,s-e),t.ts)return;e+=this.te[r].x()+this.Pi}else{this.ee==TableView.Xs&&(h-=this.size.nt/2*.8);for(r=0;r<this.te.length;r++){if(this.te[r].N(t,i-(h+e),s),t.ts)return;e+=this.te[r].b()+this.Pi}}}P(t,i,s,e){for(var h of(t.ys(),t.Ds(i+this.D.nt,s+this.D.at),0!=this.B&&t.rs(this.B),1!=this.L&&t.L(this.L),this.U))h(t,0,0,e);i-=this.ie,s-=this.se;var r=0;this.Gt&&this.te.length>0&&(this.he==TableView.Ys?r-=this.te[0].x():r-=this.te[0].b());var n=0;if(this.he==TableView.Ys)for(var a=0;a<this.te.length;a++)this.te[a].P(t,0,r,e),r+=this.te[a].x()+this.Pi;else{this.ee==TableView.Xs&&(n-=this.size.nt/2*.8);for(a=0;a<this.te.length;a++)this.te[a].P(t,n+r,0,e),r+=this.te[a].b()+this.Pi}for(var o of this.J)o.P(t,0,0,e);t.Ns()}}class TiledMap{constructor(t,i,s){this.js=t.substring(0,t.lastIndexOf("/")+1),this.ci=i,this.ui=s,this.Yu=!1,this.Zf=[],this.$f=[],this.tv=[],this.iv="player",this.sv=null,this.ev=[],this.hv=[],this.rv=[],this.nv=null,this.av=[],this.Na=!0,this.ov=!1}pe(t){var i=Service.V("rp");this.ju=t;for(var s=0;s<this.ju.lv.length;s++){var e=this.ju.lv[s],h=new Sprite(this.js),r={ut:e.ut,Xu:"grid",ci:e.cv,ui:e.uv};h.Qu(r),e.dt=h,this.Zf.push(e)}for(var n=0;n<this.ju.dv.length;n++){var a=this.ju.dv[n];if("imagelayer"==a.kl)this.tv.push(a),i.Cd(this.js+a.ut);else if("tilelayer"==a.kl)console.log("add tile layer"),this.$f.push(a);else if("objectgroup"==a.kl&&"ground"==a.name)for(var o=0;o<a.fv.length;o++){var l=a.fv[o];this.ev.push(l)}else if("objectgroup"==a.kl&&"wall"==a.name)for(o=0;o<a.fv.length;o++){l=a.fv[o];this.hv.push(l)}else if("objectgroup"==a.kl&&"spawn"==a.name)for(o=0;o<a.fv.length;o++){l=a.fv[o];this.rv.push(l)}}this.Yu=!0}vv(t){if(0==t)return 0;for(var i=0;i<this.Zf.length;i++){if(this.Zf[i].mv>t||i==this.Zf.length-1)return i}return console.et("TiledMap: couldnt find tilesetIdx for gid "+t),-1}P(t,i,s,e){if(this.Yu){t.ys(),t.Ds(i,s);for(var h=Service.V("rp"),r=0;r<this.tv.length;r++){var n=this.ju.dv[r],a=h.li(this.js+n.ut);a&&t.di(a,n.nt,n.at),n.name==this.iv&&this.sv&&this.sv()}for(r=0;r<this.$f.length;r++){for(var o=this.$f[r],l=o.ci,c=o.ui,u=0;u<c;u++)for(var d=u*l,f=0;f<l;f++){var v=o.ju[f+d],m=this.vv(v);if(!(v<=0)){var p=v-this.Zf[m].mv,g=this.Zf[m].cv,w=this.Zf[m].uv;this.Zf[m].dt.mi(t,f*g,u*w,p)}}o.name==this.iv&&this.sv&&this.sv(t,0,0,e)}if(t.Ns(),this.ov){for(var C=0;C<this.ev.length;C++){var S=this.ev[C];t.Eu(i+S.nt,s+S.at,S.ci,S.ui)}for(C=0;C<this.hv.length;C++){S=this.hv[C];t.Eu(i+S.nt,s+S.at,S.ci,S.ui)}for(C=0;C<this.rv.length;C++){S=this.rv[C];t.Eu(i+S.nt,s+S.at,S.ci,S.ui)}}}}pv(t){return this.rv[t]}gv(){var t=this.rv.length-1,i=Math.floor(Math.random()*(t-0))+0;return this.rv[i]}wv(t,i){for(var s=0,e=0;e<this.rv.length;e++){Math.abs(this.rv.nt-t)+Math.abs(this.rv.at-i)>0&&(s=e)}return this.rv[s]}Cv(){var t=this,i=new NodeView;return i.Zi((i,s,e,h)=>{var r=i.Cu;i.Cu=!1,t.P(i,s,e,h),i.Cu=r}),i}}function getRand(t,i){return~~(Math.random()*(i-t+1))+t}function radToDeg(t){return 180*t/Math.PI}function dicLength(t){return Object.keys(t).length}function arrayContains(t,i){return!!t.some(function(t){return t==i})}function removeFromArray(t,i){var s=t.indexOf(i);return s>-1&&(t.splice(s,1),!0)}function isString(t){return"string"==typeof t||t instanceof String}function isArray(t){return t.constructor===Array||Array.isArray(t)}function generateUUID(){var t=Date.now();return window.Sv&&"function"==typeof window.Sv.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==i?s:3&s|8).toString(16)})}function getJSON(t,i){var s=new XMLHttpRequest;s.Vv("GET",t,!0),s.kc=function(){if(this.kf>=200&&this.kf<400||0==this.kf&&this.Tv){var s=JSON.parse(this.Tv);i(s)}else console.o("unable to download "+t+" error: "+this.kf+" "+this.bv),i(null)},s.xv=function(){console.o("unable to download "+t+" unable to connect"),i(null)},s.yv()}function CreateScreenShade(t){t=t||.5;var i=Graphics.mu,s=new NodeView;return s.Dt(i.nt,i.at,"rgba(0,0,0,"+t+")"),s.D.T(i.nt/2,i.at/2),s.st(),s}function CreateSimpleButton(t,i,s){var e=new Vec2D(100,40);s||(s=EventBus.d),isString(s)&&(s=EventBus.V(s));var h=new NodeView;return h.Dt(e.nt,e.at,"rgb(50,150,50)"),h.Bt(t,"16px Arial"),h.$i(function(){s.Oi({Ji:i,from:h})}),h}function CreateSimpleImageButton(t,i,s,e){e||(e=EventBus.d),isString(e)&&(e=EventBus.V(e));var h=new NodeView;return h.Pt(i),t&&h.Bt(t,"14px Arial"),h.$i(function(){e.Oi({Ji:s,from:h})}),h}function CreateSimplePopup(t,i,s,e){var h=new Vec2D(300,250),r=new NodeView;r.Dt(h.nt,h.at,"rgb(200,200,200)");var n=CreateSimpleButton(i,s,e);n.D.at=h.at/2,r.M(n),console.log("button size "+n.size.nt+","+n.size.at),h.at-=n.size.at;var a=new NodeView;return a.Bt(t,"24px Arial","rgb(0,0,0)",!0),a.D.at=h.at,r.M(a),r}function CreateSimpleVerticleSlider(t,i,s,e){e||(e=EventBus.d),isString(e)&&(e=EventBus.V(e));var h=new NodeView;return h.Dt(10,i,"rgb(128,128,128)"),h.Dv=0,h.Mv=new NodeView,h.Mv.Dt(t,20,"rgb(255,255,255)"),h.M(h.Mv),h.$i(function(t,r,n){h.Dv=1-(n/(i-20)+.5),h.Dv=Math.min(h.Dv,1),h.Dv=Math.max(h.Dv,0),e.Oi({Ji:s,Dv:h.Dv})},!1),h.Zi(function(t,s,e,r){h.Mv.D.at=(1-h.Dv)*i-i/2}),h}function CreateSimpleEditBox(t,i,s,e,h){var r=new Vec2D(300,250),n=new NodeView;n.Dt(r.nt,r.at,"rgb(200,200,200)");var a=CreateSimpleButton(s,e,h);a.D.at=r.at/2,n.M(a),console.log("button size "+a.size.nt+","+a.size.at),r.at-=a.size.at;var o=new NodeView;return o.Bt(t,"24px Arial","rgb(0,0,0)",!0),o.D.at=r.at,n.M(o),n}function CreateSimpleProgressBar(t,i,s,e){new Vec2D(s,e);var h=new NodeView;return h.Dv=0,h.Dt(s,e,i),h.U.push(function(i,r,n,a){var o=h.Dv*(s-2),l=t;i.ai(r-s/2+o/2+1,n,o,e-2,l)}),h}exports.Nv=getRand,exports.Av=radToDeg,exports.Ev=arrayContains,exports.Iv=removeFromArray,exports.isArray=isArray,exports.Fv=isString;class Vec2D{constructor(t,i){this.nt=t||0,this.at=i||0}Pv(t){this.nt=t.nt,this.at=t.at}X(){return{nt:this.nt,at:this.at}}ht(t){this.nt=t.nt||0,this.at=t.at||0}ii(){return new Vec2D(this.nt,this.at)}toString(){return this.nt.toFixed(4)+","+this.at.toFixed(4)}X(){return{nt:this.nt,at:this.at}}T(t,i){return this.nt=t,this.at=i,this}ls(t){return this.nt=t.nt,this.at=t.at,this}si(t){return this.nt+=t.nt,this.at+=t.at,this}_v(t){return this.nt-=t.nt,this.at-=t.at,this}ms(t){return this.nt=this.nt*t,this.at=this.at*t,this}Rv(){return 0!=this.nt||0!=this.at}Bv(){var t=this.Lv();return new Vec2D(this.nt/t,this.at/t)}oa(){return this.nt*this.nt+this.at*this.at}Lv(){return Math.sqrt(this.nt*this.nt+this.at*this.at)}Id(t){return new Vec2D(this.nt*t,this.at*t)}Ls(t){return new Vec2D(this.nt+t.nt,this.at+t.at)}fs(t){return new Vec2D(this.nt-t.nt,this.at-t.at)}kv(t){return this.nt*t.nt+this.at*t.at}Ov(t){return t.fs(this).oa()}Jv(t){return this.nt==t.nt&&this.at==t.at}zv(){return 0==this.at&&0==this.nt?0:Math.atan2(this.at,this.nt)+Math.PI/2}Wv(t){return t-=Math.PI/2,this.nt=Math.cos(t),this.at=Math.sin(t),this}static Uv(t){return t-=Math.PI/2,new Vec2D(Math.cos(t),Math.sin(t))}rs(t){if(0==this.nt&&0==this.at)return this;var i=Math.cos(t),s=Math.sin(t),e=this.nt*i-this.at*s,h=this.nt*s+this.at*i;return Math.abs(e)<1e-7&&(e=0),Math.abs(h)<1e-7&&(h=0),this.nt=e,this.at=h,this}Gv(t){if(0==this.nt&&0==this.at)return new Vec2D(0,0);var i=Math.cos(t),s=Math.sin(t),e=this.nt*i-this.at*s,h=this.nt*s+this.at*i;return Math.abs(e)<1e-7&&(e=0),Math.abs(h)<1e-7&&(h=0),new Vec2D(e,h)}}class Segment2D{constructor(t,i){this.Hv=t,this.Kv=i}X(){return{Hv:this.Hv.X(),Kv:this.Kv.X()}}ht(t){this.Hv=(new Vec2D).ht(t.Hv),this.Kv=(new Vec2D).ht(t.Kv)}toString(){return this.Hv.toString()+" -> "+this.Kv.toString()}qv(){var t=this.Kv.fs(this.Hv);return t.rs(Math.PI/180*90),t.Bv()}jv(){return this.Kv.fs(this.Hv).Lv()}Yv(t,i,s,e){return new Segment2D(new Vec2D(t,i),new Vec2D(s,e))}Qv(t){return Segment2D.Xv(this.Hv,this.Kv,t.Hv,t.Kv)}static Zv(t,i,s){var e=t.qv(),h=s.fs(i.Hv),r=h.fs(e.Id(2*h.kv(e))).Bv(),n=i.jv()-h.Lv(),a=r.ms(n);return s.Ls(a)}static Xv(t,i,s,e){var h=i.fs(t),r=e.fs(s),n=h.nt*r.at-h.at*r.nt;if(0==n)return null;var a=s.fs(t),o=(a.nt*r.at-a.at*r.nt)/n;if(o<0||o>1)return null;var l=(a.nt*h.at-a.at*h.nt)/n;return l<0||l>1?null:t.Ls(h.Id(o))}}class Rect2D{constructor(t,i,s,e){this.nt=t||0,this.at=i||0,this.Mt=s||0,this.Nt=e||0}static get $v(){return 0}static get tm(){return 1}static get im(){return 2}static get sm(){return 3}X(){return{nt:this.nt,at:this.at,Mt:this.Mt,Nt:this.Nt}}ht(t){this.nt=t.nt||0,this.at=t.at||0,this.Mt=t.Mt||0,this.Nt=t.Nt||0}toString(){return this.nt.toFixed(4)+","+this.at.toFixed(4)+":"+this.Mt.toFixed(4)+"x"+this.Nt.toFixed(4)}ii(){return new Rect2D(this.nt,this.at,this.Mt,this.Nt)}em(){return new Vec2D(this.nt+this.Mt/2,this.at+this.Nt/2)}hm(){return this.nt+this.Mt}rm(){return this.at+this.Nt}nm(){return new Vec2D(this.nt,this.at)}am(){return new Vec2D(this.nt+this.Mt,this.at)}om(){return new Vec2D(this.nt,this.at+this.Nt)}lm(){return new Vec2D(this.nt+this.Mt,this.at+this.Nt)}cm(){return new Vec2D(-this.Mt/2,-this.Nt/2)}um(){return new Vec2D(this.Mt/2,-this.Nt/2)}dm(){return new Vec2D(-this.Mt/2,this.Nt/2)}fm(){return new Vec2D(this.Mt/2,this.Nt/2)}vm(){return Segment2D.Yv(this.nt,this.at,this.nt+this.Mt,this.at)}mm(){return Segment2D.Yv(this.nt,this.at+this.Nt,this.nt+this.Mt,this.at+this.Nt)}pm(){return Segment2D.Yv(this.nt,this.at,this.nt,this.at+this.Nt)}gm(){return Segment2D.Yv(this.nt,this.at+this.Nt,this.nt+this.Mt,this.at+this.Nt)}wm(t){return this.nt==t.nt&&this.at==t.at&&this.Mt==t.Mt&&this.Nt==t.Nt}Dt(t){return this.nt=t.nt,this.at=t.at,this.Mt=t.Mt,this.Nt=t.Nt,this}T(t,i,s,e){return this.nt=t,this.at=i,this.Mt=s,this.Nt=e,this}Cm(t){return this.Mt=t.nt,this.Nt=t.at,this}Sm(t,i){return this.Mt=t,this.Nt=i,this}Vm(){return new Vec2D(this.Mt,this.Nt)}Tm(t,i){return this.nt=t,this.at=i,this}bm(t,i){return this.nt=t-this.Mt/2,this.at=i-this.Nt/2,this}xm(t){return this.nt=t.nt-this.Mt/2,this.at=t.at-this.Nt/2,this}ym(t){return this.nt+=t.nt,this.at+=t.at,this}Dm(t){return this.nt-=t.nt,this.at-=t.at,this}Mm(t,i){return this.nt+=t,this.at+=i,this}Nm(t){return!(t.nt<this.nt)&&(!(t.at<this.at)&&(!(t.nt>this.nt+this.Mt)&&!(t.at>this.at+this.Nt)))}Am(t){return!(t.nt>this.nt+this.Mt)&&(!(t.at>this.at+this.Nt)&&(!(t.nt+t.Mt<this.nt)&&!(t.at+t.Nt<this.at)))}ps(t){t.nt<this.nt&&(t.nt=this.nt),t.nt>this.nt+this.Mt&&(t.nt=this.nt+this.Mt),t.at<this.at&&(t.at=this.at),t.at>this.at+this.Nt&&(t.at=this.at+this.Nt)}static ns(t,i,s,e,h,r){return!(t<s)&&(!(i<e)&&(!(t>s+h)&&!(i>e+r)))}static Em(t,i,s){return!(t.nt<i.nt)&&(!(t.at<i.at)&&(!(t.nt>i.nt+s.nt)&&!(t.at>i.at+s.at)))}static Im(t,i){var s=new Rect2D;s.nt=t.nt<i.nt?t.nt:i.nt,s.at=t.at<i.at?t.at:i.at;var e=t.nt+t.Mt,h=i.nt+i.Mt;s.Mt=e>h?e-s.nt:h-s.nt;var r=t.at+t.Nt,n=i.at+i.Nt;return s.Nt=r>n?r-s.at:n-s.at,s}static Fm(t,i){var s=new Rect2D;s.nt=t.nt>i.nt?t.nt:i.nt,s.at=t.at>i.at?t.at:i.at;var e=t.nt+t.Mt,h=i.nt+i.Mt;s.Mt=e<h?e-s.nt:h-s.nt;var r=t.at+t.Nt,n=i.at+i.Nt;return s.Nt=r<n?r-s.at:n-s.at,s}static Pm(t,i){var s=t.em(),e=t.cm().rs(i).si(s),h=t.um().rs(i).si(s),r=t.dm().rs(i).si(s),n=t.fm().rs(i).si(s),a=Math.min(e.nt,h.nt,r.nt,n.nt),o=Math.max(e.nt,h.nt,r.nt,n.nt),l=Math.min(e.at,h.at,r.at,n.at),c=Math.max(e.at,h.at,r.at,n.at);return new Rect2D(a,l,o-a,c-l)}static _m(){console.log("Beginning Rect2D unit tests...");var t=new Rect2D(0,0,100,100),i=new Rect2D(50,50,100,100),s=new Rect2D(-10,-20,10,20);console.log("test unions: ");var e=Rect2D.Im(t,i);console.log("expect "+new Rect2D(0,0,150,150).toString()),console.log("result "+e.toString());var h=Rect2D.Im(t,s);console.log("expect "+new Rect2D(-10,-20,110,120).toString()),console.log("result "+h.toString()),console.log("test intersects: ");var r=Rect2D.Fm(t,i);console.log("expect "+new Rect2D(50,50,50,50).toString()),console.log("result "+r.toString());var n=Rect2D.Fm(t,s);console.log("expect "+new Rect2D(0,0,0,0).toString()),console.log("result "+n.toString())}}exports.Rm=Vec2D,exports.Bm=Rect2D;