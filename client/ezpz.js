var exports={};class AppState{constructor(){this.t=null,this.i=null}s(){this.t&&this.t.s&&this.t.s(),this.i&&this.i.s&&this.i.s()}}class AppStateController{constructor(){this.e={},this.h=null,Service.r("state",this)}n(t,i){this.e[t]=i}a(t,i){this.e[t]?(this.h&&(this.h.s(),this.h=null),this.h=new this.e[t](i)):console.o("no state named "+t+" available")}}class BaseListener{constructor(){this.c=[]}s(){this.u()}l(t,i,s){s||(s=EventBus.d),i||console.o("SetListener given invalid callback function for "+t),s.f(t,i.bind(this)),this.c.push({v:s,m:t,p:i})}g(t,i,s){s||(s=EventBus.d),s.w(t,i.bind(this))}u(){for(var t of this.c)t.v.w(t.m,t.p)}}class BaseStateModel extends BaseListener{constructor(){super()}s(){super.s()}C(t,i){}}class BaseStateView extends BaseListener{constructor(){super(),this.S=new NodeView;var t=Service.T("gfx");this.S.size.x(t.y(),t.V())}s(){super.s()}D(t,i,s,e){var h=new ButtonView(t,"gfx/btn_blue.sprite",i,"12px Arial","#FFFFFF");h.b.x(s,e),this.S.M(h)}A(t,i,s){this.S&&this.S.A(t,i,s)}N(t,i){}I(t,i,s){this.S&&this.S.I(t,i,s)}P(t,i,s){this.S&&this.S.P(t,i,s)}F(t,i,s,e){this.S&&this.S.F(t,i,s,e)}}class NodeView extends BaseListener{constructor(){super(),this.R=Config&&Config._||!1,this.b=new Vec2D,this.size=new Vec2D,this.B=0,this.O=1,this.k=!0,this.L=null,this.W=[],this.J=null,this.z=[],this.G=[],this.U=1,this.H=!1,this.q=null,this.j=!1,this.K=!0,this.Y=!0,this.R&&(this.Q=[])}X(t){if(!this.R)return console.o("NodeView - trying to serialize NodeView when seralizable == false"),{};t=t||!1;var i={Z:"NodeView"};if(i.b=this.b.X(),i.size=this.size.X(),0!=this.B&&(i.B=this.B),1!=this.O&&(i.O=this.O),1!=this.k&&(i.$=this.k),1!=this.U&&(i.U=this.U),0!=this.H&&(i.H=this.H),0!=this.j&&(i.tt=this.j),1!=this.K&&(i.it=this.K),1!=this.Y&&(i.st=this.Y),null!=this.L&&console.et("NodeView.toJson() - cant serialize pUser"),null!=this.q&&console.et("NodeView.toJson() - cant serialize fnOnClick"),this.z.length>0&&console.et("NodeView.toJson() - cant serialize actions.. yet"),i.Q=this.Q,this.W.length>0&&!t){var s=[];for(var e of this.W)s.push(e.X());i.W=s}return i}ht(t){this.rt(),this.b=new Vec2D(t.b.nt,t.b.at),this.size=new Vec2D(t.size.nt,t.size.at),this.B=t.B||0,this.O=t.O||1,this.k=t.$||!0,this.U=t.U||1,this.H=t.H||!1,this.j=t.tt||!1,this.K=t.it||!0,this.Y=t.st||!0,this.ot(t.Q||[]),this.ct(t.W||[])}rt(){this.W.length=0,this.G.length=0,this.z.length=0,this.R&&(this.Q=[]),delete this.ut,delete this.lt,delete this.dt,delete this.ft,delete this.vt,delete this.mt,delete this.pt,delete this.gt,delete this.wt,delete this.Ct,delete this.St,delete this.Tt}ot(t){for(var i of t)switch(i.call){case"setCircle":this.xt(i.yt,i.Vt,i.Dt);break;case"setRect":this.bt(i.Mt,i.Et,i.Vt);break;case"setPolygon":this.At(i.Nt,i.fill,i.It,i.Pt);break;case"setImage":this.Ft(i.lt);break;case"setImageStretch":this.Rt(i.lt,i.nt,i.at,i.Mt,i.Et);break;case"setSprite":this._t(i.dt);break;case"setLabel":this.Bt(i.pt,i.wt,i.gt,i.Ot);break;case"setLabelWithOutline":this.kt(i.pt,i.wt,i.gt,i.Lt,i.size,i.Ot);break;case"setTextInput":this.Wt(i.Mt,i.Et)}}ct(t){for(var i of(this.W.length=0,t)){var s=null;switch(i.Z){case"NodeView":s=new NodeView;break;case"ButtonView":s=new ButtonView(i.Jt,i.dt,i.zt,i.wt,i.gt);break;case"MenuView":s=new MenuView(i.Gt,i.Mt,i.Et);break;case"TableView":s=new TableView(i.Mt,i.Et,i.Ut);break;default:console.et("NodeView _loadChildrenJson unknown classType "+i.Z);continue}s.ht(i),this.M(s)}}s(){for(var t of(this.Tt&&this.Tt.Ht(),this.W))t.s();super.s()}get $(){return this.k}set $(t){this.k=t,this.Tt&&(this.Tt.qt=t)}jt(){return this.J}Kt(t){for(var i=0;i<this.W.length;i++)if(this.W[i]==t)return i;return-1}Yt(t){return t<0||t>=this.W.length?null:this.W[t]}Qt(){return this.W.length}get Xt(){return this.J?this.J.Xt+this.B:this.B}get Zt(){return this.$t.b}get $t(){var t={O:this.O,ti:this.B,b:this.b.ii()};if(this.J){var i=this.J.$t;t.O+=i.O,t.ti+=i.ti,t.b.si(i.b)}return t}ei(t){this.L=t}hi(){return this.L}xt(t,i,s){if(this.R&&this.Q.push({call:"setCircle",yt:t,Vt:i,Dt:s}),this.ut)console.o("NodeView: already has a circle, abort!");else{this.ut=t;var e=this;this.G.push(function(t,h,r,n){1!=e.U&&t.ri(e.U),t.ni(h,r,e.ut,i,s),1!=e.U&&t.ri(1)})}}bt(t,i,s){this.R&&this.Q.push({call:"setRect",Mt:t,Et:i,Vt:s}),this.size.x(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.G.push(function(t,i,h,r){1!=e.U&&t.ri(e.U),t.ai(i,h,e.size.nt,e.size.at,s),1!=e.U&&t.ri(1)})}At(t,i,s,e){this.R&&this.Q.push({call:"setPolygon",Nt:t,fill:i,It:s,Pt:e});var h=this;this.G.push(function(r,n,a,o){1!=h.U&&r.ri(h.U),r.oi(t,i,s,e),1!=h.U&&r.ri(1)})}Ft(t){(this.R&&(isString(t)?this.Q.push({call:"setImage",lt:t}):console.et("NodeView - cannot serialize setImage with non-string image parameter")),isString(t))&&(t=Service.T("rp").ci(t));if(this.lt)console.o("NodeView: already has an image, abort!");else{this.lt=t,this.size.x(Math.max(this.size.nt,t.ui),Math.max(this.size.at,t.li));var i=this;this.G.push(function(t,s,e,h){1!=i.U&&t.ri(i.U),t.di(i.lt,s,e),1!=i.U&&t.ri(1)})}}Rt(t,i,s,e,h){(this.R&&(isString(t)?this.Q.push({call:"setImageStretch",lt:t,nt:i,at:s,Mt:e,Et:h}):console.et("NodeView - cannot serialize setImageStretch with non-string image parameter")),isString(t))&&(t=Service.T("rp").ci(t));if(this.lt)console.o("NodeView: already has an image, abort!");else{this.lt=t,this.size.x(Math.max(this.size.nt,t.ui),Math.max(this.size.at,t.li));var r=this;this.G.push(function(t,i,s,n){1!=r.U&&t.ri(r.U),t.fi(r.lt,i,s,e,h),1!=r.U&&t.ri(1)})}}_t(t,i,s){(this.R&&(isString(t)?this.Q.push({call:"setSprite",dt:t,ft:i,vt:s}):console.et("NodeView - cannot serialize setSprite with non-string image parameter")),s=s||!1,isString(t))&&(t=Service.T("rp").vi(t));if(t)if(this.dt)console.o("NodeView: already has a sprite, abort!");else{this.dt=t,this.ft=i,this.vt=s,this.size.x(Math.max(this.size.nt,t.y()),Math.max(this.size.at,t.V()));var e=this;this.G.push(function(t,i,s,h){1!=e.U&&t.ri(e.U),e.dt.mi(t,i,s,Math.floor(e.ft),e.vt),1!=e.U&&t.ri(1)})}}pi(t,i){this._t(t,0,i);var s=this.dt.gi(),e=this.dt.wi()/s,h=this,r=function(){h.ft=0,h.Ci("spriteFrame",e,s-1,r)};r()}Si(t){if(this.R&&console.et("NodeView - cannot serialize setAnim"),this.Ti)console.o("NodeView: already has an anim, abort!");else{this.Ti=t.xi();var i=this;this.G.push(function(t,s,e,h){1!=i.U&&t.ri(i.U),i.Ti.C(h),i.Ti.F(t,s,e,i.vt),1!=i.U&&t.ri(1)}),this.yi=function(t,i){this.Ti.Vi(t,i)},this.Di=function(t,i){this.Ti.Di(t,i)},this.bi=function(t,i){this.Ti.bi(t,i)}}}yi(t,i){this.Ti&&this.Ti.Vi(t,i)}Bt(t,i,s,e){if(this.R&&this.Q.push({call:"setLabel",pt:t,wt:i,gt:s,Ot:e}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=e||!1,this.pt=t.toString(),this.wt=i,this.gt=s;var h=Service.T("gfx").Mi(this.pt,this.wt,this.mt);this.size.x(Math.max(this.size.nt,h.nt),Math.max(this.size.at,h.at));var r=this;this.G.push(function(t,i,s,e){t.Ei(r.pt,i,s,r.wt,r.gt,r.mt)})}}kt(t,i,s,e,h,r){if(this.R&&this.Q.push({call:"setLabelWithOutline",pt:t,wt:i,gt:s,Lt:e,size:h,Ot:r}),void 0!=t&&null!=t)if(this.pt)console.o("NodeView: already has a label, abort!");else{this.mt=r||!1,this.pt=t.toString(),this.wt=i,this.gt=s||"#FFFFFF",this.St=e||"#000000",this.Ct=h||2;var n=Service.T("gfx").Mi(this.pt,this.wt,this.mt);this.size.x(Math.max(this.size.nt,n.nt),Math.max(this.size.at,n.at));var a=this;this.G.push(function(t,i,s,e){t.Ai(a.pt,i,s,a.wt,a.St,a.Ct,a.mt)}),this.G.push(function(t,i,s,e){t.Ei(a.pt,i,s,a.wt,a.gt,a.mt)})}}Ni(t){isString(this.pt)?this.pt=t.toString():console.o("NodeView: cant update label, dont have one!")}Ii(t){this.gt=t}Wt(t,i){if(this.R&&this.Q.push({call:"setTextInput",Mt:t,Et:i}),this.Tt)console.o("NodeView: already has a text input, abort!");else{var s=Service.T("gfx");this.Tt=new CanvasInput({Pi:s.Pi,ui:t-2,li:i-2,Fi:0,Ri:2,_i:"1px 1px 0px #fff",Bi:"0px 0px 2px rgba(0, 0, 0, 0.5)"}),this.Tt.Oi=this.b,this.size.x(Math.max(this.size.nt,t),Math.max(this.size.at,i));var e=this;this.Tt.ki(function(t,i){EventBus.d.Li({Wi:"textInputSubmitted",Ji:i.Ji(),zi:e})}),this.G.push(function(t,i,s,h){e.Tt.Gi(i,s)})}}Ui(){return this.Tt?this.Tt.Ji():null}Hi(t){this.Tt&&this.Tt.Ji(t)}qi(){this.Tt&&this.Tt.Ji("")}ji(t){this.Ki=t}Yi(t,i,s,e){this.R&&this.Q.push({call:"setProgressBar",Mt:t,Et:i,Qi:s,Xi:e}),this.Ki=.5,this.size.x(Math.max(this.size.nt,t),Math.max(this.size.at,i));var h=this;this.G.push(function(t,i,r,n){1!=h.U&&t.ri(h.U),t.ai(i,r,h.size.nt,h.size.at,s);var a=h.size.nt,o=h.Ki*(a-2);t.ai(Math.floor(i-a/2+o/2+1),r,Math.floor(h.size.nt*h.Ki),h.size.at,e),1!=h.U&&t.ri(1)})}Zi(t){this.R&&console.et("NodeView - cannot serialize addCustomDraw"),this.G.push(t)}$i(t,i,s){this.Y=i||!0,this.K=s||!0,this.q=t}st(){this.q||this.$i(function(t,i,s){t.ts=!0},!0)}ss(t){this.j=!0,this.es=new Vec2D,this.hs=t?t.ii():null}A(t,i,s){if(this.$&&!t.ts){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}if(this.K)for(var h=this.W.length-1;h>=0;h--){if(this.W[h].A(t,i,s),t.ts)return}var r=-this.size.nt/2,n=-this.size.at/2;this.q&&Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)&&(this.q&&(this.q(t,i,s),this.Y&&(t.ts=!0)),t.ts)||!this.j||this.as||!Rect2D.ns(i,s,r,n,this.size.nt,this.size.at)||(this.os(),t.ts=!0,t.ts)}}os(){this.as=!0;var t=Service.T("app");this.es.cs(t.us),this.l("onMouseMove",this.ls),this.l("onMouseUp",this.ds)}ls(t){var i=this.es.fs(t.vs);i.ms(-1),this.es.cs(t.vs),this.b.si(i),this.hs&&this.hs.ps(this.b)}ds(t){this.as=!1,this.g("onMouseMove",this.ls),this.g("onMouseUp",this.ds)}I(t,i,s){if(this.$){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Tt&&this.Tt.gs(t,this.Tt),this.W))if(h.I(t,i,s),t.ts)return}}P(t,i,s){if(this.$){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}for(var h of(this.Tt&&this.Tt.ws(t,this.Tt),this.W))if(h.P(t,i,s),t.ts)return}}y(){return this.size.nt}V(){return this.size.at}M(t){t.Cs(),this.W.push(t),t.J=this}Ss(t){var i=t.Zt,s=this.Zt,e=i.fs(s);t.b.cs(e),this.M(t)}Cs(t){t=t||!1,this.J&&(this.J.Ts(this,t),this.J=null)}Ts(t,i){i=i||!1;var s=this.W.indexOf(t);this.xs(s,i)}xs(t,i){if(i=i||!1,!(t<0)){var s=this.W.splice(t,1)[0];s.J===this&&(s.J=null),i&&s.s()}}ys(t){t=t||!1;for(var i=this.W.length-1;i>=0;i--){var s=this.W[i];this.Ts(s,t)}}F(t,i,s,e){if(this.$){for(var h of(this.Vs(e),t.Ds(),t.bs(i+this.b.nt,s+this.b.at),0!=this.B&&t.rs(this.B),1!=this.O&&t.O(this.O),this.H&&t.Ms(!1),this.G))h(t,0,0,e);for(var r of(this.H&&t.Ms(!0),this.W))r.F(t,0,0,e);t.Es()}}Vs(t){if(0!=this.z.length){for(var i=[],s=0;s<this.z.length;s++){var e=this.z[s];e.ts?i.push(s):e.C(t)}if(i.length>0)for(var h=i.length-1;h>=0;h--)this.z.splice(i[h],1)}}As(){for(var t=0;t<this.z.length;t++)this.z[t].s();this.z.length=0}Ns(t,i){var s=new NodeAction_noProperty(t);s.Is=function(){i&&i()},this.z.push(s)}Ps(t,i){var s=this;this.Ns(t,function(){s.Cs()})}Fs(t,i,s){this.Ci("scale",t,i,s)}Rs(t,i,s){this._s("pos",t,i,s)}Bs(t,i,s){var e=this.b.Os(i);this._s("pos",t,e,s)}Ci(t,i,s,e){var h=new NodeAction_float(t,i,s);h.ks(this),h.Is=e||null,this.z.push(h)}_s(t,i,s,e){var h=new NodeAction_vec2d(t,i,s);h.ks(this),h.Is=e||null,this.z.push(h)}Ls(t,i,s,e){var h=new NodeAction_arrayPath(t,i,s);h.ks(this),h.Is=e||null,this.z.push(h)}}class NodeAction{constructor(t,i,s){this.Ws=0,this.Js=i,this.zs=null,this.Gs=t,this.ts=!1,this.Is=null,this.Us=null,this.Hs=s}s(){this.zs=null}ks(t){this.zs=t,this.Us=this.zs[this.Gs]}qs(t){var i=t-this.Ws;return i<0?0:i>=this.Js?1:i/this.Js}C(t){0==this.Ws&&(this.Ws=t);var i=this.qs(t);if(i>=1)this.zs[this.Gs]=this.Hs,this.ts=!0,this.Is&&(this.Is(),this.Is=null);else{var s=this.js(i);this.zs[this.Gs]=s}}js(t){}}class NodeAction_float extends NodeAction{js(t){var i=this.Hs-this.Us;return this.Us+i*t}}class NodeAction_vec2d extends NodeAction{js(t){var i=this.Hs.fs(this.Us);return this.Us.Os(i.ms(t))}}class NodeAction_noProperty extends NodeAction{constructor(t){super(void 0,t,void 0)}ks(t){this.zs=t,this.Us=0}C(t){0==this.Ws&&(this.Ws=t),this.qs(t)>=1&&(this.ts=!0,this.Is&&(this.Is(),this.Is=null))}}class NodeAction_arrayPath extends NodeAction{constructor(t,i,s){super(t,i,new Vec2D(s[s.length-1][0],s[s.length-1][1])),this.Ks=s}js(t){var i=this.Ks.length,s=~~(i*t);s>=i-1&&(s=i-2);var e=1/i,h=(t-s*e)/e;h>1&&(h=1);var r=new Vec2D(this.Ks[s][0],this.Ks[s][1]);console.log("vTo idx "+(s+1));var n=new Vec2D(this.Ks[s+1][0],this.Ks[s+1][1]).fs(r);return r.Os(n.ms(h))}}class TableView extends NodeView{static get Ys(){return 0}static get Qs(){return 1}static get Xs(){return 0}static get Zs(){return 1}static get $s(){return 2}constructor(t,i,s){super(),this.te=[],this.ie=0,this.se=0,this.Fi=5,this.ee=TableView.Xs,this.Ut=s||!1,this.size.x(t,i),this.he=TableView.Ys}X(t){if(!this.R)return console.o("TableView - trying to serialize TableView when seralizable == false"),{};var i=super.X(t);return i.Z="TableView",i.Fi=this.Fi,i.ee=this.ee,i.Ut=this.Ut,i.Mt=this.size.nt,i.Et=this.size.at,i.he=this.he,i}ht(t){super.ht(t),this.Ut=t.Ut,this.size.x(t.Mt,t.Et),this.Fi=t.Fi,this.ee=t.ee,this.he=t.he}re(t){this.te.push(t),this.Ut&&(this.he==TableView.Ys?(this.size.at+=t.V()+this.Fi,this.size.nt=Math.max(this.size.nt,t.y())):(this.size.nt+=t.y()+this.Fi,this.size.at=Math.max(this.size.at,t.V())))}ne(t){this.te=this.te.splice(t,1),this.Ut&&(direction==TableView.Ys?this.size.at-=cell.V()+this.Fi:this.size.nt-=cell.y()+this.Fi)}ae(){if(this.Ut)for(var t=this.te.length-1;t>=0;t--)this.ne(t);else this.te.length=0}A(t,i,s){i-=this.b.nt,s-=this.b.at,i-=this.ie,s-=this.se;var e=0;this.Ut&&this.te.length>0&&(this.he==TableView.Ys?e-=this.te[0].V():e-=this.te[0].y());var h=0;if(this.he==TableView.Ys)for(var r=0;r<this.te.length;r++){if(this.te[r].A(t,i,s-e),t.ts)return;e+=this.te[r].V()+this.Fi}else{this.ee==TableView.Xs&&(h-=this.size.nt/2*.8);for(r=0;r<this.te.length;r++){if(this.te[r].A(t,i-(h+e),s),t.ts)return;e+=this.te[r].y()+this.Fi}}}F(t,i,s,e){for(var h of(t.Ds(),t.bs(i+this.b.nt,s+this.b.at),0!=this.B&&t.rs(this.B),1!=this.O&&t.O(this.O),this.G))h(t,0,0,e);i-=this.ie,s-=this.se;var r=0;this.Ut&&this.te.length>0&&(this.he==TableView.Ys?r-=this.te[0].V():r-=this.te[0].y());var n=0;if(this.he==TableView.Ys)for(var a=0;a<this.te.length;a++)this.te[a].F(t,0,r,e),r+=this.te[a].V()+this.Fi;else{this.ee==TableView.Xs&&(n-=this.size.nt/2*.8);for(a=0;a<this.te.length;a++)this.te[a].F(t,n+r,0,e),r+=this.te[a].y()+this.Fi}for(var o of this.W)o.F(t,0,0,e);t.Es()}}class Animation{constructor(){this.oe=["end"],this.ce={ue:{le:5,de:{fe:"idle"}}},this.ve="idle",this.me={}}pe(t){this.oe=t.oe,this.ce=t.ce,this.ve=t.ge}we(t,i,s){var e=Service.T("rp"),h=this,r=Object.keys(this.ce).length;for(var n in this.ce)!function(a){e.vi(t+n+i,function(t){var i=t.Ce;i&&(h.Se(a,i),s&&0==--r&&s())})}(n)}Se(t,i){this.me[t]=i}xi(){return new AnimationInstance(this)}}class AnimationInstance{constructor(t){this.Te=t,this.Ws=0,this.xe="null",this.mi=0,this.ye=null,this.le=5,this.Di(0,this.Te.ve),this.Ve=!1}Vi(t,i){var s=this.Te.ce[this.xe].de[i];return s?(this.Di(t,s),!0):(i!=this.xe&&console.et("failed to handle event "+i),!1)}Di(t,i){i=i||this.Te.ve,this.xe=i,this.Ws=t,this.mi=0,this.ye=this.Te.me[this.xe];var s=this.Te.ce[this.xe];this.le=s.le||this.ye.wi(),this.ye||console.et("no sprite for startAnim("+i+")")}C(t){if(!this.Ve){var i=this.ye.gi(),s=i/this.le,e=t-this.Ws;e>s?this.Vi(t,"end"):this.mi=Math.floor(e/s*i)}}F(t,i,s,e){this.ye.mi(t,i,s,this.mi,e)}De(){return this.ye}}class FourPoleAnimation extends Animation{static get be(){return 0}static get Me(){return 1}static get Ee(){return 2}static get Ae(){return 3}constructor(){super(),this.Ne=["N","E","S","W"]}we(t,i,s){var e=Service.T("rp"),h=this,r=0,n=!1;for(var a in this.ce)!function(a){for(var o in e.Ie(t+a+i)&&(r++,e.vi(t+a+i,function(t){var i=t.Ce;i&&(h.Se(a,i),r--,s&&0==r&&n&&s())})),h.Ne)!function(o){var c=h.Ne[o];e.Ie(t+a+c+i)&&(r++,e.vi(t+a+c+i,function(t){var i=t.Ce;i&&(h.Se(a+c,i),r--,s&&0==r&&n&&s())}))}(o)}(a);n=!0}xi(){return new FourPoleAnimationInstance(this)}}class FourPoleAnimationInstance extends AnimationInstance{bi(t,i){(i<0||i>this.Te.Ne.length)&&console.o("invalid direction index "+i+" for FourPoleAnimation with "+this.Te.Ne.length+" directions");var s=this.Te.Ne[i];s!=this.Pe&&(this.Pe=s,this.Di(t,this.xe))}Di(t,i){void 0==this.Pe&&(this.Pe=this.Te.Ne[0]),i=i||this.Te.ve,this.xe=i,this.Ws=t,this.mi=0,this.Te.me[this.xe+this.Pe]?this.ye=this.Te.me[this.xe+this.Pe]:this.ye=this.Te.me[this.xe];var s=this.Te.ce[this.xe];this.le=s.le||this.ye.wi(),this.ye||console.et("no sprite for startAnim("+i+")")}}var KEY_LEFT=37,KEY_UP=38,KEY_RIGHT=39,KEY_DOWN=40;class Application{static getTime(){return Service.T("app").Fe}constructor(t,i,s){this.Re=t,this.us=new Vec2D;var e=this;document._e=t,document.Be=function(t){e.I(t)},document.ws=function(t){e.P(t)},test=function(t,i){return t<5?i+.01*t:i+.01*(10-t)};var h=function(t){var i=Service.T("gfx").Pi,s=t.Oe-(i.ke||i.Le),h=t.We-(i.Je||i.ze);e.us.x(s,h)};document.Ge=function(t){h(t),e.A(t,e.us.nt,e.us.at,t.Ue)},document.He=function(t){h(t),EventBus.d.Li({Wi:"onMouseMove",vs:e.us},!0)},document.qe=function(t){h(t),EventBus.d.Li({Wi:"onMouseUp",vs:e.us},!0)},document.je=function(t){h(t)},document.Ke=function(t){var i=t.Ye;e.N(t,i)},this.Qe=0,this.Fe=0,Service.r("app",this),this.Xe(t,i)}Xe(t,i){new ResourceProvider,new Graphics(i),new AudioManager,new Physics,new SaveData(t),new AppStateController}Ze(){this.$e()}th(){this.ih()}sh(){return null==this.eh}$e(){null==this.eh&&(this.Qe=(new Date).getTime(),this.eh=setInterval(this.hh.bind(this),33))}ih(){null!=this.eh&&(clearInterval(this.eh.bind(this)),this.eh=null)}hh(){var t=Service.T("state").h,i=Date.now();i/=1e3;var s=Math.abs(i-this.Qe);this.Qe=i,this.Fe+=s,this.rh(s,this.Fe),t.i&&t.i.C(i,s),Service.T("physics").nh(),this.ah(s,this.Fe);var e=Service.T("gfx");e.oh(!0),t.t&&t.t.F(e,0,0,this.Fe),this.ch(e,s,this.Fe)}uh(){console.log("override me: Application.onApplicationLoaded()")}rh(t,i){}ah(t,i){}ch(t,i,s){}I(t){Service.T("state").h.t.I(t,this.us.nt,this.us.at)}P(t){Service.T("state").h.t.P(t,this.us.nt,this.us.at)}A(t,i,s){Service.T("state").h.t.A(t,i,s)}N(t,i){}}class AudioManager{constructor(){console.log("AudioManager created"),Service.r("audio",this),EventBus.lh.f("play",AudioManager.dh.bind(this))}static dh(t){this.fh||(this.fh={});var i=t.vh;this.fh[i]||(this.fh[i]=new Audio(i));var s=this.fh[t.vh];s.mh||console.log("cutting sfx short "+i),s.ph()}}class ButtonView extends NodeView{static get gh(){return 0}static get wh(){return 1}constructor(t,i,s,e,h,r){super(),this.Ch=ButtonView.gh,this.Sh=!1,this.m=r||{},this.m.Wi=t||"btnID",(i||s)&&this.Th(i,s,e,h),this.xh=null}Th(t,i,s,e){t&&this._t(t),i&&(s=s||"10px Arial",e=e||"#CCCCCC",this.Bt(i,s,e))}X(t){if(!this.R)return console.o("ButtonView - trying to serialize ButtonView when seralizable == false"),{};var i=super.X(t);return i.Z="ButtonView",i.Jt=this.m.Wi,this.Sh&&(i.Sh=this.Sh),i}ht(t){super.ht(t),this.m.Wi=t.Jt,this.Sh=t.Sh||!1,this.Th(t.dt,t.zt,t.wt,t.gt)}s(){this.xh&&clearTimeout(this.xh),this.xh=null,super.s()}_t(t){super._t(t),this.size.x(this.dt.y(),this.dt.V())}F(t,i,s,e){this.ft=this.Ch,super.F(t,i,s,e)}A(t,i,s){if(!this.Sh){if(i-=this.b.nt,s-=this.b.at,0!=this.B){var e=new Vec2D(i,s);e.rs(-this.B),i=e.nt,s=e.at}var h=0,r=0;if(Config.yh&&(h-=this.size.nt/2,r-=this.size.at/2),Rect2D.ns(i,s,h,r,this.size.nt,this.size.at)&&this.Ch==ButtonView.gh){this.Ch=ButtonView.wh,EventBus.d.Li(this.m);var n=this;return this.xh=setTimeout(function(){n.Ch=ButtonView.gh},150),void(t.ts=!0)}super.A(t,i,s)}}}class EventBus{constructor(t){this.Vh={},this.Dh=t,this.bh=!0}s(){for(var t of this.Vh)this.Mh(t)}f(t,i){t in this.Vh||(this.Vh[t]=[]),this.Vh[t].push(i)}w(t,i){if(t in this.Vh){var s=this.Vh[t].indexOf(i);this.Vh[t].splice(s,1)}}Mh(t){this.Vh[t]=[]}Li(t,i){("string"==typeof t||t instanceof String)&&(t={Wi:t}),t.Wi?(this.bh&&!i&&console.log("EB["+this.Dh+"] "+t.Wi+":%O",t),this.Vh[t.Wi]&&this.Vh[t.Wi].forEach(function(i,s,e){i(t)})):console.log("abort dispatch event -- no evtName %O",t)}static T(t){return this.Eh||(this.Eh={}),this.Eh[t]||(this.Eh[t]=new EventBus(t)),this.Eh[t]}static get Ah(){return this.T("game")}static get d(){return this.T("ui")}static get lh(){return this.T("sfx")}}exports.Nh=EventBus;class Graphics{static get Ih(){return Service.T("gfx").Ph()}constructor(t){this.Pi=document.Fh(t),this.Vt="#FF0000",this.Dt="#FFFFFF",this.Pt=1,this.Rh="30px Arial",this._h=this.Pi.Bh("2d"),this.Oh=!!Config&&Config.yh,this.kh=!!Config&&Config.kh,this.bh=!1,Service.r("gfx",this)}y(){return this.Pi.Lh}V(){return this.Pi.Wh}Ph(){return new Vec2D(this.y(),this.V())}ri(t){this._h.Jh=t}zh(){return this._h.Gh}Ms(t){this._h.Gh=t}oh(t){this._h=this.Pi.Bh("2d"),t&&this.Uh()}Uh(){this._h.Hh(0,0,this.y(),this.V())}Ds(){this._h.qh()}Es(){this._h.jh()}bs(t,i){this._h.bs(t,i)}rs(t,i){i&&(t*=-1),this._h.rs(t)}O(t){this._h.O(t,t)}Kh(t,i){return""!=t&&(void 0==t?i:t)}Yh(t,i,s,e){this._h.Vt=this.Vt,this.bh&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Oh&&(t-=s/2,i-=e/2),this._h.Qh(t,i,s,e)}ai(t,i,s,e,h){this._h.Vt=h||this.Vt,this.bh&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Oh&&(t-=s/2,i-=e/2),this._h.Qh(t,i,s,e)}Xh(t,i,s,e){this._h.Dt=this.Dt,this._h.Zh=this.Pt,this.bh&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Oh&&(t-=s/2,i-=e/2),this._h.$h(t,i,s,e)}tr(t,i,s,e,h,r){this._h.Dt=h||this.Dt,this._h.Zh=r||this.Pt,this.bh&&console.log("rect at "+t+","+i+" x "+s+","+e),this.Oh&&(t-=s/2,i-=e/2),this._h.$h(t,i,s,e)}oi(t,i,s,e){var h=this.Kh(i,this.Vt),r=this.Kh(s,this.Dt);this._h.Vt=h,this._h.Dt=r,this._h.Zh=e||this.Pt,this._h.ir();var n=t[0];this._h.sr(n.nt,n.at);for(var a=1;a<t.length;a++)this._h.er(t[a].nt,t[a].at);this._h.hr(),h&&this._h.fill(),r&&this._h.It()}rr(t,i,s,e){var h=this.Kh(i,this.Vt),r=this.Kh(s,this.Dt);this._h.Vt=h,this._h.Dt=r,this._h.Zh=e||this.Pt,this._h.ir();var n=t[0];this._h.sr(n[0],n[1]);for(var a=1;a<t.length;a++)this._h.er(t[a][0],t[a][1]);this._h.hr(),h&&this._h.fill(),r&&this._h.It()}nr(t,i,s,e){var h=this.Kh(i,this.Vt),r=this.Kh(s,this.Dt);this._h.Vt=h,this._h.Dt=r,this._h.Zh=e||this.Pt,4==t.length?(this._h.ir(),this._h.sr(t[0].nt,t[0].at),this._h.ar(t[1].nt,t[1].at,t[2].nt,t[2].at,t[3].nt,t[3].at),this._h.hr(),h&&this._h.fill(),r&&this._h.It()):console.et("Graphics.drawCubicBezierEx() - invalid number of verts, must be 4")}or(t,i,s,e){this._h.Dt=this.Dt,this._h.Zh=this.Pt,this._h.ir(),this._h.sr(t,i),this._h.er(s,e),this._h.It(),this._h.hr(),this.bh&&console.log("line at "+t+","+i+" x "+s+","+e)}cr(t,i,s,e,h,r){this._h.Dt=h||this.Dt,this._h.Zh=r||this.Pt,this._h.ir(),this._h.sr(t,i),this._h.er(s,e),this._h.It(),this._h.hr(),this.bh&&console.log("line at "+t+","+i+" x "+s+","+e)}ur(t,i,s){var e=this.Vt,h=this.Dt;this._h.Vt=e,this._h.Dt=h,this._h.Zh=this.Pt,this._h.ir(),this._h.lr(t,i,s,0,2*Math.PI,!1),this._h.hr(),e&&this._h.fill(),h&&this._h.It(),this.bh&&console.log("circle at "+t+","+i+" x "+s)}ni(t,i,s,e,h,r){var n=this.Kh(e,this.Vt),a=this.Kh(h,this.Dt);this._h.Vt=n,this._h.Dt=a,this._h.Zh=r||this.Pt,this._h.ir(),this._h.lr(t,i,s,0,2*Math.PI,!1),this._h.hr(),n&&this._h.fill(),a&&this._h.It()}dr(t,i,s){if(this._h.Rh=this.Rh,this._h.Vt=this.Vt,this.Oh){var e=this._h.fr(t);i-=e.ui/2,this.kh&&(s+=(e=this._h.fr("M")).ui/2)}this._h.vr(t,i,s)}Ei(t,i,s,e,h,r){var n=this.Kh(h,this.Vt);if(this._h.Rh=e||this.Rh,this._h.Vt=n,r){var a=t.split("\n"),o=1.5*this._h.fr("m").ui;for(var c of a){var u=i;if(this.Oh)u-=this._h.fr(c).ui/2;this._h.vr(c,u,s),s+=o}}else{if(this.Oh){var l=this._h.fr(t);i-=l.ui/2,this.kh&&(s+=(l=this._h.fr("M")).ui/2)}this._h.vr(t,i,s)}}Ai(t,i,s,e,h,r,n){this._h.Rh=e||this.Rh;var a=this.Kh(h,this.Dt);if(this._h.Dt=a,this._h.Zh=r||this.Pt,n){var o=t.split("\n"),c=1.5*this._h.fr("m").ui;for(var u of o){var l=i;if(this.Oh)l-=this._h.fr(u).ui/2;this._h.mr(u,l,s),s+=c}}else{if(this.Oh){var d=this._h.fr(t);i-=d.ui/2,this.kh&&(s+=(d=this._h.fr("M")).ui/2)}this._h.mr(t,i,s)}}Mi(t,i,s){this._h.Rh=i||this.Rh;var e=0,h=0;if(s){var r=t.split("\n");for(var n of r){var a=this._h.fr(n).ui;a>h&&(h=a),e++}}else e=1,h=this._h.fr(t).ui;var o=this._h.fr("m").ui*e*1.5;return new Vec2D(h,o)}di(t,i,s){this.Oh&&(i-=t.ui/2,s-=t.li/2),this._h.di(t,i,s)}fi(t,i,s,e,h,r){r?(this._h.qh(),this._h.O(-1,1),this._h.di(t,0,0,t.ui,t.li,-1*i-t.ui,s,e,h),this._h.jh()):this._h.di(t,0,0,t.ui,t.li,i,s,e,h)}pr(t,i,s,e,h,r,n,a){this.Oh&&(i-=r/2,s-=n/2),a?(this._h.qh(),this._h.O(-1,1),this._h.di(t,e,h,r,n,-1*i-r,s,r,n),this._h.jh()):this._h.di(t,e,h,r,n,i,s,r,n)}gr(t,i,s,e,h,r){this.Oh&&(i-=e/2,s-=h/2),r=r||1;for(var n=t.ui*r,a=t.li*r,o=e/n,c=h/a,u=0;u<c;u++)for(var l=0;l<o;l++)this._h.di(t,i+l*n,s+u*a,n,a)}}class Sprite{constructor(t){this.wr=t,this.Ks=t.substring(0,t.lastIndexOf("/")+1),this.Cr=null,this.Sr=null,this.Tr=!1}xr(t,i){var s=Service.T("rp");this.Sr=t,this.yr=t.yr||"xywh";var e=this,h=this.Ks+t.lt;this.Cr=s.ci(h,function(t){e.Tr||(e.Cr=t.Ce,e.Tr=!0,e.bh&&console.log("sprite loaded late: "+h),i&&i())}),this.Cr&&(this.Tr=this.Cr.Tr,this.bh&&console.log("sprite loaded immediately: "+h),this.Tr&&i&&i())}y(){return this.Sr.ui-2*this.Vr()}V(){return this.Sr.li-2*this.Dr()}Vr(){return this.Sr.br||0}Dr(){return this.Sr.Mr||0}wi(){return this.Sr.le||30}gi(){if("xywh"==this.yr||"gridSub"==this.yr)return this.Sr.Er.length;if("grid"==this.yr){var t=this.Sr.ui,i=this.Sr.li,s=this.Cr.ui,e=Math.floor(s/t);return Math.floor(this.Cr.li/i)*e}return 0}mi(t,i,s,e,h){if("xywh"==this.yr){var r=this.Sr.Er[e];t.pr(this.Cr,i-this.Vr(),s-this.Dr(),r[0],r[1],r[2],r[3],h)}else if("grid"==this.yr||"gridSub"==this.yr){(e<0||e>this.Sr.Er.length)&&console.o("frameIdx OOB"),"gridSub"==this.yr&&(e=this.Sr.Er[e]);var n=this.Sr.ui,a=this.Sr.li,o=this.Cr.ui,c=Math.floor(o/n),u=e%c,l=(e-u)/c;t.pr(this.Cr,i-this.Vr(),s-this.Dr(),u*n,l*a,n,a,h)}}}class SpriteBatch{constructor(t){this.name=t,this.Ar=".sprite",this.Sr={},this.Tr=!1}pe(t,i){for(var s in this.Sr=t,this.Sr.me)this.Nr(s);this.Tr=!0,i()}Nr(t){var i=this.Sr.me[t];if(!i)return console.o("sprite batch could not find sprite - "+t),null;for(var s in this.Sr.Ir)i.hasOwnProperty(s)||(i[s]=this.Sr.Ir[s]);var e=t+this.Ar,h=new Sprite(e),r=Service.T("rp");r.me[e]=h,h.xr(i,()=>{r.Pr(e,r.me[e])})}}class JsonManager{static T(){return JsonManager.Fr}constructor(){this.Rr={},this.bh=!0}_r(t){if(t.constructor==={}.constructor)for(var i in t)this.Rr[i]=t[i],this.bh&&console.log("loaded json domain "+i)}Br(t,i){this.Rr[t]=i}Or(t,i){if(this.Rr.hasOwnProperty(t)){if(i){var s=i.split(".");if(1==s.length)return this.Rr[t][i];for(var e=this.Rr[t],h=0;h<s.length;h++)e.hasOwnProperty(i)&&(e=e[i]);return e}return this.Rr[t]}return null}}JsonManager.Fr=new JsonManager;class LoadingState extends AppState{constructor(t){super(),this.t=new LoadingView(t[0],t[1])}}class LoadingView extends BaseStateView{constructor(t,i){super(),this.kr=0,this.Lr=t.slice(),this.Wr=t.length,this.kr=[],this.Jr="",this.zr=i,this.bh=!1,this.Gr(5)}Gr(t){var i=Service.T("rp");if(this.kr.length!=this.Wr){if(0!=this.Lr.length){var s=this.Lr[0];this.Jr=s,this.Lr.splice(0,1);var e=this;if("fpql"==this.Jr.substr(0,4)){var h=(n=this.Jr.split(":"))[1],r=n[2];console.log("LoadingState - quick load fourpoleanim "+h+" "+r),i.Ur(h,r,function(t){e.kr.push(s),e.Gr(1)})}else if("ql"==this.Jr.substr(0,2)){var n;h=(n=this.Jr.split(":"))[1],r=n[2];console.log("LoadingState - quick load animation "+h+" "+r),i.Hr(h,r,function(t){e.kr.push(s),e.Gr(1)})}else{var a=this.Jr.substr(this.Jr.lastIndexOf(".")+1);switch(this.bh&&console.log("load in stride "+t+" : "+s),a){case"png":case"PNG":case"bmp":case"BMP":case"jpg":case"JPG":i.qr(s,function(t){e.kr.push(s),e.Gr(1)});break;case"sprite":i.jr(s,function(t){e.kr.push(s),e.Gr(1)});break;case"spb":i.Kr(s,function(t){e.kr.push(s),e.Gr(1)});break;default:i.ht(s,function(t){e.kr.push(s),e.Gr(1)})}}t>0&&this.Gr(t-1)}}else this.Jr="completed",EventBus.d.Li({Wi:"loadingComplete"}),this.zr&&Service.T("state").a(this.zr)}F(t,i,s,e){var h=~~(this.kr.length/this.Wr*100);t.ai(t.y()/2,t.V()/2,t.y(),t.V(),"#000000"),t.dr("("+h+"%) loading: "+this.Jr,t.y()/2,50)}}class MenuView extends TableView{constructor(t,i,s){super(i||0,s||0,!0),t&&this.Th(t)}Th(t){if(t._e){var i=new NodeView;i.Bt(t._e),i.st(),this.re(i)}for(var s in t.Yr){var e=t.Yr[s],h=new NodeView;h.Bt(e.zt),h.$i(e.p),this.re(h)}var r=t.Qr||"rgb(255,255,255)";this.bt(0,0,r),this.R&&(this.Xr=t)}X(t){if(!this.R)return console.o("MenuView - trying to serialize MenuView when seralizable == false"),{};var i=super.X(t);return i.Z="MenuView",i.Gt=this.Xr,i}ht(t){super.ht(t),this.Th(t.Gt)}}class PIDController{constructor(t,i,s,e,h){this.reverse=h||!1,this.Zr=0,this.$r=0,this.tn=0,this.in=e,this.sn(t,i,s),this.en=null,this.hn=1e-4,this.rn=0,this.nn=0,this.an=0,this.on=0,this.cn=0,this.un=0,this.ln=0,this.dn=0,this.fn=0,this.vn=0}mn(t){this.un=0,this.an=0,this.cn=0,this.on=0,this.ln=0,t&&(this.rn=0,this.nn=0)}sn(t,i,s){(t<0||i<0||s<0)&&console.log("error, PID constants must be positive!"),this.reverse?(this.Zr=0-t,this.pn=0-i,this.gn=0-s):(this.Zr=t,this.pn=i,this.gn=s)}wn(t,i){this.en=t?{min:t,max:i}:null}Cn(t,i,s){if(this.nn+=s,this.on=t,this.cn=i,0==this.rn||this.rn+this.in<=this.nn){var e=this.nn-(this.rn+this.in),h=Math.floor(e/this.in);this.rn+=h*this.in;for(var r=0;r<h;r++)this.ln=this.Sn()}return this.ln}Sn(){var t=this.cn-this.on;Math.abs(t)<this.hn&&(t=0);var i=this.on-this.an;this.an=this.on;var s=this.Zr*t;this.un+=this.$r*t,this.un=this.Tn(this.un);var e=this.un*this.in,h=this.tn*i/this.in;return this.dn=s,this.fn=e,this.vn=h,s+e+h}Tn(t){return this.en?(t>this.en.max?t=this.en.max:t<this.en.min&&(t=this.en.min),t):t}}class PIDFFController extends PIDController{constructor(t,i,s,e,h,r,n){super(t,i,s,r,n),this.xn(t,i,s,e,h)}xn(t,i,s,e,h){(t<0||i<0||s<0||e<0||h<0)&&console.log("error, PIDFF constants must be positive!"),this.reverse?(this.Zr=0-t,this.pn=0-i,this.gn=0-s,this.yn=0-e,this.Vn=0-h):(this.Zr=t,this.pn=i,this.gn=s,this.yn=e,this.Vn=h)}Sn(){var t=this.cn-this.on;Math.abs(t)<this.hn&&(t=0);var i=this.on-this.an;this.an=this.on;var s=this.Zr*t;this.un+=this.$r*t,this.un=this.Tn(this.un);var e=this.un*this.in,h=this.tn*i/this.in;return this.dn=s,this.fn=e,this.vn=h,this.Dn=0,this.bn=0,s+e+h+0+0}}class PIDTuneGraph{constructor(t){this.Mn=t,this.En=0,this.An=0,this.Nn=[]}In(t,i,s){2*i>this.En&&(this.En=2*i),this.Nn.push({Pn:t,Fn:i,Rn:s})}_n(t,i,s,e,h,r,n){2*i>this.En&&(this.En=2*i),e>this.An&&(this.An=e),h>this.An&&(this.An=h),r>this.An&&(this.An=r),this.Nn.push({Pn:t,Fn:i,Rn:n,Bn:s,On:e,kn:h,Ln:r})}ce(t,i,s,e,h){t.bs(i,s);var r=this.Nn[this.Nn.length-1].Rn;t.ai(e/2,h/2,e,h,"#FFFFFF"),t.cr(0,0,0,h,"#000000"),t.cr(0,h,e,h,"#000000"),t.Ei("0.0",-15,h,"10px Arial","#000000"),t.Ei((this.En/2).toFixed(2),-15,h/2,"10px Arial","#000000"),t.Ei(this.En.toFixed(2),-15,0,"10px Arial","#000000"),t.Ei("0.0",0,h+15,"10px Arial","#000000"),t.Ei((r/2).toFixed(2),e/2,h+15,"10px Arial","#000000"),t.Ei(r.toFixed(2),e,h+15,"10px Arial","#000000");var n=0,a=h,o=h,c=h,u=h,l=h,d=h;for(var f of this.Nn){var v=e/r*f.Rn,m=h/this.En,p=h/this.An,g=h-m*f.Fn,w=h-m*f.Pn,C=h-m*f.Bn,S=h-p*f.On,T=h-p*f.kn,x=h-p*f.Ln;t.cr(n,a,v,g,"#FF0000"),t.cr(n,o,v,w,"#0000FF"),t.cr(n,c,v,C,"#000000"),t.cr(n,u,v,S,"#00FF00"),t.cr(n,l,v,T,"#FFFF00"),t.cr(n,d,v,x,"#00FFFF"),n=v,a=g,o=w,c=C,u=S,l=T,d=x}t.bs(-i,-s)}}class ParticleModel{constructor(){this.b=new Vec2D,this.Wn=new Vec2D,this.Jn()}Jn(){this.b.x(0,0),this.Wn.x(0,0),this.Ws=0,this.zn=0,this.size=1,this.dt=null,this.Vt="#FF0000"}}class ParticleSystem{constructor(t){this.Gn=0,this.Un=[],this.Hn=[];for(var i=0;i<t;i++)this.Un.push(new ParticleModel)}qn(t,i,s,e){0==this.Gn&&(this.Gn=e);for(var h=e-this.Gn,r=0;r<this.Hn.length;r++){var n=this.Hn[r];if(n.zn<=e)this.Un.push(n),this.Hn.splice(r,1),n.Jn(),r--;else if(n.b.si(n.Wn.jn(h)),n.dt){var a=e-n.Ws,o=Math.floor(a*n.dt.wi())%n.dt.gi();n.dt.mi(t,i+n.b.nt,s+n.b.at,o)}else t.ai(i+n.b.nt,s+n.b.at,n.size,n.size,n.Vt)}}Kn(t,i,s,e,h,r){if(!(this.Un.length<1)){var n=this.Un.pop();this.Hn.push(n),n.Ws=h,n.zn=h+r,n.b.x(t,i),n.Wn.x(s,e)}}Yn(t,i,s,e,h,r){if(!(this.Un.length<1)){var n=this.Un.pop();this.Hn.push(n),n.Ws=h;var a=r.gi()/r.wi();n.zn=h+a,n.b.x(t,i),n.Wn.x(s,e),n.dt=r}}}class Physics{constructor(){Service.r("physics",this)}Qn(){}nh(){}}class ResourceProvider{constructor(){this.Xn=new EventBus("RP"),this.Zn={},this.$n=0,this.me={},this.ta=0,this.ia={},this.sa=0,this.ea={},this.ha=0,this.ra={},this.na={},this.aa=0,this.oa={},this.ca="",this.bh=!1,this.Xn.bh=!1,Service.r("rp",this)}ua(){return this.$n>0||(this.ta>0||(this.sa>0||(this.ha>0||this.aa>0)))}Pr(t,i){this.Xn.Li({Wi:t,la:"loadComplete",Ce:i}),this.Xn.Mh(t)}ci(t,i){if(this.Zn[t]&&this.Zn[t].Tr)return i&&i({Wi:t,la:"loadComplete",Ce:this.Zn[t]}),this.Zn[t];this.qr(t,i)}qr(t,i){var s=this;if(this.Zn[t])this.Zn[t].Tr?i&&i({Wi:t,la:"loadComplete",Ce:this.Zn[t]}):i&&s.Xn.f(t,i);else{this.bh&&console.log("load image "+t);var e=new Image;e.Tr=!1,e.da=this.ca+t,this.Zn[t]=e,i&&s.Xn.f(t,i),e.fa=function(){s.Zn[t].Tr=!0,s.$n--,s.Pr(t,s.Zn[t])},e.va?console.et("image already complete, abort loading"):this.$n++}}vi(t,i){if(this.me[t]&&this.me[t].Tr)return i&&i({Wi:t,la:"loadComplete",Ce:this.me[t]}),this.me[t];this.jr(t,i)}jr(t,i){var s=this;if(this.me[t])this.me[t].Tr?i&&i({Wi:t,la:"loadComplete",Ce:this.me[t]}):i&&s.Xn.f(t,i);else{this.bh&&console.log("load sprite "+t);var e=new Sprite(t);i&&s.Xn.f(t,i),getJSON(this.ca+t,function(i){s.bh&&console.log("sprite loaded: "+t),s.me[t].xr(i,function(){s.ta--,s.Pr(t,s.me[t])})}),this.me[t]=e,this.ta++}}Ie(t){return void 0!=this.me[t]}ma(t,i){if(this.ia[t]&&this.ia[t].Tr)return i&&i({Wi:t,la:"loadComplete",Ce:this.ia[t]}),this.ia[t];this.Kr(t,i)}Kr(t,i){var s=this;if(this.ia[t])this.ia[t].Tr?i&&i({Wi:t,la:"loadComplete",Ce:this.ia[t]}):i&&s.Xn.f(t,i);else{this.bh&&console.log("load spriteBatch "+t);var e=new SpriteBatch(t);i&&s.Xn.f(t,i),getJSON(this.ca+t,function(i){s.bh&&console.log("spriteBatch loaded: "+t),s.ia[t].pe(i,function(){s.sa--,s.Pr(t,s.ia[t])})}),this.ia[t]=e,this.sa++}}pa(t,i,s){var e=t+":"+i;if(this.ra[e]&&this.ra[e].Tr)return s&&s({Wi:e,la:"loadComplete",Ce:this.ra[e]}),this.ra[e];this.Hr(t,i,s)}Hr(t,i,s){var e=t+":"+i,h=this;if(this.ra[e])this.ra[e].Tr?s&&s({Wi:e,la:"loadComplete",Ce:this.ra[e]}):s&&h.Xn.f(e,s);else{this.bh&&console.log("load animation quickAttach "+t);var r=new Animation;r.Tr=!1,s&&h.Xn.f(e,s),getJSON(this.ca+t,function(t){r.pe(t),r.we(i,".sprite",function(){h.bh&&console.log("animation quickAttach loaded: "+e),r.Tr=!0,h.aa--,h.Pr(e,h.ra[e])})}),this.ra[e]=r,this.aa++}}ga(t,i,s){var e=t+":"+i;if(this.na[e]&&this.na[e].Tr)return s&&s({Wi:e,la:"loadComplete",Ce:this.na[e]}),this.na[e];this.Hr(t,i,s)}Ur(t,i,s){var e=t+":"+i,h=this;if(this.na[e])this.na[e].Tr?s&&s({Wi:e,la:"loadComplete",Ce:this.na[e]}):s&&h.Xn.f(e,s);else{this.bh&&console.log("load FourPole quickAttach "+t);var r=new FourPoleAnimation;r.Tr=!1,s&&h.Xn.f(e,s),getJSON(this.ca+t,function(t){r.pe(t),r.we(i,".sprite",function(){h.bh&&console.log("FourPole quickAttach loaded: "+e),r.Tr=!0,h.aa--,h.Pr(e,h.na[e])})}),this.na[e]=r,this.aa++}}Or(t,i){if(this.ea[t]&&this.ea[t].Tr)return i&&i({Wi:t,la:"loadComplete",Ce:this.ea[t].Sr}),this.ea[t].Sr;this.ht(t,i)}ht(t,i){var s=this;if(this.ea[t])this.ea[t].Tr?i&&i({Wi:t,la:"loadComplete",Ce:this.ea[t].Sr}):i&&s.Xn.f(t,i);else{this.bh&&console.log("load json: "+t),i&&s.Xn.f(t,i);var e=this;getJSON(this.ca+t,function(i){e.bh&&console.log("json loaded: "+t),s.ea[t].Sr=i,s.ea[t].Tr=!0,s.ha--,s.Pr(t,s.ea[t].Sr)}),this.bh&&console.log("json being loaded: "+t),this.ea[t]={vh:t,Sr:null,Tr:!1},this.ha++}}wa(t,i){this.oa.hasOwnProperty(t)?console.et("tried to set already existing resource "+t):this.oa[t]=i}Ca(t){return this.oa[t]}}class SaveData{constructor(t){this.Sa=t,Service.r("sd",this),this.bh=!1}Ta(t,i){null===localStorage.xa(this.Sa+t)&&(this.qh(t,i),this.bh&&console.log("saved initial value for "+t))}qh(t,i){localStorage.ya(this.Sa+t,JSON.stringify(i))}Va(t,i){var s=localStorage.xa(this.Sa+t);return null===s?(this.bh&&console.log("used default value for load of ",t),i):JSON.parse(s)}clear(t){localStorage.Da(this.Sa+t)}}class Service{static T(t){return this.ba||(this.ba=[]),this.ba[t]}static r(t,i){this.ba||(this.ba=[]),this.ba[t]&&console.et("Service "+t+" overrided!"),this.ba[t]=i}static Ma(t){delete this.ba[t]}}class TiledMap{constructor(t,i,s){this.Ks=t.substring(0,t.lastIndexOf("/")+1),this.ui=i,this.li=s,this.Tr=!1,this.Ea=[],this.Aa=[],this.Na=[],this.Ia="player",this.Pa=null,this.Fa=[],this.Ra=[],this._a=[],this.Ba=null,this.Oa=[],this.bh=!0,this.ka=!1}pe(t){var i=Service.T("rp");this.Sr=t;for(var s=0;s<this.Sr.La.length;s++){var e=this.Sr.La[s],h=new Sprite(this.Ks),r={lt:e.lt,yr:"grid",ui:e.Wa,li:e.Ja};h.xr(r),e.dt=h,this.Ea.push(e)}for(var n=0;n<this.Sr.za.length;n++){var a=this.Sr.za[n];if("imagelayer"==a.Ga)this.Na.push(a),i.qr(this.Ks+a.lt);else if("tilelayer"==a.Ga)console.log("add tile layer"),this.Aa.push(a);else if("objectgroup"==a.Ga&&"ground"==a.name)for(var o=0;o<a.Ua.length;o++){var c=a.Ua[o];this.Fa.push(c)}else if("objectgroup"==a.Ga&&"wall"==a.name)for(o=0;o<a.Ua.length;o++){c=a.Ua[o];this.Ra.push(c)}else if("objectgroup"==a.Ga&&"spawn"==a.name)for(o=0;o<a.Ua.length;o++){c=a.Ua[o];this._a.push(c)}}this.Tr=!0}Ha(t){if(0==t)return 0;for(var i=0;i<this.Ea.length;i++){if(this.Ea[i].qa>t||i==this.Ea.length-1)return i}return console.et("TiledMap: couldnt find tilesetIdx for gid "+t),-1}F(t,i,s,e){if(this.Tr){t.Ds(),t.bs(i,s);for(var h=Service.T("rp"),r=0;r<this.Na.length;r++){var n=this.Sr.za[r],a=h.ci(this.Ks+n.lt);a&&t.di(a,n.nt,n.at),n.name==this.Ia&&this.Pa&&this.Pa()}for(r=0;r<this.Aa.length;r++){for(var o=this.Aa[r],c=o.ui,u=o.li,l=0;l<u;l++)for(var d=l*c,f=0;f<c;f++){var v=o.Sr[f+d],m=this.Ha(v);if(!(v<=0)){var p=v-this.Ea[m].qa,g=this.Ea[m].Wa,w=this.Ea[m].Ja;this.Ea[m].dt.mi(t,f*g,l*w,p)}}o.name==this.Ia&&this.Pa&&this.Pa(t,0,0,e)}if(t.Es(),this.ka){for(var C=0;C<this.Fa.length;C++){var S=this.Fa[C];t.Yh(i+S.nt,s+S.at,S.ui,S.li)}for(C=0;C<this.Ra.length;C++){S=this.Ra[C];t.Yh(i+S.nt,s+S.at,S.ui,S.li)}for(C=0;C<this._a.length;C++){S=this._a[C];t.Yh(i+S.nt,s+S.at,S.ui,S.li)}}}}ja(t){return this._a[t]}Ka(){var t=this._a.length-1,i=Math.floor(Math.random()*(t-0))+0;return this._a[i]}Ya(t,i){for(var s=0,e=0;e<this._a.length;e++){Math.abs(this._a.nt-t)+Math.abs(this._a.at-i)>0&&(s=e)}return this._a[s]}Qa(){var t=this,i=new NodeView;return i.Zi((i,s,e,h)=>{var r=i.Oh;i.Oh=!1,t.F(i,s,e,h),i.Oh=r}),i}}function getRand(t,i){return~~(Math.random()*(i-t+1))+t}function radToDeg(t){return 180*t/Math.PI}function dicLength(t){return Object.keys(t).length}function arrayContains(t,i){return!!t.some(function(t){return t==i})}function removeFromArray(t,i){var s=t.indexOf(i);return s>-1&&(t.splice(s,1),!0)}function isString(t){return"string"==typeof t||t instanceof String}function isArray(t){return t.constructor===Array||Array.isArray(t)}function generateUUID(){var t=Date.now();return window.Xa&&"function"==typeof window.Xa.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==i?s:3&s|8).toString(16)})}function getJSON(t,i){var s=new XMLHttpRequest;s.Za("GET",t,!0),s.fa=function(){if(this.la>=200&&this.la<400||0==this.la&&this.$a){var s=JSON.parse(this.$a);i(s)}else console.o("unable to download "+t+" error: "+this.la+" "+this.to),i(null)},s.io=function(){console.o("unable to download "+t+" unable to connect"),i(null)},s.so()}function CreateScreenShade(t){t=t||.5;var i=Graphics.Ih,s=new NodeView;return s.bt(i.nt,i.at,"rgba(0,0,0,"+t+")"),s.b.x(i.nt/2,i.at/2),s.st(),s}function CreateSimpleButton(t,i,s){var e=new Vec2D(100,40);s||(s=EventBus.d),isString(s)&&(s=EventBus.T(s));var h=new NodeView;return h.bt(e.nt,e.at,"rgb(50,150,50)"),h.Bt(t,"16px Arial"),h.$i(function(){s.Li({Wi:i,from:h})}),h}function CreateSimpleImageButton(t,i,s,e){e||(e=EventBus.d),isString(e)&&(e=EventBus.T(e));var h=new NodeView;return h.Ft(i),t&&h.Bt(t,"14px Arial"),h.$i(function(){e.Li({Wi:s,from:h})}),h}function CreateSimplePopup(t,i,s,e){var h=new Vec2D(300,250),r=new NodeView;r.bt(h.nt,h.at,"rgb(200,200,200)");var n=CreateSimpleButton(i,s,e);n.b.at=h.at/2,r.M(n),console.log("button size "+n.size.nt+","+n.size.at),h.at-=n.size.at;var a=new NodeView;return a.Bt(t,"24px Arial","rgb(0,0,0)",!0),a.b.at=h.at,r.M(a),r}function CreateSimpleVerticleSlider(t,i,s,e){e||(e=EventBus.d),isString(e)&&(e=EventBus.T(e));var h=new NodeView;return h.bt(10,i,"rgb(128,128,128)"),h.eo=0,h.ho=new NodeView,h.ho.bt(t,20,"rgb(255,255,255)"),h.M(h.ho),h.$i(function(t,r,n){h.eo=1-(n/(i-20)+.5),h.eo=Math.min(h.eo,1),h.eo=Math.max(h.eo,0),e.Li({Wi:s,eo:h.eo})},!1),h.Zi(function(t,s,e,r){h.ho.b.at=(1-h.eo)*i-i/2}),h}function CreateSimpleEditBox(t,i,s,e,h){var r=new Vec2D(300,250),n=new NodeView;n.bt(r.nt,r.at,"rgb(200,200,200)");var a=CreateSimpleButton(s,e,h);a.b.at=r.at/2,n.M(a),console.log("button size "+a.size.nt+","+a.size.at),r.at-=a.size.at;var o=new NodeView;return o.Bt(t,"24px Arial","rgb(0,0,0)",!0),o.b.at=r.at,n.M(o),n}function CreateSimpleProgressBar(t,i,s,e){new Vec2D(s,e);var h=new NodeView;return h.eo=0,h.bt(s,e,i),h.G.push(function(i,r,n,a){var o=h.eo*(s-2),c=t;i.ai(r-s/2+o/2+1,n,o,e-2,c)}),h}exports.ro=getRand,exports.no=radToDeg,exports.ao=arrayContains,exports.oo=removeFromArray,exports.isArray=isArray,exports.co=isString;class Vec2D{constructor(t,i){this.nt=t||0,this.at=i||0}uo(t){this.nt=t.nt,this.at=t.at}X(){return{nt:this.nt,at:this.at}}ht(t){this.nt=t.nt||0,this.at=t.at||0}ii(){return new Vec2D(this.nt,this.at)}toString(){return this.nt.toFixed(4)+","+this.at.toFixed(4)}X(){return{nt:this.nt,at:this.at}}x(t,i){return this.nt=t,this.at=i,this}cs(t){return this.nt=t.nt,this.at=t.at,this}si(t){return this.nt+=t.nt,this.at+=t.at,this}lo(t){return this.nt-=t.nt,this.at-=t.at,this}ms(t){return this.nt=this.nt*t,this.at=this.at*t,this}do(){return 0!=this.nt||0!=this.at}fo(){var t=this.vo();return new Vec2D(this.nt/t,this.at/t)}mo(){return this.nt*this.nt+this.at*this.at}vo(){return Math.sqrt(this.nt*this.nt+this.at*this.at)}jn(t){return new Vec2D(this.nt*t,this.at*t)}Os(t){return new Vec2D(this.nt+t.nt,this.at+t.at)}fs(t){return new Vec2D(this.nt-t.nt,this.at-t.at)}po(t){return this.nt*t.nt+this.at*t.at}go(t){return t.fs(this).mo()}wo(t){return this.nt==t.nt&&this.at==t.at}Co(){return 0==this.at&&0==this.nt?0:Math.atan2(this.at,this.nt)+Math.PI/2}So(t){return t-=Math.PI/2,this.nt=Math.cos(t),this.at=Math.sin(t),this}static To(t){return t-=Math.PI/2,new Vec2D(Math.cos(t),Math.sin(t))}rs(t){if(0==this.nt&&0==this.at)return this;var i=Math.cos(t),s=Math.sin(t),e=this.nt*i-this.at*s,h=this.nt*s+this.at*i;return Math.abs(e)<1e-7&&(e=0),Math.abs(h)<1e-7&&(h=0),this.nt=e,this.at=h,this}xo(t){if(0==this.nt&&0==this.at)return new Vec2D(0,0);var i=Math.cos(t),s=Math.sin(t),e=this.nt*i-this.at*s,h=this.nt*s+this.at*i;return Math.abs(e)<1e-7&&(e=0),Math.abs(h)<1e-7&&(h=0),new Vec2D(e,h)}}class Segment2D{constructor(t,i){this.yo=t,this.Vo=i}X(){return{yo:this.yo.X(),Vo:this.Vo.X()}}ht(t){this.yo=(new Vec2D).ht(t.yo),this.Vo=(new Vec2D).ht(t.Vo)}toString(){return this.yo.toString()+" -> "+this.Vo.toString()}Do(){var t=this.Vo.fs(this.yo);return t.rs(Math.PI/180*90),t.fo()}bo(){return this.Vo.fs(this.yo).vo()}Mo(t,i,s,e){return new Segment2D(new Vec2D(t,i),new Vec2D(s,e))}Eo(t){return Segment2D.Ao(this.yo,this.Vo,t.yo,t.Vo)}static No(t,i,s){var e=t.Do(),h=s.fs(i.yo),r=h.fs(e.jn(2*h.po(e))).fo(),n=i.bo()-h.vo(),a=r.ms(n);return s.Os(a)}static Ao(t,i,s,e){var h=i.fs(t),r=e.fs(s),n=h.nt*r.at-h.at*r.nt;if(0==n)return null;var a=s.fs(t),o=(a.nt*r.at-a.at*r.nt)/n;if(o<0||o>1)return null;var c=(a.nt*h.at-a.at*h.nt)/n;return c<0||c>1?null:t.Os(h.jn(o))}}class Rect2D{constructor(t,i,s,e){this.nt=t||0,this.at=i||0,this.Mt=s||0,this.Et=e||0}static get Io(){return 0}static get Po(){return 1}static get Fo(){return 2}static get Ro(){return 3}X(){return{nt:this.nt,at:this.at,Mt:this.Mt,Et:this.Et}}ht(t){this.nt=t.nt||0,this.at=t.at||0,this.Mt=t.Mt||0,this.Et=t.Et||0}toString(){return this.nt.toFixed(4)+","+this.at.toFixed(4)+":"+this.Mt.toFixed(4)+"x"+this.Et.toFixed(4)}ii(){return new Rect2D(this.nt,this.at,this.Mt,this.Et)}_o(){return new Vec2D(this.nt+this.Mt/2,this.at+this.Et/2)}Bo(){return this.nt+this.Mt}Oo(){return this.at+this.Et}ko(){return new Vec2D(this.nt,this.at)}Lo(){return new Vec2D(this.nt+this.Mt,this.at)}Wo(){return new Vec2D(this.nt,this.at+this.Et)}Jo(){return new Vec2D(this.nt+this.Mt,this.at+this.Et)}zo(){return new Vec2D(-this.Mt/2,-this.Et/2)}Go(){return new Vec2D(this.Mt/2,-this.Et/2)}Uo(){return new Vec2D(-this.Mt/2,this.Et/2)}Ho(){return new Vec2D(this.Mt/2,this.Et/2)}qo(){return Segment2D.Mo(this.nt,this.at,this.nt+this.Mt,this.at)}jo(){return Segment2D.Mo(this.nt,this.at+this.Et,this.nt+this.Mt,this.at+this.Et)}Ko(){return Segment2D.Mo(this.nt,this.at,this.nt,this.at+this.Et)}Yo(){return Segment2D.Mo(this.nt,this.at+this.Et,this.nt+this.Mt,this.at+this.Et)}Qo(t){return this.nt==t.nt&&this.at==t.at&&this.Mt==t.Mt&&this.Et==t.Et}bt(t){return this.nt=t.nt,this.at=t.at,this.Mt=t.Mt,this.Et=t.Et,this}x(t,i,s,e){return this.nt=t,this.at=i,this.Mt=s,this.Et=e,this}Xo(t){return this.Mt=t.nt,this.Et=t.at,this}Zo(t,i){return this.Mt=t,this.Et=i,this}$o(){return new Vec2D(this.Mt,this.Et)}tc(t,i){return this.nt=t,this.at=i,this}ic(t,i){return this.nt=t-this.Mt/2,this.at=i-this.Et/2,this}sc(t){return this.nt=t.nt-this.Mt/2,this.at=t.at-this.Et/2,this}ec(t){return this.nt+=t.nt,this.at+=t.at,this}hc(t){return this.nt-=t.nt,this.at-=t.at,this}rc(t,i){return this.nt+=t,this.at+=i,this}nc(t){return!(t.nt<this.nt)&&(!(t.at<this.at)&&(!(t.nt>this.nt+this.Mt)&&!(t.at>this.at+this.Et)))}ac(t){return!(t.nt>this.nt+this.Mt)&&(!(t.at>this.at+this.Et)&&(!(t.nt+t.Mt<this.nt)&&!(t.at+t.Et<this.at)))}ps(t){t.nt<this.nt&&(t.nt=this.nt),t.nt>this.nt+this.Mt&&(t.nt=this.nt+this.Mt),t.at<this.at&&(t.at=this.at),t.at>this.at+this.Et&&(t.at=this.at+this.Et)}static ns(t,i,s,e,h,r){return!(t<s)&&(!(i<e)&&(!(t>s+h)&&!(i>e+r)))}static oc(t,i,s){return!(t.nt<i.nt)&&(!(t.at<i.at)&&(!(t.nt>i.nt+s.nt)&&!(t.at>i.at+s.at)))}static cc(t,i){var s=new Rect2D;s.nt=t.nt<i.nt?t.nt:i.nt,s.at=t.at<i.at?t.at:i.at;var e=t.nt+t.Mt,h=i.nt+i.Mt;s.Mt=e>h?e-s.nt:h-s.nt;var r=t.at+t.Et,n=i.at+i.Et;return s.Et=r>n?r-s.at:n-s.at,s}static uc(t,i){var s=new Rect2D;s.nt=t.nt>i.nt?t.nt:i.nt,s.at=t.at>i.at?t.at:i.at;var e=t.nt+t.Mt,h=i.nt+i.Mt;s.Mt=e<h?e-s.nt:h-s.nt;var r=t.at+t.Et,n=i.at+i.Et;return s.Et=r<n?r-s.at:n-s.at,s}static lc(t,i){var s=t._o(),e=t.zo().rs(i).si(s),h=t.Go().rs(i).si(s),r=t.Uo().rs(i).si(s),n=t.Ho().rs(i).si(s),a=Math.min(e.nt,h.nt,r.nt,n.nt),o=Math.max(e.nt,h.nt,r.nt,n.nt),c=Math.min(e.at,h.at,r.at,n.at),u=Math.max(e.at,h.at,r.at,n.at);return new Rect2D(a,c,o-a,u-c)}static dc(){console.log("Beginning Rect2D unit tests...");var t=new Rect2D(0,0,100,100),i=new Rect2D(50,50,100,100),s=new Rect2D(-10,-20,10,20);console.log("test unions: ");var e=Rect2D.cc(t,i);console.log("expect "+new Rect2D(0,0,150,150).toString()),console.log("result "+e.toString());var h=Rect2D.cc(t,s);console.log("expect "+new Rect2D(-10,-20,110,120).toString()),console.log("result "+h.toString()),console.log("test intersects: ");var r=Rect2D.uc(t,i);console.log("expect "+new Rect2D(50,50,50,50).toString()),console.log("result "+r.toString());var n=Rect2D.uc(t,s);console.log("expect "+new Rect2D(0,0,0,0).toString()),console.log("result "+n.toString())}}exports.fc=Vec2D,exports.vc=Rect2D;class CastCommandState{static get mc(){return 0}static get pc(){return 1}static get gc(){return 2}static get wc(){return 3}constructor(t,i){this.Cc=CastCommandState.mc,this.Sc=0,this.Tc=0,this.xc=0,this.yc=t,this.Vc=i,this.Dc=t.bc||"",this.Mc=t.Ec||0}Ac(){if(this.Cc==CastCommandState.pc){var t=CastWorldModel.T();if(t.Nc(this.Vc)){if(this.Vc.Ic(CastCommandTime.T()),0!=this.Mc){var i=this.Vc.Pc(this.Dc);if(this.Mc>0&&this.Mc>i)return void this.Fc()}var s=CastCommandTime.T();if(this.Sc=s,this.Vc._c().Rc(this.yc.Bc(),this.Vc)){for(var e=!1,h=0;h<this.yc.Oc();h++){var r=new CastEffect;r.Ta(this,h,this.Vc,!1),t.kc(this.Vc,r,this.Vc._c(),s),e=!0}e&&0!=this.Mc&&this.Vc.Lc(this.Dc,-1*this.Mc,null),this.yc.Wc>0?this.Jc():this.Fc()}else this.Fc()}}}Jc(){this.Cc=CastCommandState.gc,this.Vc.zc(CastCommandTime.T()),this.Gc(this.yc.Uc)}Hc(){this.Cc==CastCommandState.gc&&CastWorldModel.T().Nc(this.Vc)&&(this.Vc.qc(CastCommandTime.T()),this.Fc())}jc(){this.Vc._c().Kc();for(var t=0;t<this.yc.Yc();t++){var i=new CastEffect;i.Ta(this,t,this.Vc,!0),CastWorldModel.T().kc(this.Vc,i,this.Vc._c(),CastCommandTime.T())}}Fc(){this.Cc=CastCommandState.wc,this.Gc(this.yc.Qc)}Xc(){if(this.Cc==CastCommandState.wc){var t=CastCommandTime.T();this.Sc=t,this.Cc=CastCommandState.mc}}Gc(t){CastCommandScheduler.T().Zc(this.$c.bind(this),t)}tu(){CastCommandScheduler.T().iu(this.$c.bind(this))}su(){return this.yc?this.yc.su():null}eu(){return 0==this.xc||this.Vc.Pc(this.Dc)>=this.Mc}hu(){return this.Cc==CastCommandState.pc}ru(){if(this.Cc==CastCommandState.pc){var t=CastCommandTime.T()-this.Sc;return t>this.yc.nu&&(t=this.yc.nu),t<0&&(t=0),t/this.yc.nu}return 0}au(){return this.Cc==CastCommandState.gc}ou(){if(this.Cc==CastCommandState.gc){var t=CastCommandTime.T()-this.Sc;return t>this.yc.Wc&&(t=this.yc.Wc),t<0&&(t=0),t/this.yc.Wc}return 0}cu(){return this.Cc==CastCommandState.wc}uu(){if(this.Cc==CastCommandState.wc){var t=CastCommandTime.T()-this.Sc;return t>this.yc.Qc&&(t=this.yc.Qc),t<0&&(t=0),t/this.yc.Qc}return 0}lu(){return this.Cc==CastCommandState.mc}Bc(){return this.yc?this.yc.Bc():0}du(t){return(t=t||"")?this.yc.fu[t]||{}:this.yc.fu}vu(){return!!this.lu()&&(this.Cc=CastCommandState.pc,this.Sc=CastCommandTime.T(),this.Tc=0,this.Vc.mu(CastCommandTime.T(),this.du("startCast")),0==this.yc.nu?this.$c(0):this.Gc(this.yc.nu),!0)}$c(t){var i=CastCommandTime.T()-this.Sc;if(this.Cc==CastCommandState.pc)i>=this.yc.nu?this.Ac():console.o("shouldnt happen, cast time");else if(this.Cc==CastCommandState.gc){i>this.yc.Wc&&(i=this.yc.Wc);for(var s=i/this.yc.Uc-this.Tc,e=0;e<s;e++)this.jc(),this.Tc++;i>=this.yc.Wc?this.Hc():this.Gc(this.yc.Uc)}else this.Cc==CastCommandState.wc&&(i>=this.yc.Qc?this.Xc():console.o("shouldnt happen, cooldown time"))}}class CastCommandModel{constructor(t){var i=t;this.name=i.name||"effectName",this.nu=i.nu||0,this.Wc=i.Wc||0,this.Uc=i.Uc||1,this.pu=i.pu||0,this.gu=i.gu||0,this.wu=i.Cu||!1,this.Su=i.Su||!1,this.Qc=i.Qc||0,this.Tu=i.Tu||0,this.xu=0,this.fu=i}yu(){return this.Wc>0}Vu(){return this.nu<=0}Yc(){return this.fu.Du.length}bu(t){return this.fu.Du[t]}Oc(){return this.fu.Mu.length}Eu(t){return this.fu.Mu[t]}Bc(){return this.gu}su(){return this.name}}class CastCommandScheduler{static T(){return CastCommandScheduler.Fr||(CastCommandScheduler.Fr=new CastCommandScheduler),CastCommandScheduler.Fr}constructor(){this.Au={},this.Gn=0}Zc(t,i){var s=CastCommandTime.T()+i;this.Au.hasOwnProperty(s)?this.Au[s].push(t):this.Au[s]=[t]}iu(t){delete this.Au[t]}C(){var t=CastCommandTime.T();if(t!=this.Gn){this.Gn=t;var i=[];for(var s in this.Au)if(s<=t)for(var e of(i.push(s),this.Au[s]))e();for(var h=0;h<i.length;h++)delete this.Au[i[h]]}}}CastCommandScheduler.Fr=null;class CastEffectType{static get Nu(){return"DAMAGE_STAT"}static get Iu(){return"SUPPRESS_STAT"}static get Pu(){return"HEAL_STAT"}static get Fu(){return"BUFF_STAT"}static get Ru(){return"SEND_EVENT"}}class CastEffect{constructor(){this._u=CastEffectType.Nu,this.Bu=0,this.Ou=0,this.ku=0,this.Lu=0,this.Wu=!1,this.Ju=!1,this.zu=!1,this.Gu="",this.Uu="",this.Hu="",this.qu="",this.ju=0,this.Ku=0,this.Yu=null,this.Qu=null,this.yc=null,this.Xu=null,this.Zu=0}s(){this.$u()}tl(t){this.Ju=!0;var i=t.il(),s=t.sl(),e=t.Zu,h=t.Wu;this.Ta(i,e,s,h)}Ta(t,i,s,e){this.Xu=t,this.yc=t.yc,this.Zu=i,this.Wu=e;var h=this.du();h.hasOwnProperty("name")?this.Gu=h.name.el():this.Gu=this.yc.su();var r=h.hl||"damage";if("damage"==r?this._u=CastEffectType.Nu:"heal"==r?this._u=CastEffectType.Pu:"buff"==r?this._u=CastEffectType.Fu:"debuff"==r?this._u=CastEffectType.Iu:"event"==r&&(this._u=CastEffectType.Ru),this.Qu=s,this.zu=h.rl||!1,this.Uu=h.nl||"",this.Hu=h.al||"",this.Ku=h.ol||0,h.cl){var n=this.Qu.Pc(h.cl);if(void 0==n)console.o("entity does not define value stat "+h.cl);else{var a=h.ul;this.Ku+=n*a}}this.Ou=h.ll||0,this.ku=h.dl||this.ku}ks(t){CastWorldModel.T().Nc(t)&&(this.Yu=t)}fl(){this._u==CastEffectType.Fu||this._u==CastEffectType.Iu||this._u==CastEffectType.Ru?this.vl():(this.ju=0,CastCommandScheduler.T().Zc(this.ml.bind(this),this.ku))}pl(){return this.Ou/this.ku+1}su(){return this.Gu}gl(){return this._u}wl(){return this.Bu}_c(){return this.Yu}Cl(){return this.Qu}Sl(){return this.Ou}il(){return this.Xu}sl(){return this.Qu}Tl(t){return t-this.Ou}xl(){return this._u==CastEffectType.Fu||this._u==CastEffectType.Pu}yl(){this.Ju=!0;var t=parent.Xu,i=parent.Qu,s=parent.Zu,e=parent.Wu;this.Ta(t,s,i,e)}Vl(){return this.du().Dl("returnEffect")}bl(){return this.zu}Ml(){return this.yc.fu.pu||0}ml(t){if(CastWorldModel.T().Nc(this.Yu)){var i=CastCommandTime.T()-this.Bu;if(i>this.Ou&&(i=this.Ou),this._u==CastEffectType.Iu||this._u==CastEffectType.Fu)i==this.Ou&&(CastCommandScheduler.T().iu(this.ml.bind(this)),this._u==CastEffectType.Fu?this.Yu.El(this.Hu,-1*this.Ku,this):this.Yu.El(this.Hu,this.Ku,this),this.Yu.Al(this));else{for(var s=i/this.ku-this.ju,e=0;e<s;e++)this.vl(),this.ju++;i>=this.Ou&&(this.Yu.Al(this),this.$u())}}}$u(){CastCommandScheduler.T().iu(this.ml.bind(this))}vl(){var t=CastWorldModel.T();if(t.Nc(this.Yu)){0==this.Bu&&(this.Bu=CastCommandTime.T());var i=this.du();switch(i.hasOwnProperty("react")&&this.Yu.Nl(i.Il,this),this._u){case CastEffectType.Nu:this.Yu.Lc(this.Hu,-1*this.Ku,this);break;case CastEffectType.Pu:this.Yu.Lc(this.Hu,this.Ku,this);break;case CastEffectType.Iu:this.Yu.Pl(this.Hu,-1*this.Ku,this),CastCommandScheduler.T().Zc(this.ml.bind(this),this.Ou);break;case CastEffectType.Fu:this.Yu.Pl(this.Hu,this.Ku,this),CastCommandScheduler.T().Zc(this.ml.bind(this),this.Ou);break;case CastEffectType.Ru:this.Yu.Fl(this.Gu,this);break;default:console.log("TODO: handle effect type "+this._u)}if(i.Dl("returnEffect")){if(i=i.Rl,!t.Nc(this.Qu))return;var s=new CastEffect;s.yl(this),s.Ku=this.Ku;var e=this.Yu,h=this.Qu,r=new CastTarget;r._l(h),t.kc(e,s,r,CastCommandTime.T()),r=null}}}du(t){return null==this.yc||this.Zu<0?{}:t?i[t]||{}:(i=this.Wu?this.yc.bu(this.Zu):this.yc.Eu(this.Zu),this.Ju&&(i=i.Rl||{}),i);var i}ii(){var t=new CastEffect;return t._u=this._u,t.Bu=this.Bu,t.Ou=this.Ou,t.ku=this.ku,t.Uu=this.Uu,t.Hu=this.Hu,t.qu=this.qu,t.ju=this.ju,t.Ku=this.Ku,t.Yu=this.Yu,t.Qu=this.Qu,t.yc=this.yc,t.Xu=this.Xu,t.Zu=this.Zu,t.Wu=this.Wu,t.Ju=this.Ju,t.Gu=this.Gu,t}}class ICastEntity{constructor(){CastWorldModel.T().Bl(this)}s(){CastWorldModel.T().Ol(this)}kl(t,i,s){}Lc(t,i,s){}Pl(t,i,s){}El(t,i,s){}Pc(t){return 0}_c(){return null}Nl(t,i){}Fl(t,i){}Ll(t){}Al(t){}mu(t,i){}zc(t,i){}Ic(t){}qc(t){}}class CastTargetType{static get Wl(){return 0}static get Jl(){return 1}static get zl(){return 2}}class CastTarget{constructor(t){t=t||CastTargetType.Wl,this._u=t,this.Gl=new Vec2D,this.Ul=[]}Hl(){return this.Ul}gl(){return this._u}ql(){this.Ul.length=0}_l(t){t&&(this._u=CastTargetType.Wl,this.Ul.push(t))}jl(t){this.Gl=t}Kc(){for(var t=CastWorldModel.T(),i=this.Ul.length-1;i>=0;i--)t.Nc(this.Ul[i])||this.Ul.splice(i,1)}Rc(t,i){var s=t*t;if(this._u==CastTargetType.Wl){for(var e=!1,h=CastWorldModel.T(),r=this.Ul.length-1;r>=0;r--)if(h.Nc(this.Ul[r])){if(!e){var n=this.Ul[r],a=h.Yl().Kl(i,n);a&&a.mo()<=s&&(e=!0)}}else this.Ul.splice(r,1);return e}return!0}Ql(){return this._u!=CastTargetType.Wl||(this.Kc(),this.Ul.length>0)}}class CastEffectPath{constructor(){this.Ws=0,this.Xl=0,this.from=null,this.Zl=null,this.$l=new Vec2D,this.yt=0,this.td=[]}}class CastWorldModel{static T(){return CastWorldModel.Fr||(CastWorldModel.Fr=new CastWorldModel),CastWorldModel.Fr}constructor(){this.id={},this.sd=[],this.ed=null}Bl(t){this.id[t]=t}Ol(t){this.id[t]&&delete this.id[t]}hd(t){this.ed=t}Yl(){return this.ed}kc(t,i,s,e){var h=i.Ml();if(0!=h)if(s.gl()==CastTargetType.Wl){var r=new CastEffectPath;r.from=t,r.yt=0,r.Xl=h,r.Ws=e;for(var n=s.Hl(),a=0;a<n.length;a++){var o=n[a];CastWorldModel.T().Nc(t)&&(CastWorldModel.T().Nc(o)&&(console.log("add effect in transit"),r.Zl=o,r.td.push(i)))}this.sd.push(r)}else console.et("non-entity target type not yet implemented");else this.rd(t,i,s,e)}rd(t,i,s,e){if(s.gl()==CastTargetType.Wl){var h=new CastEffectPath;h.from=t,h.yt=0,h.Xl=0,h.Ws=e;for(var r=s.Hl(),n=0;n<r.length;n++){var a=r[n];CastWorldModel.T().Nc(t)&&(CastWorldModel.T().Nc(a)&&(h.Zl=a,h.td.push(i)))}this.nd(h),i=null}else console.et("non-entity target type not yet implemented")}nd(t){for(var i=CastCommandTime.T(),s=0;s<t.td.length;s++){var e=t.td[s],h=[];if(null!=t.Zl){if(CastWorldModel.T().Nc(t.Zl)&&(h.push(t.Zl),e.bl())){var r=e.du("aoeRadius"),n=this.ed.ad(t.Zl,n);n&&(console.log("possible bug here -- add targets dont overwrite it?"),h=this.ed.od(n,r))}}else h=this.ed.od(t.$l,t.yt);for(var a={},o=0;o<h.length;o++){var c=h[o];if(!a[c]){a[c]=c;var u=e;o>0&&(u=e.ii()),u.ks(c),u.Bu=i,c.Ll(u)}}}}cd(t){var i=[];CastCommandTime.ud(t);for(var s=CastCommandTime.T(),e=0;e<this.sd.length;e++){var h=this.sd[e],r=1/h.Xl;s-h.Ws>=r&&(this.nd(h),i.push(e));for(e=i.length-1;e>=0;e--){for(var n=this.sd[e].td.length-1;n>=0;n--)this.sd[e].td[n]=null;this.sd[e].td.length=0,this.sd.splice(e,1)}}CastCommandScheduler.T().C()}Nc(t){return!!this.id[t]}}CastWorldModel.Fr=null;class CastCommandTime{static T(){return CastCommandTime.ld}static ud(t){return CastCommandTime.ld+=t,CastCommandTime.ld}static dd(t){return CastCommandTime.ld=t,CastCommandTime.ld}}CastCommandTime.ld=0;class ICastPhysics{Kl(t,i){return null}ad(t){return null}od(t,i,s){return null}}!function(){var t=[];(window.fd=function(i){var s=this;i=i||{},s.vd=i.Pi||null,s.md=s.vd?s.vd.Bh("2d"):null,s.pd=i.nt||0,s.gd=i.at||0,s.wd=i.Cd||0,s.Sd=i.Td||0,s.xd=i.yd||14,s.Vd=i.Dd||"Arial",s.bd=i.Md||"#000",s.Ed=i.Ad||"#bfbebd",s.Nd=i.Id||"normal",s.Pd=i.Fd||"normal",s.Rd=i._d||"",s.Bd=i.Od||0,s.kd=i.Ld||0,s.Wd=i.Jd||0,s.zd=i.Gd||!1,s.Ud=i.Hd||null,s.qd=i.ui||150,s.jd=i.li||s.xd,s.Kd=i.Fi>=0?i.Fi:5,s.Yd=i.Qd>=0?i.Qd:1,s.Xd=i.Zd||"#959595",s.$d=i.Ri>=0?i.Ri:3,s.tf=i.if||"",s.sf=i._i||"1px 1px 0px rgba(255, 255, 255, 1)",s.ef=i.Bi||"0px 0px 4px rgba(0, 0, 0, 0.4)",s.hf=i.rf||"rgba(179, 212, 253, 0.8)",s.nf=i.af||"",s.cf=(i.Ji||s.nf)+"",s.uf=i.ki||function(){},s.lf=i.Be||function(){},s.df=i.ws||function(){},s.ff=i.vf||function(){},s.mf=i.pf||function(){},s.gf=!1,s.wf=0,s.Cf=!1,s.Sf=[0,0],s.Tf=!1,s._i(s.sf,!0),s.xf(),s.yf=document.Vf("canvas"),s.yf.Df("width",s.bf),s.yf.Df("height",s.Mf),s.Ef=s.yf.Bh("2d"),s.Af=document.Vf("canvas"),s.Af.Df("width",s.qd+2*s.Kd),s.Af.Df("height",s.jd+2*s.Kd),s.Nf=s.Af.Bh("2d"),void 0!==i.If?(s.Pf=s.Ef.Ff(0,0,0,s.Mf),s.Pf.Rf(0,i.If[0]),s.Pf.Rf(1,i.If[1])):s.Pf=i._f||"#fff",s.vd&&(s.vd.Bf("mousemove",function(t){t=t||window.Vi,s.Of(t,s)},!1),s.vd.Bf("mousedown",function(t){t=t||window.Vi,s.kf(t,s)},!1),s.vd.Bf("mouseup",function(t){t=t||window.Vi,s.Lf(t,s)},!1)),window.Bf("mouseup",function(t){t=t||window.Vi,s.Cf&&!s.Wf&&s.Jf()},!0),s.zf=document.Vf("input"),s.zf.Ga="text",s.zf.Uf.Gf="absolute",s.zf.Uf.Hf=0,s.zf.Uf.qf="none",s.zf.Uf.ke=s.pd+s.wd+(s.vd?s.vd.Le:0)+"px",s.zf.Uf.Je=s.gd+s.Sd+(s.vd?s.vd.ze:0)+"px",s.zf.Uf.ui=s.qd+"px",s.zf.Uf.li=s.jd+"px",s.zf.Uf.jf=0,s.Ud&&(s.zf.Kf=s.Ud),document.Qf.Yf(s.zf),s.zf.Ji=s.cf,s.zf.Bf("keydown",function(t){t=t||window.Vi,s.Cf&&s.gs(t,s)}),s.zf.Bf("keyup",function(t){t=t||window.Vi,s.cf=s.zf.Ji,s.wf=s.zf.Xf,s.Sf=[s.zf.Xf,s.zf.Zf],s.$f(),s.Cf&&s.df(t,s)}),t.push(s),s.tv=t.length-1,s.$f()}).prototype={Pi:function(t){return void 0!==t?(this.vd=t,this.md=this.vd.Bh("2d"),this.$f()):this.vd},nt:function(t){return void 0!==t?(this.pd=t,this.$f()):this.pd},at:function(t){return void 0!==t?(this.gd=t,this.$f()):this.gd},Cd:function(t){return void 0!==t?(this.wd=t,this.$f()):this.wd},Td:function(t){return void 0!==t?(this.Sd=t,this.$f()):this.Sd},yd:function(t){return void 0!==t?(this.xd=t,this.$f()):this.xd},Dd:function(t){return void 0!==t?(this.Vd=t,this.$f()):this.Vd},Md:function(t){return void 0!==t?(this.bd=t,this.$f()):this.bd},Ad:function(t){return void 0!==t?(this.Ed=t,this.$f()):this.Ed},Id:function(t){return void 0!==t?(this.Nd=t,this.$f()):this.Nd},Fd:function(t){return void 0!==t?(this.Pd=t,this.$f()):this.Pd},_d:function(t){return void 0!==t?(this.Rd=t,this.$f()):this.Rd},Od:function(t){return void 0!==t?(this.Bd=t,this.$f()):this.Bd},Ld:function(t){return void 0!==t?(this.kd=t,this.$f()):this.kd},Jd:function(t){return void 0!==t?(this.Wd=t,this.$f()):this.Wd},ui:function(t){return void 0!==t?(this.qd=t,this.xf(),this.iv(),this.$f()):this.qd},li:function(t){return void 0!==t?(this.jd=t,this.xf(),this.iv(),this.$f()):this.jd},Fi:function(t){return void 0!==t?(this.Kd=t,this.xf(),this.iv(),this.$f()):this.Kd},Qd:function(t){return void 0!==t?(this.Yd=t,this.xf(),this.iv(),this.$f()):this.Yd},Zd:function(t){return void 0!==t?(this.Xd=t,this.$f()):this.Xd},Ri:function(t){return void 0!==t?(this.$d=t,this.$f()):this.$d},_f:function(t){return void 0!==t?(this.Pf=t,this.$f()):this.Pf},If:function(t){return void 0!==t?(this.Pf=this.Ef.Ff(0,0,0,this.Mf),this.Pf.Rf(0,t[0]),this.Pf.Rf(1,t[1]),this.$f()):this.Pf},_i:function(t,i){if(void 0===t)return this.sf;var s=t.split("px ");return this.sf={nt:"none"===this.sf?0:parseInt(s[0],10),at:"none"===this.sf?0:parseInt(s[1],10),Jf:"none"===this.sf?0:parseInt(s[2],10),sv:"none"===this.sf?"":s[3]},this.sf.nt<0?(this.ev=Math.abs(this.sf.nt)+this.sf.Jf,this.hv=this.sf.Jf+this.sf.nt):(this.ev=Math.abs(this.sf.Jf-this.sf.nt),this.hv=this.sf.Jf+this.sf.nt),this.sf.at<0?(this.rv=Math.abs(this.sf.at)+this.sf.Jf,this.nv=this.sf.Jf+this.sf.at):(this.rv=Math.abs(this.sf.Jf-this.sf.at),this.nv=this.sf.Jf+this.sf.at),this.av=this.ev+this.hv,this.ov=this.rv+this.nv,this.xf(),i?void 0:(this.iv(),this.$f())},Bi:function(t){return void 0!==t?(this.ef=t,this.$f()):this.ef},rf:function(t){return void 0!==t?(this.hf=t,this.$f()):this.hf},af:function(t){return void 0!==t?(this.nf=t,this.$f()):this.nf},Ji:function(t){return void 0!==t?(this.cf=t+"",this.zf.Ji=t+"",this.wf=this.cv().length,this.$f(),this):this.cf===this.nf?"":this.cf},ki:function(t){if(void 0!==t)return this.uf=t,this;this.uf()},Be:function(t){if(void 0!==t)return this.lf=t,this;this.lf()},ws:function(t){if(void 0!==t)return this.df=t,this;this.df()},uv:function(i){var s=this;if(!s.Cf){s.ff(s);for(var e=0;e<t.length;e++)t[e].Cf&&t[e].Jf()}if(s.lv?delete s.lv:s.Sf=[0,0],s.Cf=!0,!s.zd){s.zf.dv=!1,s.wf="number"==typeof i?i:s.cv().length,s.nf===s.cf&&(s.cf="",s.zf.Ji=""),s.gf=!0,s.fv&&clearInterval(s.fv),s.fv=setInterval(function(){s.gf=!s.gf,s.$f()},500);var h=s.Sf[0]>0||s.Sf[1]>0;return s.zf.uv(),s.zf.Xf=h?s.Sf[0]:s.wf,s.zf.Zf=h?s.Sf[1]:s.wf,s.$f()}s.zf.dv=!0},Jf:function(t){var i=t||this;return i.mf(i),i.fv&&clearInterval(i.fv),i.Cf=!1,i.gf=!1,i.Sf=[0,0],i.zf.Jf(),""===i.cf&&(i.cf=i.nf),i.$f()},gs:function(i,s){var e=i.Ue;i.vv;if(!s.zd&&s.Cf){if(s.lf(i,s),65===e&&(i.mv||i.pv))return s.gv(),i.wv(),s.$f();if(17===e||i.pv||i.mv)return s;if(13===e)i.wv(),s.uf(i,s);else if(9===e&&(i.wv(),t.length>1)){var h=t[s.tv+1]?s.tv+1:0;s.Jf(),setTimeout(function(){t[h].uv()},10)}return s.cf=s.zf.Ji,s.wf=s.zf.Xf,s.Sf=[0,0],s.$f()}},Cv:function(t,i){var s=i.Sv(t),e=s.nt,h=s.at;return i.Tv?(delete i.Tv,void delete i.lv):i.vd&&i.xv(e,h)||!i.vd?i.Wf?(i.Wf=!1,i.Cv(t,i),i.uv(i.yv(e,h))):void 0:i.Jf()},Of:function(t,i){var s=i.Sv(t),e=s.nt,h=s.at,r=i.xv(e,h);if(r&&i.vd?(i.vd.Uf.Vv="text",i.Tf=!0):i.Tf&&i.vd&&(i.vd.Uf.Vv="default",i.Tf=!1),i.Cf&&i.Dv>=0){var n=i.yv(e,h),a=Math.min(i.Dv,n),o=Math.max(i.Dv,n);if(!r)return i.lv=!0,i.Tv=!0,delete i.Dv,void i.$f();i.Sf[0]===a&&i.Sf[1]===o||(i.Sf=[a,o],i.$f())}},kf:function(t,i){var s=i.Sv(t),e=s.nt,h=s.at,r=i.xv(e,h);i.Wf=r,i.Cf&&r&&(i.Dv=i.yv(e,h))},Lf:function(t,i){var s=i.Sv(t),e=s.nt,h=s.at,r=i.yv(e,h)!==i.Dv;i.Cf&&i.Dv>=0&&i.xv(e,h)&&r?(i.lv=!0,delete i.Dv,i.$f()):delete i.Dv,i.Cv(t,i)},gv:function(t){var i=this;t=t||[0,i.cf.length];return setTimeout(function(){i.Sf=[t[0],t[1]],i.zf.Xf=t[0],i.zf.Zf=t[1],i.$f()},1),i},bv:function(){return this.yf},$f:function(){},Gi:function(t,i){var s=this,e=s.Ef,h=s.bf,r=s.Mf,n=s.$d,a=s.Yd,o=s.av,c=s.ov;e&&(e.Mv=s.sf.nt,e.Ev=s.sf.at,e.Av=s.sf.Jf,e.Nv=s.sf.sv,s.Yd>0&&(e.Vt=s.Xd,s.Iv(e,s.ev,s.rv,h-o,r-c,n),e.fill(),e.Mv=0,e.Ev=0,e.Av=0),s.Pv(function(){e.Mv=0,e.Ev=0,e.Av=0;var u=s.cv(),l=s.Kd+s.Yd+s.rv;if(s.Sf[1]>0){var d=s.Fv(u.substring(0,s.Sf[0])),f=s.Fv(u.substring(s.Sf[0],s.Sf[1]));e.Vt=s.hf,e.Qh(l+d,l,f,s.jd)}if(s.gf){var v=s.Fv(u.substring(0,s.wf));e.Vt=s.bd,e.Qh(l+v,l,1,s.jd)}var m=s.Kd+s.Yd+s.ev,p=Math.round(l+s.jd/2);u=""===u&&s.nf?s.nf:u,e.Vt=""!==s.cf&&s.cf!==s.nf?s.bd:s.Ed,e.Rh=s.Pd+" "+s.Nd+" "+s.xd+"px "+s.Vd,e.Nv=s.Rd,e.Av=s.Bd,e.Mv=s.kd,e.Ev=s.Wd,e.Rv="left",e._v="middle",e.vr(u,m,p);var g=s.ef.split("px "),w="none"===s.ef?0:parseInt(g[0],10),C="none"===s.ef?0:parseInt(g[1],10),S="none"===s.ef?0:parseInt(g[2],10),T="none"===s.ef?"":g[3];if(S>0){var x=s.Nf,y=x.Pi.ui,V=x.Pi.li;x.Hh(0,0,y,V),x.Av=S,x.Nv=T,x.Mv=0,x.Ev=C,x.Qh(-1*h,-100,3*h,100),x.Mv=w,x.Ev=0,x.Qh(y,-1*r,100,3*r),x.Mv=0,x.Ev=C,x.Qh(-1*h,V,3*h,100),x.Mv=w,x.Ev=0,x.Qh(-100,-1*r,100,3*r),s.Iv(e,a+s.ev,a+s.rv,h-2*a-o,r-2*a-c,n),e.Bv(),e.di(s.Af,0,0,y,V,a+s.ev,a+s.rv,y,V)}return s.md&&s.md.di(s.yf,t,i),s}))},Ht:function(){var i=t.indexOf(this);-1!=i&&t.splice(i,1),this.Cf&&this.Jf(),document.Qf.Ts(this.zf),this.yf=null,this.Af=null,this.Ef=null},Pv:function(t){var i=this,s=i.Ef,e=i.bf,h=i.Mf,r=i.$d,n=i.Yd,a=i.av,o=i.ov;if(""===i.tf)s.Vt=i.Pf,i.Iv(s,n+i.ev,n+i.rv,e-2*n-a,h-2*n-o,r),s.fill(),t();else{var c=new Image;c.da=i.tf,c.fa=function(){s.di(c,0,0,c.ui,c.li,n+i.ev,n+i.rv,e,h),t()}}},Ov:function(){if(this.Sf[1]>0){var t=this.Sf[0],i=this.Sf[1];return this.cf=this.cf.substr(0,t)+this.cf.substr(i),this.wf=t,this.wf=this.wf<0?0:this.wf,this.Sf=[0,0],!0}return!1},cv:function(t){t=void 0===t?this.cf:t;var i=this.Fv(t)/(this.qd-this.Kd);return(i>1?t.substr(-1*Math.floor(t.length/i)):t)+""},Fv:function(t){var i=this.Ef;return i.Rh=this.Pd+" "+this.Nd+" "+this.xd+"px "+this.Vd,i.Rv="left",i.fr(t).ui},xf:function(){this.bf=this.qd+2*this.Kd+2*this.Yd+this.av,this.Mf=this.jd+2*this.Kd+2*this.Yd+this.ov},iv:function(){this.yf.ui,this.yf.li;this.yf.Df("width",this.bf),this.yf.Df("height",this.Mf),this.Af.Df("width",this.qd+2*this.Kd),this.Af.Df("height",this.jd+2*this.Kd),this.md},Iv:function(t,i,s,e,h,r){e<2*r&&(r=e/2),h<2*r&&(r=h/2),t.ir(),t.sr(i+r,s),t.er(i+e-r,s),t.kv(i+e,s,i+e,s+r),t.er(i+e,s+h-r),t.kv(i+e,s+h,i+e-r,s+h),t.er(i+r,s+h),t.kv(i,s+h,i,s+h-r),t.er(i,s+r),t.kv(i,s,i+r,s),t.hr()},xv:function(t,i){var s=t>=this.Oi.nt+this.wd,e=t<=this.Oi.nt+this.wd+this.qd+2*this.Kd,h=i>=this.Oi.at+this.Sd,r=i<=this.Oi.at+this.Sd+this.jd+2*this.Kd;return s&&e&&h&&r},yv:function(t,i){var s=this.cf;this.cf===this.nf&&(s="");var e=this.cv(s),h=0,r=e.length;if(t-(this.Oi.nt+this.wd)<this.Fv(e))for(var n=0;n<e.length;n++)if((h+=this.Fv(e[n]))>=t-(this.Oi.nt+this.wd)){r=n;break}return r},Sv:function(t){var i=t.zs,s=document.Wv.Lv(i,void 0),e=parseInt(s.Jv,10)||0,h=parseInt(s.Jv,10)||0,r=parseInt(s.zv,10)||0,n=parseInt(s.zv,10)||0,a=document.Qf.Gv.ze||0,o=document.Qf.Gv.Le||0,c=0,u=0;if(void 0!==i.Uv)do{c+=i.Le,u+=i.ze}while(i=i.Uv);return c+=e+r+o,u+=h+n+a,{nt:t.Hv-c,at:t.qv-u}}}}(),function(t){if("object"==typeof module&&"object"==typeof module.jv)module.jv=t();else if("function"==typeof define&&define.Kv)define([],t);else{var i=t();window.Yv=i.Yv,window.Qv=i.Qv}}(function(){function t(t){for(var i=t,s=[];i.J;)s.unshift(i),i=i.J;return s}var i={search:function(s,e,r,n){s.Xv();var a=(n=n||{}).Zv||i.tm.$v,o=n.im||!1,c=new h(function(t){return t.sm}),u=e;for(e.Et=a(e,r),s.em(e),c.push(e);c.size()>0;){var l=c.pop();if(l===r)return t(l);l.hm=!0;for(var d=s.rm(l),f=0,v=d.length;f<v;++f){var m=d[f];if(!m.hm&&!m.nm()){var p=l.am+m.om(l),g=m.cm;(!g||p<m.am)&&(m.cm=!0,m.J=l,m.Et=m.Et||a(m,r),m.am=p,m.sm=m.am+m.Et,s.em(m),o&&(m.Et<u.Et||m.Et===u.Et&&m.am<u.am)&&(u=m),g?c.um(m):c.push(m))}}}return o?t(u):[]},tm:{$v:function(t,i){return Math.abs(i.nt-t.nt)+Math.abs(i.at-t.at)},lm:function(t,i){var s=Math.sqrt(2),e=Math.abs(i.nt-t.nt),h=Math.abs(i.at-t.at);return 1*(e+h)+(s-2)*Math.min(e,h)}},dm:function(t){t.sm=0,t.am=0,t.Et=0,t.cm=!1,t.hm=!1,t.J=null}};function s(t,i){i=i||{},this.fm=[],this.lm=!!i.lm,this.vm=[];for(var s=0;s<t.length;s++){this.vm[s]=[];for(var h=0,r=t[s];h<r.length;h++){var n=new e(s,h,r[h]);this.vm[s][h]=n,this.fm.push(n)}}this.Ta()}function e(t,i,s){this.nt=t,this.at=i,this.mm=s}function h(t){this.pm=[],this.gm=t}return s.prototype.Ta=function(){this.wm=[];for(var t=0;t<this.fm.length;t++)i.dm(this.fm[t])},s.prototype.Xv=function(){for(var t=0;t<this.wm.length;t++)i.dm(this.wm[t]);this.wm=[]},s.prototype.em=function(t){this.wm.push(t)},s.prototype.rm=function(t){var i=[],s=t.nt,e=t.at,h=this.vm;return h[s-1]&&h[s-1][e]&&i.push(h[s-1][e]),h[s+1]&&h[s+1][e]&&i.push(h[s+1][e]),h[s]&&h[s][e-1]&&i.push(h[s][e-1]),h[s]&&h[s][e+1]&&i.push(h[s][e+1]),this.lm&&(h[s-1]&&h[s-1][e-1]&&i.push(h[s-1][e-1]),h[s+1]&&h[s+1][e-1]&&i.push(h[s+1][e-1]),h[s-1]&&h[s-1][e+1]&&i.push(h[s-1][e+1]),h[s+1]&&h[s+1][e+1]&&i.push(h[s+1][e+1])),i},s.prototype.toString=function(){for(var t=[],i=this.vm,s=0;s<i.length;s++){for(var e=[],h=i[s],r=0;r<h.length;r++)e.push(h[r].mm);t.push(e.join(" "))}return t.join("\n")},e.prototype.toString=function(){return"["+this.nt+" "+this.at+"]"},e.prototype.om=function(t){return t&&t.nt!=this.nt&&t.at!=this.at?1.41421*this.mm:this.mm},e.prototype.nm=function(){return 0===this.mm},h.prototype={push:function(t){this.pm.push(t),this.Cm(this.pm.length-1)},pop:function(){var t=this.pm[0],i=this.pm.pop();return this.pm.length>0&&(this.pm[0]=i,this.Sm(0)),t},Tm:function(t){var i=this.pm.indexOf(t),s=this.pm.pop();i!==this.pm.length-1&&(this.pm[i]=s,this.gm(s)<this.gm(t)?this.Cm(i):this.Sm(i))},size:function(){return this.pm.length},um:function(t){this.Cm(this.pm.indexOf(t))},Cm:function(t){for(var i=this.pm[t];t>0;){var s=(t+1>>1)-1,e=this.pm[s];if(!(this.gm(i)<this.gm(e)))break;this.pm[s]=i,this.pm[t]=e,t=s}},Sm:function(t){for(var i=this.pm.length,s=this.pm[t],e=this.gm(s);;){var h,r=t+1<<1,n=r-1,a=null;if(n<i){var o=this.pm[n];(h=this.gm(o))<e&&(a=n)}if(r<i){var c=this.pm[r];this.gm(c)<(null===a?e:h)&&(a=r)}if(null===a)break;this.pm[t]=this.pm[a],this.pm[a]=s,t=a}}},{Yv:i,Qv:s}}),function(){var t,i=this;if("function"==typeof i.xm)try{var s=i.xm("crypto").ym;t=s&&function(){return s(16)}}catch(t){}if(!t&&i.Vm&&crypto.Dm){var e=new Uint8Array(16);t=function(){return crypto.Dm(e),e}}if(!t){var h=new Array(16);t=function(){for(var t,i=0;i<16;i++)0==(3&i)&&(t=4294967296*Math.random()),h[i]=t>>>((3&i)<<3)&255;return h}}for(var r="function"==typeof i.bm?i.bm:Array,n=[],a={},o=0;o<256;o++)n[o]=(o+256).toString(16).substr(1),a[n[o]]=o;function c(t,i){var s=i||0,e=n;return e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+"-"+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]+e[t[s++]]}var u=t(),l=[1|u[0],u[1],u[2],u[3],u[4],u[5]],d=16383&(u[6]<<8|u[7]),f=0,v=0;function m(i,s,e){var h=s&&e||0;"string"==typeof i&&(s="binary"==i?new r(16):null,i=null);var n=(i=i||{}).random||(i.Mm||t)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,s)for(var a=0;a<16;a++)s[h+a]=n[a];return s||c(n)}var p=m;if(p.Em=function(t,i,s){var e=i&&s||0,h=i||[],r=null!=(t=t||{}).Am?t.Am:d,n=null!=t.Nm?t.Nm:(new Date).getTime(),a=null!=t.Im?t.Im:v+1,o=n-f+(a-v)/1e4;if(o<0&&null==t.Am&&(r=r+1&16383),(o<0||n>f)&&null==t.Im&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=n,v=a,d=r;var u=(1e4*(268435455&(n+=122192928e5))+a)%4294967296;h[e++]=u>>>24&255,h[e++]=u>>>16&255,h[e++]=u>>>8&255,h[e++]=255&u;var m=n/4294967296*1e4&268435455;h[e++]=m>>>8&255,h[e++]=255&m,h[e++]=m>>>24&15|16,h[e++]=m>>>16&255,h[e++]=r>>>8|128,h[e++]=255&r;for(var p=t.zi||l,g=0;g<6;g++)h[e+g]=p[g];return i||c(h)},p.Pm=m,p.parse=function(t,i,s){var e=i&&s||0,h=0;for(i=i||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){h<16&&(i[e+h++]=a[t])});h<16;)i[e+h++]=0;return i},p.Fm=c,p.Rm=r,"function"==typeof define&&define.Kv)define(function(){return p});else if("undefined"!=typeof module&&module.jv)module.jv=p;else{var g=i._m;p.Bm=function(){return i._m=g,p},i._m=p}}.call(this);